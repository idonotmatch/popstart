"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/search";
exports.ids = ["pages/api/search"];
exports.modules = {

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/search.js */ \"(api)/./pages/api/search.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/search\",\n        pathname: \"/api/search\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnNlYXJjaCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGc2VhcmNoLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ2tEO0FBQ2xEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxpREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsaURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktZ3JhcGhxbC1wcm9qZWN0Lz85YzRmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvc2VhcmNoLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc2VhcmNoXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvc2VhcmNoXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/search.js":
/*!*****************************!*\
  !*** ./pages/api/search.js ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! pg */ \"pg\");\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(pg__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Initialize Redis client with fallback\nlet redisClient;\ntry {\n    redisClient = new (ioredis__WEBPACK_IMPORTED_MODULE_1___default())(process.env.REDIS_URL, {\n        maxRetriesPerRequest: 1,\n        retryStrategy: ()=>null\n    });\n    redisClient.on(\"error\", (err)=>{\n        console.warn(\"Redis Client Error:\", err);\n        redisClient = null; // Disable Redis client on error\n    });\n} catch (error) {\n    console.warn(\"Failed to initialize Redis:\", error);\n    redisClient = null;\n}\n// Initialize PostgreSQL connection pool\nlet pool;\ntry {\n    pool = new pg__WEBPACK_IMPORTED_MODULE_2__.Pool({\n        connectionString: process.env.DATABASE_URL,\n        ssl: {\n            rejectUnauthorized: false\n        }\n    });\n    // Test the connection\n    pool.query(\"SELECT NOW()\", (err, res)=>{\n        if (err) {\n            console.error(\"Error connecting to the database:\", err);\n        } else {\n            console.log(\"Successfully connected to the database\");\n        }\n    });\n} catch (error) {\n    console.error(\"Failed to initialize database pool:\", error);\n}\n// Cache helper function\nconst cacheHelper = {\n    get: async (key)=>{\n        if (redisClient) {\n            try {\n                return await redisClient.get(key);\n            } catch (error) {\n                console.warn(\"Redis get error:\", error);\n            }\n        }\n        return null;\n    },\n    set: async (key, value, options)=>{\n        if (redisClient) {\n            try {\n                await redisClient.set(key, value, options);\n            } catch (error) {\n                console.warn(\"Redis set error:\", error);\n            }\n        }\n    }\n};\nconst mapProduct = (item, source)=>{\n    console.log(`Mapping product from ${source}:`, JSON.stringify(item, null, 2));\n    if (source === \"walmart\") {\n        return {\n            id: item.id || \"\",\n            brand: item.brand || \"N/A\",\n            title: item.name || \"\",\n            link: item.url || \"\",\n            image: item.image || \"\",\n            isPrime: false,\n            rating: item.rating?.average_rating ? Number(item.rating.average_rating).toFixed(1) : \"0.0\",\n            ratingsTotal: item.rating?.number_of_reviews || 0,\n            price: item.price ? `${item.price_currency || \"$\"}${Number(item.price).toFixed(2)}` : \"N/A\",\n            availability: item.availability || \"Unavailable\",\n            source: \"walmart\",\n            sponsored: item.sponsored || false,\n            full_description: item.full_description || \"\",\n            product_category: item.product_category || \"\",\n            model: item.model || \"\",\n            small_description: item.small_description || \"\"\n        };\n    } else if (source === \"amazon\") {\n        return {\n            asin: item.asin || \"\",\n            brand: item.brand || \"N/A\",\n            title: item.name || item.title || \"\",\n            link: item.url || item.link || \"\",\n            image: item.image || item.images && item.images[0] || \"\",\n            isPrime: item.has_prime || item.isPrime || false,\n            rating: item.stars || item.average_rating ? Number(item.stars || item.average_rating).toFixed(1) : \"0.0\",\n            ratingsTotal: item.total_reviews || item.ratings_total || 0,\n            price: item.price || item.pricing || \"N/A\",\n            availability: item.availability || \"Unavailable\",\n            source: \"amazon\",\n            sponsored: item.sponsored || false,\n            full_description: item.full_description || \"\",\n            product_category: item.product_category || \"\",\n            model: item.model || \"\",\n            small_description: item.small_description || \"\"\n        };\n    }\n};\nconst filterSponsoredProducts = (products)=>{\n    return products.filter((product)=>!product.sponsored);\n};\nconst insertProduct = async (product)=>{\n    if (!pool) {\n        console.error(\"Database pool not initialized\");\n        return;\n    }\n    const client = await pool.connect();\n    try {\n        await client.query(\"BEGIN\");\n        // Insert into products table\n        const productQuery = `\n      INSERT INTO products (retailer_id, source, title, brand, image_url, link, full_description, product_category)\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8)\n      ON CONFLICT (retailer_id, source) DO UPDATE\n      SET title = EXCLUDED.title, brand = EXCLUDED.brand, image_url = EXCLUDED.image_url, \n          link = EXCLUDED.link, full_description = EXCLUDED.full_description, \n          product_category = EXCLUDED.product_category\n      RETURNING product_id\n    `;\n        const productValues = [\n            product.id || product.asin,\n            product.source,\n            product.title,\n            product.brand,\n            product.image,\n            product.link,\n            product.full_description,\n            product.product_category\n        ];\n        const productResult = await client.query(productQuery, productValues);\n        const productId = productResult.rows[0].product_id;\n        // Insert into product_details table\n        const detailsQuery = `\n      INSERT INTO product_details (product_id, rating, ratings_total, is_prime, model, small_description)\n      VALUES ($1, $2, $3, $4, $5, $6)\n      ON CONFLICT (product_id) DO UPDATE\n      SET rating = EXCLUDED.rating, ratings_total = EXCLUDED.ratings_total, \n          is_prime = EXCLUDED.is_prime, model = EXCLUDED.model, \n          small_description = EXCLUDED.small_description\n    `;\n        const detailsValues = [\n            productId,\n            parseFloat(product.rating) || null,\n            parseInt(product.ratingsTotal) || null,\n            product.isPrime || false,\n            product.model,\n            product.small_description\n        ];\n        await client.query(detailsQuery, detailsValues);\n        // Insert into price_history table\n        if (product.price && product.price !== \"N/A\") {\n            const priceQuery = `\n        INSERT INTO price_history (product_id, price, availability)\n        VALUES ($1, $2, $3)\n      `;\n            const priceValues = [\n                productId,\n                parseFloat(product.price.replace(/[^0-9.-]+/g, \"\")) || null,\n                product.availability || \"Unknown\"\n            ];\n            await client.query(priceQuery, priceValues);\n        }\n        await client.query(\"COMMIT\");\n        console.log(`Inserted/Updated product in database: ${product.title}`);\n    } catch (e) {\n        await client.query(\"ROLLBACK\");\n        console.error(\"Error inserting/updating product in database:\", e);\n    } finally{\n        client.release();\n    }\n};\nconst fetchProducts = async (term, source, sortBy, page = 1)=>{\n    let url;\n    let params;\n    // Remove any quotes from the API key\n    const apiKey = process.env.SCRAPER_API_KEY.replace(/[''\"]+/g, \"\");\n    if (source === \"amazon\") {\n        if (term.match(/^[A-Z0-9]{10}$/)) {\n            url = `https://api.scraperapi.com/structured/amazon/product`;\n            params = {\n                api_key: apiKey,\n                asin: term,\n                country_code: \"us\",\n                tld: \"com\"\n            };\n        } else {\n            url = `https://api.scraperapi.com/structured/amazon/search`;\n            params = {\n                api_key: apiKey,\n                query: term,\n                country: \"us\",\n                page: page.toString(),\n                sort_by: sortBy || \"\",\n                exclude_sponsored: \"true\"\n            };\n        }\n    } else if (source === \"walmart\") {\n        if (term.match(/^[0-9]+$/)) {\n            url = `https://api.scraperapi.com/structured/walmart/product`;\n            params = {\n                api_key: apiKey,\n                product_id: term,\n                country_code: \"us\",\n                tld: \"com\"\n            };\n        } else {\n            url = `https://api.scraperapi.com/structured/walmart/search`;\n            params = {\n                api_key: apiKey,\n                query: term,\n                country: \"us\",\n                page: page.toString(),\n                sort_by: sortBy || \"\",\n                exclude_sponsored: \"true\"\n            };\n        }\n    }\n    try {\n        console.log(`Fetching ${source} results for term: \"${term}\", page: ${page}, sortBy: ${sortBy}`);\n        console.log(\"API Request URL:\", url);\n        console.log(\"API Request Params:\", {\n            ...params,\n            api_key: \"[REDACTED]\"\n        });\n        const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(url, {\n            params,\n            timeout: 30000\n        });\n        console.log(`Raw API response from ${source}:`, JSON.stringify(response.data, null, 2));\n        let jsonData = response.data;\n        if (source === \"amazon\" && term.match(/^[A-Z0-9]{10}$/) || source === \"walmart\" && term.match(/^[0-9]+$/)) {\n            // If it's a product query, wrap the result in an array\n            const mappedProduct = mapProduct(jsonData, source);\n            await insertProduct(mappedProduct);\n            return {\n                results: [\n                    mappedProduct\n                ],\n                totalPages: 1\n            };\n        } else {\n            // For search queries, process as before\n            let results = [];\n            let totalPages = 1;\n            if (source === \"walmart\" && jsonData.items && Array.isArray(jsonData.items)) {\n                results = jsonData.items;\n                totalPages = jsonData.total_pages || 1;\n            } else if (source === \"amazon\" && jsonData.results) {\n                results = jsonData.results;\n                totalPages = jsonData.total_pages || 1;\n            } else {\n                console.error(`Invalid API response structure from ${source}:`, jsonData);\n                throw new Error(`Invalid API response structure from ${source}`);\n            }\n            const mappedResults = results.map((item)=>mapProduct(item, source));\n            console.log(`Mapped results for ${source}:`, JSON.stringify(mappedResults, null, 2));\n            // Insert all products into the database\n            for (const product of mappedResults){\n                await insertProduct(product);\n            }\n            return {\n                results: filterSponsoredProducts(mappedResults),\n                totalPages\n            };\n        }\n    } catch (error) {\n        console.error(`Error fetching data from ${source} API:`, error.message);\n        console.error(`Error details:`, error.response ? error.response.data : \"No response data\");\n        throw error;\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"GET\") {\n        return res.status(405).end();\n    }\n    const { term, page = \"1\", sort_by, source = \"all\" } = req.query;\n    res.setHeader(\"Content-Type\", \"application/json\");\n    const results = [];\n    const streamResults = async (sourceToFetch)=>{\n        const cacheKey = `search:${sourceToFetch}:${term}:${sort_by}:${page}`;\n        try {\n            const cachedResults = await cacheHelper.get(cacheKey);\n            if (cachedResults) {\n                console.log(`Using cached results for ${sourceToFetch}`);\n                results.push({\n                    source: sourceToFetch,\n                    ...JSON.parse(cachedResults)\n                });\n            } else {\n                console.log(`Fetching fresh results for ${sourceToFetch}`);\n                const { results: sourceResults, totalPages } = await fetchProducts(term, sourceToFetch, sort_by, parseInt(page));\n                results.push({\n                    source: sourceToFetch,\n                    results: sourceResults,\n                    totalPages\n                });\n                await cacheHelper.set(cacheKey, JSON.stringify({\n                    results: sourceResults,\n                    totalPages\n                }), {\n                    EX: 3600\n                }); // Cache for 1 hour\n            }\n        } catch (error) {\n            console.error(`Error streaming results from ${sourceToFetch}:`, error.message);\n            results.push({\n                source: sourceToFetch,\n                error: `Failed to fetch data from ${sourceToFetch}: ${error.message}`,\n                details: error.response ? error.response.data : \"No response data\"\n            });\n        }\n    };\n    if (source === \"all\") {\n        await Promise.all([\n            streamResults(\"walmart\"),\n            streamResults(\"amazon\")\n        ]);\n    } else {\n        await streamResults(source);\n    }\n    res.status(200).json(results);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUMsNkJBQTZCLEVBQUU0RyxjQUFjLENBQUMsQ0FBQyxFQUFFNUcsTUFBTW9HLE9BQU87WUFDN0VULFFBQVFvQixJQUFJLENBQUM7Z0JBQ1g5RixRQUFRMkY7Z0JBQ1I1RyxPQUFPLENBQUMsMEJBQTBCLEVBQUU0RyxjQUFjLEVBQUUsRUFBRTVHLE1BQU1vRyxPQUFPLENBQUMsQ0FBQztnQkFDckVlLFNBQVNuSCxNQUFNc0YsUUFBUSxHQUFHdEYsTUFBTXNGLFFBQVEsQ0FBQ0UsSUFBSSxHQUFHO1lBQ2xEO1FBQ0Y7SUFDRjtJQUVBLElBQUl2RSxXQUFXLE9BQU87UUFDcEIsTUFBTW1HLFFBQVFDLEdBQUcsQ0FBQztZQUNoQlYsY0FBYztZQUNkQSxjQUFjO1NBQ2Y7SUFDSCxPQUFPO1FBQ0wsTUFBTUEsY0FBYzFGO0lBQ3RCO0lBRUFWLElBQUlpRyxNQUFNLENBQUMsS0FBS2MsSUFBSSxDQUFDM0I7QUFDdkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS1ncmFwaHFsLXByb2plY3QvLi9wYWdlcy9hcGkvc2VhcmNoLmpzPzVkM2EiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCBSZWRpcyBmcm9tICdpb3JlZGlzJztcbmltcG9ydCB7IFBvb2wgfSBmcm9tICdwZyc7XG5cbi8vIEluaXRpYWxpemUgUmVkaXMgY2xpZW50IHdpdGggZmFsbGJhY2tcbmxldCByZWRpc0NsaWVudDtcbnRyeSB7XG4gIHJlZGlzQ2xpZW50ID0gbmV3IFJlZGlzKHByb2Nlc3MuZW52LlJFRElTX1VSTCwge1xuICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAxLFxuICAgIHJldHJ5U3RyYXRlZ3k6ICgpID0+IG51bGxcbiAgfSk7XG4gIHJlZGlzQ2xpZW50Lm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICBjb25zb2xlLndhcm4oJ1JlZGlzIENsaWVudCBFcnJvcjonLCBlcnIpO1xuICAgIHJlZGlzQ2xpZW50ID0gbnVsbDsgLy8gRGlzYWJsZSBSZWRpcyBjbGllbnQgb24gZXJyb3JcbiAgfSk7XG59IGNhdGNoIChlcnJvcikge1xuICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBpbml0aWFsaXplIFJlZGlzOicsIGVycm9yKTtcbiAgcmVkaXNDbGllbnQgPSBudWxsO1xufVxuXG4vLyBJbml0aWFsaXplIFBvc3RncmVTUUwgY29ubmVjdGlvbiBwb29sXG5sZXQgcG9vbDtcbnRyeSB7XG4gIHBvb2wgPSBuZXcgUG9vbCh7XG4gICAgY29ubmVjdGlvblN0cmluZzogcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMLFxuICAgIHNzbDoge1xuICAgICAgcmVqZWN0VW5hdXRob3JpemVkOiBmYWxzZVxuICAgIH1cbiAgfSk7XG5cbiAgLy8gVGVzdCB0aGUgY29ubmVjdGlvblxuICBwb29sLnF1ZXJ5KCdTRUxFQ1QgTk9XKCknLCAoZXJyLCByZXMpID0+IHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjb25uZWN0aW5nIHRvIHRoZSBkYXRhYmFzZTonLCBlcnIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZCB0byB0aGUgZGF0YWJhc2UnKTtcbiAgICB9XG4gIH0pO1xufSBjYXRjaCAoZXJyb3IpIHtcbiAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgZGF0YWJhc2UgcG9vbDonLCBlcnJvcik7XG59XG5cbi8vIENhY2hlIGhlbHBlciBmdW5jdGlvblxuY29uc3QgY2FjaGVIZWxwZXIgPSB7XG4gIGdldDogYXN5bmMgKGtleSkgPT4ge1xuICAgIGlmIChyZWRpc0NsaWVudCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHJlZGlzQ2xpZW50LmdldChrZXkpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdSZWRpcyBnZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgc2V0OiBhc3luYyAoa2V5LCB2YWx1ZSwgb3B0aW9ucykgPT4ge1xuICAgIGlmIChyZWRpc0NsaWVudCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcmVkaXNDbGllbnQuc2V0KGtleSwgdmFsdWUsIG9wdGlvbnMpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdSZWRpcyBzZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuY29uc3QgbWFwUHJvZHVjdCA9IChpdGVtLCBzb3VyY2UpID0+IHtcbiAgY29uc29sZS5sb2coYE1hcHBpbmcgcHJvZHVjdCBmcm9tICR7c291cmNlfTpgLCBKU09OLnN0cmluZ2lmeShpdGVtLCBudWxsLCAyKSk7XG5cbiAgaWYgKHNvdXJjZSA9PT0gJ3dhbG1hcnQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBpdGVtLmlkIHx8ICcnLFxuICAgICAgYnJhbmQ6IGl0ZW0uYnJhbmQgfHwgJ04vQScsXG4gICAgICB0aXRsZTogaXRlbS5uYW1lIHx8ICcnLFxuICAgICAgbGluazogaXRlbS51cmwgfHwgJycsXG4gICAgICBpbWFnZTogaXRlbS5pbWFnZSB8fCAnJyxcbiAgICAgIGlzUHJpbWU6IGZhbHNlLFxuICAgICAgcmF0aW5nOiBpdGVtLnJhdGluZz8uYXZlcmFnZV9yYXRpbmcgPyBOdW1iZXIoaXRlbS5yYXRpbmcuYXZlcmFnZV9yYXRpbmcpLnRvRml4ZWQoMSkgOiAnMC4wJyxcbiAgICAgIHJhdGluZ3NUb3RhbDogaXRlbS5yYXRpbmc/Lm51bWJlcl9vZl9yZXZpZXdzIHx8IDAsXG4gICAgICBwcmljZTogaXRlbS5wcmljZSA/IGAke2l0ZW0ucHJpY2VfY3VycmVuY3kgfHwgJyQnfSR7TnVtYmVyKGl0ZW0ucHJpY2UpLnRvRml4ZWQoMil9YCA6IFwiTi9BXCIsXG4gICAgICBhdmFpbGFiaWxpdHk6IGl0ZW0uYXZhaWxhYmlsaXR5IHx8IFwiVW5hdmFpbGFibGVcIixcbiAgICAgIHNvdXJjZTogJ3dhbG1hcnQnLFxuICAgICAgc3BvbnNvcmVkOiBpdGVtLnNwb25zb3JlZCB8fCBmYWxzZSxcbiAgICAgIGZ1bGxfZGVzY3JpcHRpb246IGl0ZW0uZnVsbF9kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgIHByb2R1Y3RfY2F0ZWdvcnk6IGl0ZW0ucHJvZHVjdF9jYXRlZ29yeSB8fCAnJyxcbiAgICAgIG1vZGVsOiBpdGVtLm1vZGVsIHx8ICcnLFxuICAgICAgc21hbGxfZGVzY3JpcHRpb246IGl0ZW0uc21hbGxfZGVzY3JpcHRpb24gfHwgJydcbiAgICB9O1xuICB9IGVsc2UgaWYgKHNvdXJjZSA9PT0gJ2FtYXpvbicpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYXNpbjogaXRlbS5hc2luIHx8ICcnLFxuICAgICAgYnJhbmQ6IGl0ZW0uYnJhbmQgfHwgJ04vQScsXG4gICAgICB0aXRsZTogaXRlbS5uYW1lIHx8IGl0ZW0udGl0bGUgfHwgJycsXG4gICAgICBsaW5rOiBpdGVtLnVybCB8fCBpdGVtLmxpbmsgfHwgJycsXG4gICAgICBpbWFnZTogaXRlbS5pbWFnZSB8fCAoaXRlbS5pbWFnZXMgJiYgaXRlbS5pbWFnZXNbMF0pIHx8ICcnLFxuICAgICAgaXNQcmltZTogaXRlbS5oYXNfcHJpbWUgfHwgaXRlbS5pc1ByaW1lIHx8IGZhbHNlLFxuICAgICAgcmF0aW5nOiBpdGVtLnN0YXJzIHx8IGl0ZW0uYXZlcmFnZV9yYXRpbmcgPyBOdW1iZXIoaXRlbS5zdGFycyB8fCBpdGVtLmF2ZXJhZ2VfcmF0aW5nKS50b0ZpeGVkKDEpIDogJzAuMCcsXG4gICAgICByYXRpbmdzVG90YWw6IGl0ZW0udG90YWxfcmV2aWV3cyB8fCBpdGVtLnJhdGluZ3NfdG90YWwgfHwgMCxcbiAgICAgIHByaWNlOiBpdGVtLnByaWNlIHx8IGl0ZW0ucHJpY2luZyB8fCBcIk4vQVwiLFxuICAgICAgYXZhaWxhYmlsaXR5OiBpdGVtLmF2YWlsYWJpbGl0eSB8fCBcIlVuYXZhaWxhYmxlXCIsXG4gICAgICBzb3VyY2U6ICdhbWF6b24nLFxuICAgICAgc3BvbnNvcmVkOiBpdGVtLnNwb25zb3JlZCB8fCBmYWxzZSxcbiAgICAgIGZ1bGxfZGVzY3JpcHRpb246IGl0ZW0uZnVsbF9kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgIHByb2R1Y3RfY2F0ZWdvcnk6IGl0ZW0ucHJvZHVjdF9jYXRlZ29yeSB8fCAnJyxcbiAgICAgIG1vZGVsOiBpdGVtLm1vZGVsIHx8ICcnLFxuICAgICAgc21hbGxfZGVzY3JpcHRpb246IGl0ZW0uc21hbGxfZGVzY3JpcHRpb24gfHwgJydcbiAgICB9O1xuICB9XG59O1xuXG5jb25zdCBmaWx0ZXJTcG9uc29yZWRQcm9kdWN0cyA9IChwcm9kdWN0cykgPT4ge1xuICByZXR1cm4gcHJvZHVjdHMuZmlsdGVyKHByb2R1Y3QgPT4gIXByb2R1Y3Quc3BvbnNvcmVkKTtcbn07XG5cbmNvbnN0IGluc2VydFByb2R1Y3QgPSBhc3luYyAocHJvZHVjdCkgPT4ge1xuICBpZiAoIXBvb2wpIHtcbiAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBwb29sIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IHBvb2wuY29ubmVjdCgpO1xuICB0cnkge1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQkVHSU4nKTtcblxuICAgIC8vIEluc2VydCBpbnRvIHByb2R1Y3RzIHRhYmxlXG4gICAgY29uc3QgcHJvZHVjdFF1ZXJ5ID0gYFxuICAgICAgSU5TRVJUIElOVE8gcHJvZHVjdHMgKHJldGFpbGVyX2lkLCBzb3VyY2UsIHRpdGxlLCBicmFuZCwgaW1hZ2VfdXJsLCBsaW5rLCBmdWxsX2Rlc2NyaXB0aW9uLCBwcm9kdWN0X2NhdGVnb3J5KVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgpXG4gICAgICBPTiBDT05GTElDVCAocmV0YWlsZXJfaWQsIHNvdXJjZSkgRE8gVVBEQVRFXG4gICAgICBTRVQgdGl0bGUgPSBFWENMVURFRC50aXRsZSwgYnJhbmQgPSBFWENMVURFRC5icmFuZCwgaW1hZ2VfdXJsID0gRVhDTFVERUQuaW1hZ2VfdXJsLCBcbiAgICAgICAgICBsaW5rID0gRVhDTFVERUQubGluaywgZnVsbF9kZXNjcmlwdGlvbiA9IEVYQ0xVREVELmZ1bGxfZGVzY3JpcHRpb24sIFxuICAgICAgICAgIHByb2R1Y3RfY2F0ZWdvcnkgPSBFWENMVURFRC5wcm9kdWN0X2NhdGVnb3J5XG4gICAgICBSRVRVUk5JTkcgcHJvZHVjdF9pZFxuICAgIGA7XG4gICAgY29uc3QgcHJvZHVjdFZhbHVlcyA9IFtcbiAgICAgIHByb2R1Y3QuaWQgfHwgcHJvZHVjdC5hc2luLFxuICAgICAgcHJvZHVjdC5zb3VyY2UsXG4gICAgICBwcm9kdWN0LnRpdGxlLFxuICAgICAgcHJvZHVjdC5icmFuZCxcbiAgICAgIHByb2R1Y3QuaW1hZ2UsXG4gICAgICBwcm9kdWN0LmxpbmssXG4gICAgICBwcm9kdWN0LmZ1bGxfZGVzY3JpcHRpb24sXG4gICAgICBwcm9kdWN0LnByb2R1Y3RfY2F0ZWdvcnlcbiAgICBdO1xuICAgIGNvbnN0IHByb2R1Y3RSZXN1bHQgPSBhd2FpdCBjbGllbnQucXVlcnkocHJvZHVjdFF1ZXJ5LCBwcm9kdWN0VmFsdWVzKTtcbiAgICBjb25zdCBwcm9kdWN0SWQgPSBwcm9kdWN0UmVzdWx0LnJvd3NbMF0ucHJvZHVjdF9pZDtcblxuICAgIC8vIEluc2VydCBpbnRvIHByb2R1Y3RfZGV0YWlscyB0YWJsZVxuICAgIGNvbnN0IGRldGFpbHNRdWVyeSA9IGBcbiAgICAgIElOU0VSVCBJTlRPIHByb2R1Y3RfZGV0YWlscyAocHJvZHVjdF9pZCwgcmF0aW5nLCByYXRpbmdzX3RvdGFsLCBpc19wcmltZSwgbW9kZWwsIHNtYWxsX2Rlc2NyaXB0aW9uKVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2KVxuICAgICAgT04gQ09ORkxJQ1QgKHByb2R1Y3RfaWQpIERPIFVQREFURVxuICAgICAgU0VUIHJhdGluZyA9IEVYQ0xVREVELnJhdGluZywgcmF0aW5nc190b3RhbCA9IEVYQ0xVREVELnJhdGluZ3NfdG90YWwsIFxuICAgICAgICAgIGlzX3ByaW1lID0gRVhDTFVERUQuaXNfcHJpbWUsIG1vZGVsID0gRVhDTFVERUQubW9kZWwsIFxuICAgICAgICAgIHNtYWxsX2Rlc2NyaXB0aW9uID0gRVhDTFVERUQuc21hbGxfZGVzY3JpcHRpb25cbiAgICBgO1xuICAgIGNvbnN0IGRldGFpbHNWYWx1ZXMgPSBbXG4gICAgICBwcm9kdWN0SWQsXG4gICAgICBwYXJzZUZsb2F0KHByb2R1Y3QucmF0aW5nKSB8fCBudWxsLFxuICAgICAgcGFyc2VJbnQocHJvZHVjdC5yYXRpbmdzVG90YWwpIHx8IG51bGwsXG4gICAgICBwcm9kdWN0LmlzUHJpbWUgfHwgZmFsc2UsXG4gICAgICBwcm9kdWN0Lm1vZGVsLFxuICAgICAgcHJvZHVjdC5zbWFsbF9kZXNjcmlwdGlvblxuICAgIF07XG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGRldGFpbHNRdWVyeSwgZGV0YWlsc1ZhbHVlcyk7XG5cbiAgICAvLyBJbnNlcnQgaW50byBwcmljZV9oaXN0b3J5IHRhYmxlXG4gICAgaWYgKHByb2R1Y3QucHJpY2UgJiYgcHJvZHVjdC5wcmljZSAhPT0gXCJOL0FcIikge1xuICAgICAgY29uc3QgcHJpY2VRdWVyeSA9IGBcbiAgICAgICAgSU5TRVJUIElOVE8gcHJpY2VfaGlzdG9yeSAocHJvZHVjdF9pZCwgcHJpY2UsIGF2YWlsYWJpbGl0eSlcbiAgICAgICAgVkFMVUVTICgkMSwgJDIsICQzKVxuICAgICAgYDtcbiAgICAgIGNvbnN0IHByaWNlVmFsdWVzID0gW1xuICAgICAgICBwcm9kdWN0SWQsXG4gICAgICAgIHBhcnNlRmxvYXQocHJvZHVjdC5wcmljZS5yZXBsYWNlKC9bXjAtOS4tXSsvZyxcIlwiKSkgfHwgbnVsbCxcbiAgICAgICAgcHJvZHVjdC5hdmFpbGFiaWxpdHkgfHwgJ1Vua25vd24nXG4gICAgICBdO1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KHByaWNlUXVlcnksIHByaWNlVmFsdWVzKTtcbiAgICB9XG5cbiAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0NPTU1JVCcpO1xuICAgIGNvbnNvbGUubG9nKGBJbnNlcnRlZC9VcGRhdGVkIHByb2R1Y3QgaW4gZGF0YWJhc2U6ICR7cHJvZHVjdC50aXRsZX1gKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbnNlcnRpbmcvdXBkYXRpbmcgcHJvZHVjdCBpbiBkYXRhYmFzZTonLCBlKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBjbGllbnQucmVsZWFzZSgpO1xuICB9XG59O1xuXG5jb25zdCBmZXRjaFByb2R1Y3RzID0gYXN5bmMgKHRlcm0sIHNvdXJjZSwgc29ydEJ5LCBwYWdlID0gMSkgPT4ge1xuICBsZXQgdXJsO1xuICBsZXQgcGFyYW1zO1xuXG4gIC8vIFJlbW92ZSBhbnkgcXVvdGVzIGZyb20gdGhlIEFQSSBrZXlcbiAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuU0NSQVBFUl9BUElfS0VZLnJlcGxhY2UoL1snJ1wiXSsvZywgJycpO1xuXG4gIGlmIChzb3VyY2UgPT09ICdhbWF6b24nKSB7XG4gICAgaWYgKHRlcm0ubWF0Y2goL15bQS1aMC05XXsxMH0kLykpIHsgIC8vIENoZWNrIGlmIHRlcm0gaXMgYW4gQVNJTlxuICAgICAgdXJsID0gYGh0dHBzOi8vYXBpLnNjcmFwZXJhcGkuY29tL3N0cnVjdHVyZWQvYW1hem9uL3Byb2R1Y3RgO1xuICAgICAgcGFyYW1zID0ge1xuICAgICAgICBhcGlfa2V5OiBhcGlLZXksXG4gICAgICAgIGFzaW46IHRlcm0sXG4gICAgICAgIGNvdW50cnlfY29kZTogJ3VzJyxcbiAgICAgICAgdGxkOiAnY29tJ1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdXJsID0gYGh0dHBzOi8vYXBpLnNjcmFwZXJhcGkuY29tL3N0cnVjdHVyZWQvYW1hem9uL3NlYXJjaGA7XG4gICAgICBwYXJhbXMgPSB7XG4gICAgICAgIGFwaV9rZXk6IGFwaUtleSxcbiAgICAgICAgcXVlcnk6IHRlcm0sXG4gICAgICAgIGNvdW50cnk6ICd1cycsXG4gICAgICAgIHBhZ2U6IHBhZ2UudG9TdHJpbmcoKSxcbiAgICAgICAgc29ydF9ieTogc29ydEJ5IHx8ICcnLFxuICAgICAgICBleGNsdWRlX3Nwb25zb3JlZDogJ3RydWUnXG4gICAgICB9O1xuICAgIH1cbiAgfSBlbHNlIGlmIChzb3VyY2UgPT09ICd3YWxtYXJ0Jykge1xuICAgIGlmICh0ZXJtLm1hdGNoKC9eWzAtOV0rJC8pKSB7ICAvLyBDaGVjayBpZiB0ZXJtIGlzIGEgV2FsbWFydCBwcm9kdWN0IElEXG4gICAgICB1cmwgPSBgaHR0cHM6Ly9hcGkuc2NyYXBlcmFwaS5jb20vc3RydWN0dXJlZC93YWxtYXJ0L3Byb2R1Y3RgO1xuICAgICAgcGFyYW1zID0ge1xuICAgICAgICBhcGlfa2V5OiBhcGlLZXksXG4gICAgICAgIHByb2R1Y3RfaWQ6IHRlcm0sXG4gICAgICAgIGNvdW50cnlfY29kZTogJ3VzJyxcbiAgICAgICAgdGxkOiAnY29tJ1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdXJsID0gYGh0dHBzOi8vYXBpLnNjcmFwZXJhcGkuY29tL3N0cnVjdHVyZWQvd2FsbWFydC9zZWFyY2hgO1xuICAgICAgcGFyYW1zID0ge1xuICAgICAgICBhcGlfa2V5OiBhcGlLZXksXG4gICAgICAgIHF1ZXJ5OiB0ZXJtLFxuICAgICAgICBjb3VudHJ5OiAndXMnLFxuICAgICAgICBwYWdlOiBwYWdlLnRvU3RyaW5nKCksXG4gICAgICAgIHNvcnRfYnk6IHNvcnRCeSB8fCAnJyxcbiAgICAgICAgZXhjbHVkZV9zcG9uc29yZWQ6ICd0cnVlJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBGZXRjaGluZyAke3NvdXJjZX0gcmVzdWx0cyBmb3IgdGVybTogXCIke3Rlcm19XCIsIHBhZ2U6ICR7cGFnZX0sIHNvcnRCeTogJHtzb3J0Qnl9YCk7XG4gICAgY29uc29sZS5sb2coJ0FQSSBSZXF1ZXN0IFVSTDonLCB1cmwpO1xuICAgIGNvbnNvbGUubG9nKCdBUEkgUmVxdWVzdCBQYXJhbXM6JywgeyAuLi5wYXJhbXMsIGFwaV9rZXk6ICdbUkVEQUNURURdJyB9KTtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KHVybCwgeyBwYXJhbXMsIHRpbWVvdXQ6IDMwMDAwIH0pO1xuICAgIGNvbnNvbGUubG9nKGBSYXcgQVBJIHJlc3BvbnNlIGZyb20gJHtzb3VyY2V9OmAsIEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEsIG51bGwsIDIpKTtcblxuICAgIGxldCBqc29uRGF0YSA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICBpZiAoKHNvdXJjZSA9PT0gJ2FtYXpvbicgJiYgdGVybS5tYXRjaCgvXltBLVowLTldezEwfSQvKSkgfHwgXG4gICAgICAgIChzb3VyY2UgPT09ICd3YWxtYXJ0JyAmJiB0ZXJtLm1hdGNoKC9eWzAtOV0rJC8pKSkge1xuICAgICAgLy8gSWYgaXQncyBhIHByb2R1Y3QgcXVlcnksIHdyYXAgdGhlIHJlc3VsdCBpbiBhbiBhcnJheVxuICAgICAgY29uc3QgbWFwcGVkUHJvZHVjdCA9IG1hcFByb2R1Y3QoanNvbkRhdGEsIHNvdXJjZSk7XG4gICAgICBhd2FpdCBpbnNlcnRQcm9kdWN0KG1hcHBlZFByb2R1Y3QpO1xuICAgICAgcmV0dXJuIHsgcmVzdWx0czogW21hcHBlZFByb2R1Y3RdLCB0b3RhbFBhZ2VzOiAxIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvciBzZWFyY2ggcXVlcmllcywgcHJvY2VzcyBhcyBiZWZvcmVcbiAgICAgIGxldCByZXN1bHRzID0gW107XG4gICAgICBsZXQgdG90YWxQYWdlcyA9IDE7XG5cbiAgICAgIGlmIChzb3VyY2UgPT09ICd3YWxtYXJ0JyAmJiBqc29uRGF0YS5pdGVtcyAmJiBBcnJheS5pc0FycmF5KGpzb25EYXRhLml0ZW1zKSkge1xuICAgICAgICByZXN1bHRzID0ganNvbkRhdGEuaXRlbXM7XG4gICAgICAgIHRvdGFsUGFnZXMgPSBqc29uRGF0YS50b3RhbF9wYWdlcyB8fCAxO1xuICAgICAgfSBlbHNlIGlmIChzb3VyY2UgPT09ICdhbWF6b24nICYmIGpzb25EYXRhLnJlc3VsdHMpIHtcbiAgICAgICAgcmVzdWx0cyA9IGpzb25EYXRhLnJlc3VsdHM7XG4gICAgICAgIHRvdGFsUGFnZXMgPSBqc29uRGF0YS50b3RhbF9wYWdlcyB8fCAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBBUEkgcmVzcG9uc2Ugc3RydWN0dXJlIGZyb20gJHtzb3VyY2V9OmAsIGpzb25EYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIEFQSSByZXNwb25zZSBzdHJ1Y3R1cmUgZnJvbSAke3NvdXJjZX1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbWFwcGVkUmVzdWx0cyA9IHJlc3VsdHMubWFwKGl0ZW0gPT4gbWFwUHJvZHVjdChpdGVtLCBzb3VyY2UpKTtcbiAgICAgIGNvbnNvbGUubG9nKGBNYXBwZWQgcmVzdWx0cyBmb3IgJHtzb3VyY2V9OmAsIEpTT04uc3RyaW5naWZ5KG1hcHBlZFJlc3VsdHMsIG51bGwsIDIpKTtcblxuICAgICAgLy8gSW5zZXJ0IGFsbCBwcm9kdWN0cyBpbnRvIHRoZSBkYXRhYmFzZVxuICAgICAgZm9yIChjb25zdCBwcm9kdWN0IG9mIG1hcHBlZFJlc3VsdHMpIHtcbiAgICAgICAgYXdhaXQgaW5zZXJ0UHJvZHVjdChwcm9kdWN0KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgcmVzdWx0czogZmlsdGVyU3BvbnNvcmVkUHJvZHVjdHMobWFwcGVkUmVzdWx0cyksIHRvdGFsUGFnZXMgfTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgRXJyb3IgZmV0Y2hpbmcgZGF0YSBmcm9tICR7c291cmNlfSBBUEk6YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgY29uc29sZS5lcnJvcihgRXJyb3IgZGV0YWlsczpgLCBlcnJvci5yZXNwb25zZSA/IGVycm9yLnJlc3BvbnNlLmRhdGEgOiAnTm8gcmVzcG9uc2UgZGF0YScpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnR0VUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuZW5kKCk7XG4gIH1cblxuICBjb25zdCB7IHRlcm0sIHBhZ2UgPSAnMScsIHNvcnRfYnksIHNvdXJjZSA9ICdhbGwnIH0gPSByZXEucXVlcnk7XG5cbiAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblxuICBjb25zdCByZXN1bHRzID0gW107XG5cbiAgY29uc3Qgc3RyZWFtUmVzdWx0cyA9IGFzeW5jIChzb3VyY2VUb0ZldGNoKSA9PiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgc2VhcmNoOiR7c291cmNlVG9GZXRjaH06JHt0ZXJtfToke3NvcnRfYnl9OiR7cGFnZX1gO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjYWNoZWRSZXN1bHRzID0gYXdhaXQgY2FjaGVIZWxwZXIuZ2V0KGNhY2hlS2V5KTtcblxuICAgICAgaWYgKGNhY2hlZFJlc3VsdHMpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFVzaW5nIGNhY2hlZCByZXN1bHRzIGZvciAke3NvdXJjZVRvRmV0Y2h9YCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7IHNvdXJjZTogc291cmNlVG9GZXRjaCwgLi4uSlNPTi5wYXJzZShjYWNoZWRSZXN1bHRzKSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBGZXRjaGluZyBmcmVzaCByZXN1bHRzIGZvciAke3NvdXJjZVRvRmV0Y2h9YCk7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0czogc291cmNlUmVzdWx0cywgdG90YWxQYWdlcyB9ID0gYXdhaXQgZmV0Y2hQcm9kdWN0cyh0ZXJtLCBzb3VyY2VUb0ZldGNoLCBzb3J0X2J5LCBwYXJzZUludChwYWdlKSk7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7IHNvdXJjZTogc291cmNlVG9GZXRjaCwgcmVzdWx0czogc291cmNlUmVzdWx0cywgdG90YWxQYWdlcyB9KTtcbiAgICAgICAgYXdhaXQgY2FjaGVIZWxwZXIuc2V0KGNhY2hlS2V5LCBKU09OLnN0cmluZ2lmeSh7IHJlc3VsdHM6IHNvdXJjZVJlc3VsdHMsIHRvdGFsUGFnZXMgfSksIHsgRVg6IDM2MDAgfSk7IC8vIENhY2hlIGZvciAxIGhvdXJcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRXJyb3Igc3RyZWFtaW5nIHJlc3VsdHMgZnJvbSAke3NvdXJjZVRvRmV0Y2h9OmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgcmVzdWx0cy5wdXNoKHsgXG4gICAgICAgIHNvdXJjZTogc291cmNlVG9GZXRjaCwgXG4gICAgICAgIGVycm9yOiBgRmFpbGVkIHRvIGZldGNoIGRhdGEgZnJvbSAke3NvdXJjZVRvRmV0Y2h9OiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZGV0YWlsczogZXJyb3IucmVzcG9uc2UgPyBlcnJvci5yZXNwb25zZS5kYXRhIDogJ05vIHJlc3BvbnNlIGRhdGEnXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHNvdXJjZSA9PT0gJ2FsbCcpIHtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBzdHJlYW1SZXN1bHRzKCd3YWxtYXJ0JyksXG4gICAgICBzdHJlYW1SZXN1bHRzKCdhbWF6b24nKVxuICAgIF0pO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHN0cmVhbVJlc3VsdHMoc291cmNlKTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHJlc3VsdHMpO1xufSJdLCJuYW1lcyI6WyJheGlvcyIsIlJlZGlzIiwiUG9vbCIsInJlZGlzQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsIm1heFJldHJpZXNQZXJSZXF1ZXN0IiwicmV0cnlTdHJhdGVneSIsIm9uIiwiZXJyIiwiY29uc29sZSIsIndhcm4iLCJlcnJvciIsInBvb2wiLCJjb25uZWN0aW9uU3RyaW5nIiwiREFUQUJBU0VfVVJMIiwic3NsIiwicmVqZWN0VW5hdXRob3JpemVkIiwicXVlcnkiLCJyZXMiLCJsb2ciLCJjYWNoZUhlbHBlciIsImdldCIsImtleSIsInNldCIsInZhbHVlIiwib3B0aW9ucyIsIm1hcFByb2R1Y3QiLCJpdGVtIiwic291cmNlIiwiSlNPTiIsInN0cmluZ2lmeSIsImlkIiwiYnJhbmQiLCJ0aXRsZSIsIm5hbWUiLCJsaW5rIiwidXJsIiwiaW1hZ2UiLCJpc1ByaW1lIiwicmF0aW5nIiwiYXZlcmFnZV9yYXRpbmciLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicmF0aW5nc1RvdGFsIiwibnVtYmVyX29mX3Jldmlld3MiLCJwcmljZSIsInByaWNlX2N1cnJlbmN5IiwiYXZhaWxhYmlsaXR5Iiwic3BvbnNvcmVkIiwiZnVsbF9kZXNjcmlwdGlvbiIsInByb2R1Y3RfY2F0ZWdvcnkiLCJtb2RlbCIsInNtYWxsX2Rlc2NyaXB0aW9uIiwiYXNpbiIsImltYWdlcyIsImhhc19wcmltZSIsInN0YXJzIiwidG90YWxfcmV2aWV3cyIsInJhdGluZ3NfdG90YWwiLCJwcmljaW5nIiwiZmlsdGVyU3BvbnNvcmVkUHJvZHVjdHMiLCJwcm9kdWN0cyIsImZpbHRlciIsInByb2R1Y3QiLCJpbnNlcnRQcm9kdWN0IiwiY2xpZW50IiwiY29ubmVjdCIsInByb2R1Y3RRdWVyeSIsInByb2R1Y3RWYWx1ZXMiLCJwcm9kdWN0UmVzdWx0IiwicHJvZHVjdElkIiwicm93cyIsInByb2R1Y3RfaWQiLCJkZXRhaWxzUXVlcnkiLCJkZXRhaWxzVmFsdWVzIiwicGFyc2VGbG9hdCIsInBhcnNlSW50IiwicHJpY2VRdWVyeSIsInByaWNlVmFsdWVzIiwicmVwbGFjZSIsImUiLCJyZWxlYXNlIiwiZmV0Y2hQcm9kdWN0cyIsInRlcm0iLCJzb3J0QnkiLCJwYWdlIiwicGFyYW1zIiwiYXBpS2V5IiwiU0NSQVBFUl9BUElfS0VZIiwibWF0Y2giLCJhcGlfa2V5IiwiY291bnRyeV9jb2RlIiwidGxkIiwiY291bnRyeSIsInRvU3RyaW5nIiwic29ydF9ieSIsImV4Y2x1ZGVfc3BvbnNvcmVkIiwicmVzcG9uc2UiLCJ0aW1lb3V0IiwiZGF0YSIsImpzb25EYXRhIiwibWFwcGVkUHJvZHVjdCIsInJlc3VsdHMiLCJ0b3RhbFBhZ2VzIiwiaXRlbXMiLCJBcnJheSIsImlzQXJyYXkiLCJ0b3RhbF9wYWdlcyIsIkVycm9yIiwibWFwcGVkUmVzdWx0cyIsIm1hcCIsIm1lc3NhZ2UiLCJoYW5kbGVyIiwicmVxIiwibWV0aG9kIiwic3RhdHVzIiwiZW5kIiwic2V0SGVhZGVyIiwic3RyZWFtUmVzdWx0cyIsInNvdXJjZVRvRmV0Y2giLCJjYWNoZUtleSIsImNhY2hlZFJlc3VsdHMiLCJwdXNoIiwicGFyc2UiLCJzb3VyY2VSZXN1bHRzIiwiRVgiLCJkZXRhaWxzIiwiUHJvbWlzZSIsImFsbCIsImpzb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/search.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();