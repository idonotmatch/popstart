"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/search";
exports.ids = ["pages/api/search"];
exports.modules = {

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/search.js */ \"(api)/./pages/api/search.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/search\",\n        pathname: \"/api/search\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnNlYXJjaCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGc2VhcmNoLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ2tEO0FBQ2xEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxpREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsaURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktZ3JhcGhxbC1wcm9qZWN0Lz85YzRmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvc2VhcmNoLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc2VhcmNoXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvc2VhcmNoXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/search.js":
/*!*****************************!*\
  !*** ./pages/api/search.js ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_1__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n// Initialize Redis client with fallback\nlet redisClient;\ntry {\n    redisClient = new (ioredis__WEBPACK_IMPORTED_MODULE_1___default())(process.env.REDIS_URL, {\n        maxRetriesPerRequest: 1,\n        retryStrategy: ()=>null\n    });\n    redisClient.on(\"error\", (err)=>{\n        console.warn(\"Redis Client Error:\", err);\n        redisClient = null; // Disable Redis client on error\n    });\n} catch (error) {\n    console.warn(\"Failed to initialize Redis:\", error);\n    redisClient = null;\n}\n// Cache helper function\nconst cacheHelper = {\n    get: async (key)=>{\n        if (redisClient) {\n            try {\n                return await redisClient.get(key);\n            } catch (error) {\n                console.warn(\"Redis get error:\", error);\n            }\n        }\n        return null;\n    },\n    set: async (key, value, options)=>{\n        if (redisClient) {\n            try {\n                await redisClient.set(key, value, options);\n            } catch (error) {\n                console.warn(\"Redis set error:\", error);\n            }\n        }\n    }\n};\nconst mapProduct = (item, source)=>{\n    if (source === \"walmart\") {\n        // Add more detailed logging for Walmart item structure\n        console.log(\"Walmart item structure:\", JSON.stringify(item, null, 2));\n        return {\n            asin: item.id || \"\",\n            brand: item.brand || \"N/A\",\n            title: item.name || \"\",\n            link: item.url || \"\",\n            image: item.image || \"\",\n            isPrime: false,\n            rating: item.rating?.average_rating ? Number(item.rating.average_rating).toFixed(1) : \"0.0\",\n            ratingsTotal: item.rating?.number_of_reviews || 0,\n            price: item.price ? `${item.price_currency || \"$\"}${Number(item.price).toFixed(2)}` : \"N/A\",\n            availability: item.availability || \"Unavailable\",\n            source: \"walmart\",\n            sponsored: item.sponsored || false\n        };\n    } else if (source === \"amazon\") {\n        return {\n            asin: item.asin || \"\",\n            brand: item.brand || \"N/A\",\n            title: item.name || \"\",\n            link: item.url || \"\",\n            image: item.image || \"\",\n            isPrime: item.has_prime || false,\n            rating: item.stars ? Number(item.stars).toFixed(1) : \"0.0\",\n            ratingsTotal: item.total_reviews || 0,\n            price: item.price ? `$${Number(item.price).toFixed(2)}` : \"N/A\",\n            availability: item.availability || \"Unavailable\",\n            source: \"amazon\",\n            sponsored: item.sponsored || false\n        };\n    }\n};\nconst filterSponsoredProducts = (products)=>{\n    return products.filter((product)=>!product.sponsored);\n};\nconst fetchProducts = async (term, source, sortBy, page = 1)=>{\n    const url = `https://api.scraperapi.com/structured/${source}/search`;\n    const params = {\n        api_key: process.env.SCRAPER_API_KEY,\n        query: term,\n        country: \"us\",\n        page: page.toString(),\n        sort_by: sortBy || \"\",\n        exclude_sponsored: \"true\"\n    };\n    try {\n        console.log(`Fetching ${source} results for term: \"${term}\", page: ${page}, sortBy: ${sortBy}`);\n        const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(url, {\n            params,\n            timeout: 30000\n        }); // 30 seconds timeout\n        console.log(`Raw API response from ${source}:`, JSON.stringify(response.data, null, 2));\n        let jsonData = response.data;\n        let results = [];\n        let totalPages = 1;\n        if (source === \"walmart\") {\n            // Add more detailed checks for Walmart response structure\n            if (jsonData.items && Array.isArray(jsonData.items)) {\n                results = jsonData.items;\n                totalPages = jsonData.total_pages || 1;\n            } else {\n                console.error(\"Unexpected Walmart API response structure:\", jsonData);\n                throw new Error(\"Unexpected Walmart API response structure\");\n            }\n        } else if (source === \"amazon\" && jsonData.results) {\n            results = jsonData.results;\n            totalPages = jsonData.total_pages || 1;\n        } else {\n            console.error(`Invalid API response structure from ${source}:`, jsonData);\n            throw new Error(`Invalid API response structure from ${source}`);\n        }\n        const mappedResults = results.map((item)=>mapProduct(item, source));\n        console.log(`Mapped results for ${source}:`, JSON.stringify(mappedResults, null, 2));\n        return {\n            results: filterSponsoredProducts(mappedResults),\n            totalPages\n        };\n    } catch (error) {\n        console.error(`Error fetching data from ${source} API:`, error.message);\n        console.error(`Error details:`, error.response ? error.response.data : \"No response data\");\n        throw error;\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"GET\") {\n        return res.status(405).end();\n    }\n    const { term, page = \"1\", sort_by, source = \"all\" } = req.query;\n    res.setHeader(\"Content-Type\", \"application/json\");\n    const results = [];\n    const streamResults = async (sourceToFetch)=>{\n        const cacheKey = `search:${sourceToFetch}:${term}:${sort_by}:${page}`;\n        try {\n            const cachedResults = await cacheHelper.get(cacheKey);\n            if (cachedResults) {\n                console.log(`Using cached results for ${sourceToFetch}`);\n                results.push({\n                    source: sourceToFetch,\n                    ...JSON.parse(cachedResults)\n                });\n            } else {\n                console.log(`Fetching fresh results for ${sourceToFetch}`);\n                const { results: sourceResults, totalPages } = await fetchProducts(term, sourceToFetch, sort_by, parseInt(page));\n                results.push({\n                    source: sourceToFetch,\n                    results: sourceResults,\n                    totalPages\n                });\n                await cacheHelper.set(cacheKey, JSON.stringify({\n                    results: sourceResults,\n                    totalPages\n                }), {\n                    EX: 3600\n                }); // Cache for 1 hour\n            }\n        } catch (error) {\n            console.error(`Error streaming results from ${sourceToFetch}:`, error.message);\n            results.push({\n                source: sourceToFetch,\n                error: `Failed to fetch data from ${sourceToFetch}: ${error.message}`,\n                details: error.response ? error.response.data : \"No response data\"\n            });\n        }\n    };\n    if (source === \"all\") {\n        await Promise.all([\n            streamResults(\"walmart\"),\n            streamResults(\"amazon\")\n        ]);\n    } else {\n        await streamResults(source);\n    }\n    res.status(200).json(results);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFFeUUsY0FBYyxFQUFFLEVBQUV6RSxNQUFNZ0UsT0FBTyxDQUFDLENBQUM7Z0JBQ3JFaUIsU0FBU2pGLE1BQU1tRCxRQUFRLEdBQUduRCxNQUFNbUQsUUFBUSxDQUFDRSxJQUFJLEdBQUc7WUFDbEQ7UUFDRjtJQUNGO0lBRUEsSUFBSTVDLFdBQVcsT0FBTztRQUNwQixNQUFNeUUsUUFBUUMsR0FBRyxDQUFDO1lBQ2hCWCxjQUFjO1lBQ2RBLGNBQWM7U0FDZjtJQUNILE9BQU87UUFDTCxNQUFNQSxjQUFjL0Q7SUFDdEI7SUFFQTBELElBQUlFLE1BQU0sQ0FBQyxLQUFLZSxJQUFJLENBQUM3QjtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL215LWdyYXBocWwtcHJvamVjdC8uL3BhZ2VzL2FwaS9zZWFyY2guanM/NWQzYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IFJlZGlzIGZyb20gJ2lvcmVkaXMnO1xuXG4vLyBJbml0aWFsaXplIFJlZGlzIGNsaWVudCB3aXRoIGZhbGxiYWNrXG5sZXQgcmVkaXNDbGllbnQ7XG50cnkge1xuICByZWRpc0NsaWVudCA9IG5ldyBSZWRpcyhwcm9jZXNzLmVudi5SRURJU19VUkwsIHtcbiAgICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogMSxcbiAgICByZXRyeVN0cmF0ZWd5OiAoKSA9PiBudWxsXG4gIH0pO1xuICByZWRpc0NsaWVudC5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgY29uc29sZS53YXJuKCdSZWRpcyBDbGllbnQgRXJyb3I6JywgZXJyKTtcbiAgICByZWRpc0NsaWVudCA9IG51bGw7IC8vIERpc2FibGUgUmVkaXMgY2xpZW50IG9uIGVycm9yXG4gIH0pO1xufSBjYXRjaCAoZXJyb3IpIHtcbiAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBSZWRpczonLCBlcnJvcik7XG4gIHJlZGlzQ2xpZW50ID0gbnVsbDtcbn1cblxuLy8gQ2FjaGUgaGVscGVyIGZ1bmN0aW9uXG5jb25zdCBjYWNoZUhlbHBlciA9IHtcbiAgZ2V0OiBhc3luYyAoa2V5KSA9PiB7XG4gICAgaWYgKHJlZGlzQ2xpZW50KSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgcmVkaXNDbGllbnQuZ2V0KGtleSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1JlZGlzIGdldCBlcnJvcjonLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9LFxuICBzZXQ6IGFzeW5jIChrZXksIHZhbHVlLCBvcHRpb25zKSA9PiB7XG4gICAgaWYgKHJlZGlzQ2xpZW50KSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCByZWRpc0NsaWVudC5zZXQoa2V5LCB2YWx1ZSwgb3B0aW9ucyk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1JlZGlzIHNldCBlcnJvcjonLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBtYXBQcm9kdWN0ID0gKGl0ZW0sIHNvdXJjZSkgPT4ge1xuICBpZiAoc291cmNlID09PSAnd2FsbWFydCcpIHtcbiAgICAvLyBBZGQgbW9yZSBkZXRhaWxlZCBsb2dnaW5nIGZvciBXYWxtYXJ0IGl0ZW0gc3RydWN0dXJlXG4gICAgY29uc29sZS5sb2coJ1dhbG1hcnQgaXRlbSBzdHJ1Y3R1cmU6JywgSlNPTi5zdHJpbmdpZnkoaXRlbSwgbnVsbCwgMikpO1xuICAgIHJldHVybiB7XG4gICAgICBhc2luOiBpdGVtLmlkIHx8ICcnLFxuICAgICAgYnJhbmQ6IGl0ZW0uYnJhbmQgfHwgJ04vQScsXG4gICAgICB0aXRsZTogaXRlbS5uYW1lIHx8ICcnLFxuICAgICAgbGluazogaXRlbS51cmwgfHwgJycsXG4gICAgICBpbWFnZTogaXRlbS5pbWFnZSB8fCAnJyxcbiAgICAgIGlzUHJpbWU6IGZhbHNlLFxuICAgICAgcmF0aW5nOiBpdGVtLnJhdGluZz8uYXZlcmFnZV9yYXRpbmcgPyBOdW1iZXIoaXRlbS5yYXRpbmcuYXZlcmFnZV9yYXRpbmcpLnRvRml4ZWQoMSkgOiAnMC4wJyxcbiAgICAgIHJhdGluZ3NUb3RhbDogaXRlbS5yYXRpbmc/Lm51bWJlcl9vZl9yZXZpZXdzIHx8IDAsXG4gICAgICBwcmljZTogaXRlbS5wcmljZSA/IGAke2l0ZW0ucHJpY2VfY3VycmVuY3kgfHwgJyQnfSR7TnVtYmVyKGl0ZW0ucHJpY2UpLnRvRml4ZWQoMil9YCA6IFwiTi9BXCIsXG4gICAgICBhdmFpbGFiaWxpdHk6IGl0ZW0uYXZhaWxhYmlsaXR5IHx8IFwiVW5hdmFpbGFibGVcIixcbiAgICAgIHNvdXJjZTogJ3dhbG1hcnQnLFxuICAgICAgc3BvbnNvcmVkOiBpdGVtLnNwb25zb3JlZCB8fCBmYWxzZSxcbiAgICB9O1xuICB9IGVsc2UgaWYgKHNvdXJjZSA9PT0gJ2FtYXpvbicpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYXNpbjogaXRlbS5hc2luIHx8ICcnLFxuICAgICAgYnJhbmQ6IGl0ZW0uYnJhbmQgfHwgJ04vQScsXG4gICAgICB0aXRsZTogaXRlbS5uYW1lIHx8ICcnLFxuICAgICAgbGluazogaXRlbS51cmwgfHwgJycsXG4gICAgICBpbWFnZTogaXRlbS5pbWFnZSB8fCAnJyxcbiAgICAgIGlzUHJpbWU6IGl0ZW0uaGFzX3ByaW1lIHx8IGZhbHNlLFxuICAgICAgcmF0aW5nOiBpdGVtLnN0YXJzID8gTnVtYmVyKGl0ZW0uc3RhcnMpLnRvRml4ZWQoMSkgOiAnMC4wJyxcbiAgICAgIHJhdGluZ3NUb3RhbDogaXRlbS50b3RhbF9yZXZpZXdzIHx8IDAsXG4gICAgICBwcmljZTogaXRlbS5wcmljZSA/IGAkJHtOdW1iZXIoaXRlbS5wcmljZSkudG9GaXhlZCgyKX1gIDogXCJOL0FcIixcbiAgICAgIGF2YWlsYWJpbGl0eTogaXRlbS5hdmFpbGFiaWxpdHkgfHwgXCJVbmF2YWlsYWJsZVwiLFxuICAgICAgc291cmNlOiAnYW1hem9uJyxcbiAgICAgIHNwb25zb3JlZDogaXRlbS5zcG9uc29yZWQgfHwgZmFsc2UsXG4gICAgfTtcbiAgfVxufTtcblxuY29uc3QgZmlsdGVyU3BvbnNvcmVkUHJvZHVjdHMgPSAocHJvZHVjdHMpID0+IHtcbiAgcmV0dXJuIHByb2R1Y3RzLmZpbHRlcihwcm9kdWN0ID0+ICFwcm9kdWN0LnNwb25zb3JlZCk7XG59O1xuXG5jb25zdCBmZXRjaFByb2R1Y3RzID0gYXN5bmMgKHRlcm0sIHNvdXJjZSwgc29ydEJ5LCBwYWdlID0gMSkgPT4ge1xuICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9hcGkuc2NyYXBlcmFwaS5jb20vc3RydWN0dXJlZC8ke3NvdXJjZX0vc2VhcmNoYDtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIGFwaV9rZXk6IHByb2Nlc3MuZW52LlNDUkFQRVJfQVBJX0tFWSxcbiAgICBxdWVyeTogdGVybSxcbiAgICBjb3VudHJ5OiAndXMnLFxuICAgIHBhZ2U6IHBhZ2UudG9TdHJpbmcoKSxcbiAgICBzb3J0X2J5OiBzb3J0QnkgfHwgJycsXG4gICAgZXhjbHVkZV9zcG9uc29yZWQ6ICd0cnVlJ1xuICB9O1xuXG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYEZldGNoaW5nICR7c291cmNlfSByZXN1bHRzIGZvciB0ZXJtOiBcIiR7dGVybX1cIiwgcGFnZTogJHtwYWdlfSwgc29ydEJ5OiAke3NvcnRCeX1gKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldCh1cmwsIHsgcGFyYW1zLCB0aW1lb3V0OiAzMDAwMCB9KTsgLy8gMzAgc2Vjb25kcyB0aW1lb3V0XG4gICAgY29uc29sZS5sb2coYFJhdyBBUEkgcmVzcG9uc2UgZnJvbSAke3NvdXJjZX06YCwgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSwgbnVsbCwgMikpO1xuXG4gICAgbGV0IGpzb25EYXRhID0gcmVzcG9uc2UuZGF0YTtcblxuICAgIGxldCByZXN1bHRzID0gW107XG4gICAgbGV0IHRvdGFsUGFnZXMgPSAxO1xuXG4gICAgaWYgKHNvdXJjZSA9PT0gJ3dhbG1hcnQnKSB7XG4gICAgICAvLyBBZGQgbW9yZSBkZXRhaWxlZCBjaGVja3MgZm9yIFdhbG1hcnQgcmVzcG9uc2Ugc3RydWN0dXJlXG4gICAgICBpZiAoanNvbkRhdGEuaXRlbXMgJiYgQXJyYXkuaXNBcnJheShqc29uRGF0YS5pdGVtcykpIHtcbiAgICAgICAgcmVzdWx0cyA9IGpzb25EYXRhLml0ZW1zO1xuICAgICAgICB0b3RhbFBhZ2VzID0ganNvbkRhdGEudG90YWxfcGFnZXMgfHwgMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgV2FsbWFydCBBUEkgcmVzcG9uc2Ugc3RydWN0dXJlOicsIGpzb25EYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIFdhbG1hcnQgQVBJIHJlc3BvbnNlIHN0cnVjdHVyZScpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAnYW1hem9uJyAmJiBqc29uRGF0YS5yZXN1bHRzKSB7XG4gICAgICByZXN1bHRzID0ganNvbkRhdGEucmVzdWx0cztcbiAgICAgIHRvdGFsUGFnZXMgPSBqc29uRGF0YS50b3RhbF9wYWdlcyB8fCAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBJbnZhbGlkIEFQSSByZXNwb25zZSBzdHJ1Y3R1cmUgZnJvbSAke3NvdXJjZX06YCwganNvbkRhdGEpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIEFQSSByZXNwb25zZSBzdHJ1Y3R1cmUgZnJvbSAke3NvdXJjZX1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXBwZWRSZXN1bHRzID0gcmVzdWx0cy5tYXAoaXRlbSA9PiBtYXBQcm9kdWN0KGl0ZW0sIHNvdXJjZSkpO1xuICAgIGNvbnNvbGUubG9nKGBNYXBwZWQgcmVzdWx0cyBmb3IgJHtzb3VyY2V9OmAsIEpTT04uc3RyaW5naWZ5KG1hcHBlZFJlc3VsdHMsIG51bGwsIDIpKTtcblxuICAgIHJldHVybiB7IHJlc3VsdHM6IGZpbHRlclNwb25zb3JlZFByb2R1Y3RzKG1hcHBlZFJlc3VsdHMpLCB0b3RhbFBhZ2VzIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgRXJyb3IgZmV0Y2hpbmcgZGF0YSBmcm9tICR7c291cmNlfSBBUEk6YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgY29uc29sZS5lcnJvcihgRXJyb3IgZGV0YWlsczpgLCBlcnJvci5yZXNwb25zZSA/IGVycm9yLnJlc3BvbnNlLmRhdGEgOiAnTm8gcmVzcG9uc2UgZGF0YScpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnR0VUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuZW5kKCk7XG4gIH1cblxuICBjb25zdCB7IHRlcm0sIHBhZ2UgPSAnMScsIHNvcnRfYnksIHNvdXJjZSA9ICdhbGwnIH0gPSByZXEucXVlcnk7XG5cbiAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblxuICBjb25zdCByZXN1bHRzID0gW107XG5cbiAgY29uc3Qgc3RyZWFtUmVzdWx0cyA9IGFzeW5jIChzb3VyY2VUb0ZldGNoKSA9PiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgc2VhcmNoOiR7c291cmNlVG9GZXRjaH06JHt0ZXJtfToke3NvcnRfYnl9OiR7cGFnZX1gO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjYWNoZWRSZXN1bHRzID0gYXdhaXQgY2FjaGVIZWxwZXIuZ2V0KGNhY2hlS2V5KTtcblxuICAgICAgaWYgKGNhY2hlZFJlc3VsdHMpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFVzaW5nIGNhY2hlZCByZXN1bHRzIGZvciAke3NvdXJjZVRvRmV0Y2h9YCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7IHNvdXJjZTogc291cmNlVG9GZXRjaCwgLi4uSlNPTi5wYXJzZShjYWNoZWRSZXN1bHRzKSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBGZXRjaGluZyBmcmVzaCByZXN1bHRzIGZvciAke3NvdXJjZVRvRmV0Y2h9YCk7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0czogc291cmNlUmVzdWx0cywgdG90YWxQYWdlcyB9ID0gYXdhaXQgZmV0Y2hQcm9kdWN0cyh0ZXJtLCBzb3VyY2VUb0ZldGNoLCBzb3J0X2J5LCBwYXJzZUludChwYWdlKSk7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7IHNvdXJjZTogc291cmNlVG9GZXRjaCwgcmVzdWx0czogc291cmNlUmVzdWx0cywgdG90YWxQYWdlcyB9KTtcbiAgICAgICAgYXdhaXQgY2FjaGVIZWxwZXIuc2V0KGNhY2hlS2V5LCBKU09OLnN0cmluZ2lmeSh7IHJlc3VsdHM6IHNvdXJjZVJlc3VsdHMsIHRvdGFsUGFnZXMgfSksIHsgRVg6IDM2MDAgfSk7IC8vIENhY2hlIGZvciAxIGhvdXJcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRXJyb3Igc3RyZWFtaW5nIHJlc3VsdHMgZnJvbSAke3NvdXJjZVRvRmV0Y2h9OmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgcmVzdWx0cy5wdXNoKHsgXG4gICAgICAgIHNvdXJjZTogc291cmNlVG9GZXRjaCwgXG4gICAgICAgIGVycm9yOiBgRmFpbGVkIHRvIGZldGNoIGRhdGEgZnJvbSAke3NvdXJjZVRvRmV0Y2h9OiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZGV0YWlsczogZXJyb3IucmVzcG9uc2UgPyBlcnJvci5yZXNwb25zZS5kYXRhIDogJ05vIHJlc3BvbnNlIGRhdGEnXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHNvdXJjZSA9PT0gJ2FsbCcpIHtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBzdHJlYW1SZXN1bHRzKCd3YWxtYXJ0JyksXG4gICAgICBzdHJlYW1SZXN1bHRzKCdhbWF6b24nKVxuICAgIF0pO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHN0cmVhbVJlc3VsdHMoc291cmNlKTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHJlc3VsdHMpO1xufSJdLCJuYW1lcyI6WyJheGlvcyIsIlJlZGlzIiwicmVkaXNDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfVVJMIiwibWF4UmV0cmllc1BlclJlcXVlc3QiLCJyZXRyeVN0cmF0ZWd5Iiwib24iLCJlcnIiLCJjb25zb2xlIiwid2FybiIsImVycm9yIiwiY2FjaGVIZWxwZXIiLCJnZXQiLCJrZXkiLCJzZXQiLCJ2YWx1ZSIsIm9wdGlvbnMiLCJtYXBQcm9kdWN0IiwiaXRlbSIsInNvdXJjZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJhc2luIiwiaWQiLCJicmFuZCIsInRpdGxlIiwibmFtZSIsImxpbmsiLCJ1cmwiLCJpbWFnZSIsImlzUHJpbWUiLCJyYXRpbmciLCJhdmVyYWdlX3JhdGluZyIsIk51bWJlciIsInRvRml4ZWQiLCJyYXRpbmdzVG90YWwiLCJudW1iZXJfb2ZfcmV2aWV3cyIsInByaWNlIiwicHJpY2VfY3VycmVuY3kiLCJhdmFpbGFiaWxpdHkiLCJzcG9uc29yZWQiLCJoYXNfcHJpbWUiLCJzdGFycyIsInRvdGFsX3Jldmlld3MiLCJmaWx0ZXJTcG9uc29yZWRQcm9kdWN0cyIsInByb2R1Y3RzIiwiZmlsdGVyIiwicHJvZHVjdCIsImZldGNoUHJvZHVjdHMiLCJ0ZXJtIiwic29ydEJ5IiwicGFnZSIsInBhcmFtcyIsImFwaV9rZXkiLCJTQ1JBUEVSX0FQSV9LRVkiLCJxdWVyeSIsImNvdW50cnkiLCJ0b1N0cmluZyIsInNvcnRfYnkiLCJleGNsdWRlX3Nwb25zb3JlZCIsInJlc3BvbnNlIiwidGltZW91dCIsImRhdGEiLCJqc29uRGF0YSIsInJlc3VsdHMiLCJ0b3RhbFBhZ2VzIiwiaXRlbXMiLCJBcnJheSIsImlzQXJyYXkiLCJ0b3RhbF9wYWdlcyIsIkVycm9yIiwibWFwcGVkUmVzdWx0cyIsIm1hcCIsIm1lc3NhZ2UiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwiZW5kIiwic2V0SGVhZGVyIiwic3RyZWFtUmVzdWx0cyIsInNvdXJjZVRvRmV0Y2giLCJjYWNoZUtleSIsImNhY2hlZFJlc3VsdHMiLCJwdXNoIiwicGFyc2UiLCJzb3VyY2VSZXN1bHRzIiwicGFyc2VJbnQiLCJFWCIsImRldGFpbHMiLCJQcm9taXNlIiwiYWxsIiwianNvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/search.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();