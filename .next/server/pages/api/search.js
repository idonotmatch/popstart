"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/search";
exports.ids = ["pages/api/search"];
exports.modules = {

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/search.js */ \"(api)/./pages/api/search.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/search\",\n        pathname: \"/api/search\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_search_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnNlYXJjaCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGc2VhcmNoLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ2tEO0FBQ2xEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxpREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsaURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktZ3JhcGhxbC1wcm9qZWN0Lz85YzRmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvc2VhcmNoLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc2VhcmNoXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvc2VhcmNoXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst { Pool } = __webpack_require__(/*! pg */ \"pg\");\n// Create a new pool using the DATABASE_URL environment variable\nconst pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n    ssl: {\n        rejectUnauthorized: false // Required for some hosting platforms\n    }\n});\n// Helper function to process API results\nfunction processApiResults(results, source) {\n    return results.map((item)=>({\n            source: source,\n            product_id: item.id || item.asin,\n            name: item.name || item.title,\n            brand: item.brand || \"\",\n            price: parseFloat(item.price) || parseFloat(item.price_string?.replace(\"$\", \"\")),\n            image_url: item.image,\n            product_url: item.url || item.link,\n            rating: parseFloat(item.rating?.average_rating || item.stars),\n            review_count: parseInt(item.rating?.number_of_reviews || item.total_reviews),\n            availability: item.availability || \"In stock\",\n            full_description: item.full_description || \"\",\n            small_description: item.small_description || \"\",\n            product_category: item.product_category || \"\",\n            model: item.model || \"\",\n            shipping_price: parseFloat(item.shipping_price) || null,\n            shipping_time: item.shipping_time || \"\",\n            is_coupon_exists: item.is_coupon_exists || false,\n            coupon_text: item.coupon_text || \"\",\n            feature_bullets: Array.isArray(item.feature_bullets) ? item.feature_bullets : [],\n            brand_url: item.brand_url || \"\",\n            shipping_condition: item.shipping_condition || \"\",\n            fabric_type: item.fabric_type || \"\",\n            care_instructions: item.care_instructions || \"\",\n            origin: item.origin || \"\",\n            pattern: item.pattern || \"\",\n            country_of_origin: item.country_of_origin || \"\"\n        }));\n}\n// Function to insert or update products\nasync function insertProducts(products) {\n    const client = await pool.connect();\n    try {\n        await client.query(\"BEGIN\");\n        for (let product of products){\n            const query = `\n        INSERT INTO products (\n          source, product_id, name, brand, price, image_url, product_url, rating, review_count, availability,\n          full_description, small_description, product_category, model, shipping_price, shipping_time,\n          is_coupon_exists, coupon_text, feature_bullets, brand_url, shipping_condition, fabric_type,\n          care_instructions, origin, pattern, country_of_origin\n        )\n        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26)\n        ON CONFLICT (source, product_id) DO UPDATE SET\n        name = EXCLUDED.name,\n        brand = EXCLUDED.brand,\n        price = EXCLUDED.price,\n        image_url = EXCLUDED.image_url,\n        product_url = EXCLUDED.product_url,\n        rating = EXCLUDED.rating,\n        review_count = EXCLUDED.review_count,\n        availability = EXCLUDED.availability,\n        full_description = EXCLUDED.full_description,\n        small_description = EXCLUDED.small_description,\n        product_category = EXCLUDED.product_category,\n        model = EXCLUDED.model,\n        shipping_price = EXCLUDED.shipping_price,\n        shipping_time = EXCLUDED.shipping_time,\n        is_coupon_exists = EXCLUDED.is_coupon_exists,\n        coupon_text = EXCLUDED.coupon_text,\n        feature_bullets = EXCLUDED.feature_bullets,\n        brand_url = EXCLUDED.brand_url,\n        shipping_condition = EXCLUDED.shipping_condition,\n        fabric_type = EXCLUDED.fabric_type,\n        care_instructions = EXCLUDED.care_instructions,\n        origin = EXCLUDED.origin,\n        pattern = EXCLUDED.pattern,\n        country_of_origin = EXCLUDED.country_of_origin,\n        updated_at = CURRENT_TIMESTAMP\n      `;\n            const values = [\n                product.source,\n                product.product_id,\n                product.name,\n                product.brand,\n                product.price,\n                product.image_url,\n                product.product_url,\n                product.rating,\n                product.review_count,\n                product.availability,\n                product.full_description,\n                product.small_description,\n                product.product_category,\n                product.model,\n                product.shipping_price,\n                product.shipping_time,\n                product.is_coupon_exists,\n                product.coupon_text,\n                JSON.stringify(product.feature_bullets),\n                product.brand_url,\n                product.shipping_condition,\n                product.fabric_type,\n                product.care_instructions,\n                product.origin,\n                product.pattern,\n                product.country_of_origin\n            ];\n            await client.query(query, values);\n        }\n        await client.query(\"COMMIT\");\n        console.log(\"Products inserted/updated successfully\");\n    } catch (e) {\n        await client.query(\"ROLLBACK\");\n        throw e;\n    } finally{\n        client.release();\n    }\n}\n// Function to retrieve products\nasync function getProducts(source, limit = 10) {\n    const query = \"SELECT * FROM products WHERE source = $1 ORDER BY created_at DESC LIMIT $2\";\n    try {\n        const result = await pool.query(query, [\n            source,\n            limit\n        ]);\n        return result.rows;\n    } catch (e) {\n        console.error(\"Error fetching products:\", e);\n        return [];\n    }\n}\n// Function to retrieve a specific product\nasync function getSpecificProduct(source, productId) {\n    const query = \"SELECT * FROM products WHERE source = $1 AND product_id = $2\";\n    try {\n        const result = await pool.query(query, [\n            source,\n            productId\n        ]);\n        return result.rows[0] || null;\n    } catch (e) {\n        console.error(\"Error fetching specific product:\", e);\n        return null;\n    }\n}\n// Function to store API results\nasync function storeApiResults(amazonResults, walmartResults) {\n    const amazonProducts = processApiResults(amazonResults, \"amazon\");\n    const walmartProducts = processApiResults(walmartResults, \"walmart\");\n    try {\n        await insertProducts([\n            ...amazonProducts,\n            ...walmartProducts\n        ]);\n        console.log(\"API results stored successfully\");\n    } catch (e) {\n        console.error(\"Error storing API results:\", e);\n    }\n}\n// New function to update product price and add to price history\nasync function updateProductPrice(productId, source, currentPrice, originalPrice = null) {\n    const client = await pool.connect();\n    try {\n        await client.query(\"BEGIN\");\n        // Update the product's current price\n        const updateProductQuery = `\n      UPDATE products\n      SET price = $1, updated_at = CURRENT_TIMESTAMP\n      WHERE product_id = $2 AND source = $3\n    `;\n        await client.query(updateProductQuery, [\n            currentPrice,\n            productId,\n            source\n        ]);\n        // Add entry to price history\n        const insertPriceHistoryQuery = `\n      INSERT INTO price_history (product_id, source, current_price, original_price)\n      VALUES ($1, $2, $3, $4)\n    `;\n        await client.query(insertPriceHistoryQuery, [\n            productId,\n            source,\n            currentPrice,\n            originalPrice\n        ]);\n        await client.query(\"COMMIT\");\n        console.log(`Price updated for product ${productId}`);\n    } catch (e) {\n        await client.query(\"ROLLBACK\");\n        console.error(\"Error updating product price:\", e);\n        throw e;\n    } finally{\n        client.release();\n    }\n}\n// New function to get price history for a product\nasync function getProductPriceHistory(productId, source) {\n    const query = `\n    SELECT * FROM price_history\n    WHERE product_id = $1 AND source = $2\n    ORDER BY timestamp DESC\n  `;\n    try {\n        const result = await pool.query(query, [\n            productId,\n            source\n        ]);\n        return result.rows;\n    } catch (e) {\n        console.error(\"Error fetching price history:\", e);\n        return [];\n    }\n}\nmodule.exports = {\n    pool,\n    processApiResults,\n    insertProducts,\n    getProducts,\n    getSpecificProduct,\n    storeApiResults,\n    updateProductPrice,\n    getProductPriceHistory\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFPO0lBQ2hCO0FBQ0Y7QUFFQSxrREFBa0Q7QUFDbEQsZUFBZWtCLHVCQUF1QlgsU0FBUyxFQUFFL0QsTUFBTTtJQUNyRCxNQUFNZ0QsUUFBUSxDQUFDOzs7O0VBSWYsQ0FBQztJQUNELElBQUk7UUFDRixNQUFNVyxTQUFTLE1BQU1wRSxLQUFLeUQsS0FBSyxDQUFDQSxPQUFPO1lBQUNlO1lBQVcvRDtTQUFPO1FBQzFELE9BQU8yRCxPQUFPQyxJQUFJO0lBQ3BCLEVBQUUsT0FBT0wsR0FBRztRQUNWRixRQUFRUSxLQUFLLENBQUMsaUNBQWlDTjtRQUMvQyxPQUFPLEVBQUU7SUFDWDtBQUNGO0FBRUFvQixPQUFPQyxPQUFPLEdBQUc7SUFDZnJGO0lBQ0FPO0lBQ0E4QztJQUNBYTtJQUNBSztJQUNBRTtJQUNBSztJQUNBSztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktZ3JhcGhxbC1wcm9qZWN0Ly4vbGliL2RiLmpzPzNkYzkiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBQb29sIH0gPSByZXF1aXJlKCdwZycpO1xuXG4vLyBDcmVhdGUgYSBuZXcgcG9vbCB1c2luZyB0aGUgREFUQUJBU0VfVVJMIGVudmlyb25tZW50IHZhcmlhYmxlXG5jb25zdCBwb29sID0gbmV3IFBvb2woe1xuICBjb25uZWN0aW9uU3RyaW5nOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwsXG4gIHNzbDoge1xuICAgIHJlamVjdFVuYXV0aG9yaXplZDogZmFsc2UgLy8gUmVxdWlyZWQgZm9yIHNvbWUgaG9zdGluZyBwbGF0Zm9ybXNcbiAgfVxufSk7XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBwcm9jZXNzIEFQSSByZXN1bHRzXG5mdW5jdGlvbiBwcm9jZXNzQXBpUmVzdWx0cyhyZXN1bHRzLCBzb3VyY2UpIHtcbiAgcmV0dXJuIHJlc3VsdHMubWFwKGl0ZW0gPT4gKHtcbiAgICBzb3VyY2U6IHNvdXJjZSxcbiAgICBwcm9kdWN0X2lkOiBpdGVtLmlkIHx8IGl0ZW0uYXNpbixcbiAgICBuYW1lOiBpdGVtLm5hbWUgfHwgaXRlbS50aXRsZSxcbiAgICBicmFuZDogaXRlbS5icmFuZCB8fCAnJyxcbiAgICBwcmljZTogcGFyc2VGbG9hdChpdGVtLnByaWNlKSB8fCBwYXJzZUZsb2F0KGl0ZW0ucHJpY2Vfc3RyaW5nPy5yZXBsYWNlKCckJywgJycpKSxcbiAgICBpbWFnZV91cmw6IGl0ZW0uaW1hZ2UsXG4gICAgcHJvZHVjdF91cmw6IGl0ZW0udXJsIHx8IGl0ZW0ubGluayxcbiAgICByYXRpbmc6IHBhcnNlRmxvYXQoaXRlbS5yYXRpbmc/LmF2ZXJhZ2VfcmF0aW5nIHx8IGl0ZW0uc3RhcnMpLFxuICAgIHJldmlld19jb3VudDogcGFyc2VJbnQoaXRlbS5yYXRpbmc/Lm51bWJlcl9vZl9yZXZpZXdzIHx8IGl0ZW0udG90YWxfcmV2aWV3cyksXG4gICAgYXZhaWxhYmlsaXR5OiBpdGVtLmF2YWlsYWJpbGl0eSB8fCAnSW4gc3RvY2snLFxuICAgIGZ1bGxfZGVzY3JpcHRpb246IGl0ZW0uZnVsbF9kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICBzbWFsbF9kZXNjcmlwdGlvbjogaXRlbS5zbWFsbF9kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICBwcm9kdWN0X2NhdGVnb3J5OiBpdGVtLnByb2R1Y3RfY2F0ZWdvcnkgfHwgJycsXG4gICAgbW9kZWw6IGl0ZW0ubW9kZWwgfHwgJycsXG4gICAgc2hpcHBpbmdfcHJpY2U6IHBhcnNlRmxvYXQoaXRlbS5zaGlwcGluZ19wcmljZSkgfHwgbnVsbCxcbiAgICBzaGlwcGluZ190aW1lOiBpdGVtLnNoaXBwaW5nX3RpbWUgfHwgJycsXG4gICAgaXNfY291cG9uX2V4aXN0czogaXRlbS5pc19jb3Vwb25fZXhpc3RzIHx8IGZhbHNlLFxuICAgIGNvdXBvbl90ZXh0OiBpdGVtLmNvdXBvbl90ZXh0IHx8ICcnLFxuICAgIGZlYXR1cmVfYnVsbGV0czogQXJyYXkuaXNBcnJheShpdGVtLmZlYXR1cmVfYnVsbGV0cykgPyBpdGVtLmZlYXR1cmVfYnVsbGV0cyA6IFtdLFxuICAgIGJyYW5kX3VybDogaXRlbS5icmFuZF91cmwgfHwgJycsXG4gICAgc2hpcHBpbmdfY29uZGl0aW9uOiBpdGVtLnNoaXBwaW5nX2NvbmRpdGlvbiB8fCAnJyxcbiAgICBmYWJyaWNfdHlwZTogaXRlbS5mYWJyaWNfdHlwZSB8fCAnJyxcbiAgICBjYXJlX2luc3RydWN0aW9uczogaXRlbS5jYXJlX2luc3RydWN0aW9ucyB8fCAnJyxcbiAgICBvcmlnaW46IGl0ZW0ub3JpZ2luIHx8ICcnLFxuICAgIHBhdHRlcm46IGl0ZW0ucGF0dGVybiB8fCAnJyxcbiAgICBjb3VudHJ5X29mX29yaWdpbjogaXRlbS5jb3VudHJ5X29mX29yaWdpbiB8fCAnJ1xuICB9KSk7XG59XG5cbi8vIEZ1bmN0aW9uIHRvIGluc2VydCBvciB1cGRhdGUgcHJvZHVjdHNcbmFzeW5jIGZ1bmN0aW9uIGluc2VydFByb2R1Y3RzKHByb2R1Y3RzKSB7XG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IHBvb2wuY29ubmVjdCgpO1xuICB0cnkge1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQkVHSU4nKTtcbiAgICBmb3IgKGxldCBwcm9kdWN0IG9mIHByb2R1Y3RzKSB7XG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgSU5TRVJUIElOVE8gcHJvZHVjdHMgKFxuICAgICAgICAgIHNvdXJjZSwgcHJvZHVjdF9pZCwgbmFtZSwgYnJhbmQsIHByaWNlLCBpbWFnZV91cmwsIHByb2R1Y3RfdXJsLCByYXRpbmcsIHJldmlld19jb3VudCwgYXZhaWxhYmlsaXR5LFxuICAgICAgICAgIGZ1bGxfZGVzY3JpcHRpb24sIHNtYWxsX2Rlc2NyaXB0aW9uLCBwcm9kdWN0X2NhdGVnb3J5LCBtb2RlbCwgc2hpcHBpbmdfcHJpY2UsIHNoaXBwaW5nX3RpbWUsXG4gICAgICAgICAgaXNfY291cG9uX2V4aXN0cywgY291cG9uX3RleHQsIGZlYXR1cmVfYnVsbGV0cywgYnJhbmRfdXJsLCBzaGlwcGluZ19jb25kaXRpb24sIGZhYnJpY190eXBlLFxuICAgICAgICAgIGNhcmVfaW5zdHJ1Y3Rpb25zLCBvcmlnaW4sIHBhdHRlcm4sIGNvdW50cnlfb2Zfb3JpZ2luXG4gICAgICAgIClcbiAgICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgsICQ5LCAkMTAsICQxMSwgJDEyLCAkMTMsICQxNCwgJDE1LCAkMTYsICQxNywgJDE4LCAkMTksICQyMCwgJDIxLCAkMjIsICQyMywgJDI0LCAkMjUsICQyNilcbiAgICAgICAgT04gQ09ORkxJQ1QgKHNvdXJjZSwgcHJvZHVjdF9pZCkgRE8gVVBEQVRFIFNFVFxuICAgICAgICBuYW1lID0gRVhDTFVERUQubmFtZSxcbiAgICAgICAgYnJhbmQgPSBFWENMVURFRC5icmFuZCxcbiAgICAgICAgcHJpY2UgPSBFWENMVURFRC5wcmljZSxcbiAgICAgICAgaW1hZ2VfdXJsID0gRVhDTFVERUQuaW1hZ2VfdXJsLFxuICAgICAgICBwcm9kdWN0X3VybCA9IEVYQ0xVREVELnByb2R1Y3RfdXJsLFxuICAgICAgICByYXRpbmcgPSBFWENMVURFRC5yYXRpbmcsXG4gICAgICAgIHJldmlld19jb3VudCA9IEVYQ0xVREVELnJldmlld19jb3VudCxcbiAgICAgICAgYXZhaWxhYmlsaXR5ID0gRVhDTFVERUQuYXZhaWxhYmlsaXR5LFxuICAgICAgICBmdWxsX2Rlc2NyaXB0aW9uID0gRVhDTFVERUQuZnVsbF9kZXNjcmlwdGlvbixcbiAgICAgICAgc21hbGxfZGVzY3JpcHRpb24gPSBFWENMVURFRC5zbWFsbF9kZXNjcmlwdGlvbixcbiAgICAgICAgcHJvZHVjdF9jYXRlZ29yeSA9IEVYQ0xVREVELnByb2R1Y3RfY2F0ZWdvcnksXG4gICAgICAgIG1vZGVsID0gRVhDTFVERUQubW9kZWwsXG4gICAgICAgIHNoaXBwaW5nX3ByaWNlID0gRVhDTFVERUQuc2hpcHBpbmdfcHJpY2UsXG4gICAgICAgIHNoaXBwaW5nX3RpbWUgPSBFWENMVURFRC5zaGlwcGluZ190aW1lLFxuICAgICAgICBpc19jb3Vwb25fZXhpc3RzID0gRVhDTFVERUQuaXNfY291cG9uX2V4aXN0cyxcbiAgICAgICAgY291cG9uX3RleHQgPSBFWENMVURFRC5jb3Vwb25fdGV4dCxcbiAgICAgICAgZmVhdHVyZV9idWxsZXRzID0gRVhDTFVERUQuZmVhdHVyZV9idWxsZXRzLFxuICAgICAgICBicmFuZF91cmwgPSBFWENMVURFRC5icmFuZF91cmwsXG4gICAgICAgIHNoaXBwaW5nX2NvbmRpdGlvbiA9IEVYQ0xVREVELnNoaXBwaW5nX2NvbmRpdGlvbixcbiAgICAgICAgZmFicmljX3R5cGUgPSBFWENMVURFRC5mYWJyaWNfdHlwZSxcbiAgICAgICAgY2FyZV9pbnN0cnVjdGlvbnMgPSBFWENMVURFRC5jYXJlX2luc3RydWN0aW9ucyxcbiAgICAgICAgb3JpZ2luID0gRVhDTFVERUQub3JpZ2luLFxuICAgICAgICBwYXR0ZXJuID0gRVhDTFVERUQucGF0dGVybixcbiAgICAgICAgY291bnRyeV9vZl9vcmlnaW4gPSBFWENMVURFRC5jb3VudHJ5X29mX29yaWdpbixcbiAgICAgICAgdXBkYXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QXG4gICAgICBgO1xuICAgICAgY29uc3QgdmFsdWVzID0gW1xuICAgICAgICBwcm9kdWN0LnNvdXJjZSxcbiAgICAgICAgcHJvZHVjdC5wcm9kdWN0X2lkLFxuICAgICAgICBwcm9kdWN0Lm5hbWUsXG4gICAgICAgIHByb2R1Y3QuYnJhbmQsXG4gICAgICAgIHByb2R1Y3QucHJpY2UsXG4gICAgICAgIHByb2R1Y3QuaW1hZ2VfdXJsLFxuICAgICAgICBwcm9kdWN0LnByb2R1Y3RfdXJsLFxuICAgICAgICBwcm9kdWN0LnJhdGluZyxcbiAgICAgICAgcHJvZHVjdC5yZXZpZXdfY291bnQsXG4gICAgICAgIHByb2R1Y3QuYXZhaWxhYmlsaXR5LFxuICAgICAgICBwcm9kdWN0LmZ1bGxfZGVzY3JpcHRpb24sXG4gICAgICAgIHByb2R1Y3Quc21hbGxfZGVzY3JpcHRpb24sXG4gICAgICAgIHByb2R1Y3QucHJvZHVjdF9jYXRlZ29yeSxcbiAgICAgICAgcHJvZHVjdC5tb2RlbCxcbiAgICAgICAgcHJvZHVjdC5zaGlwcGluZ19wcmljZSxcbiAgICAgICAgcHJvZHVjdC5zaGlwcGluZ190aW1lLFxuICAgICAgICBwcm9kdWN0LmlzX2NvdXBvbl9leGlzdHMsXG4gICAgICAgIHByb2R1Y3QuY291cG9uX3RleHQsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHByb2R1Y3QuZmVhdHVyZV9idWxsZXRzKSxcbiAgICAgICAgcHJvZHVjdC5icmFuZF91cmwsXG4gICAgICAgIHByb2R1Y3Quc2hpcHBpbmdfY29uZGl0aW9uLFxuICAgICAgICBwcm9kdWN0LmZhYnJpY190eXBlLFxuICAgICAgICBwcm9kdWN0LmNhcmVfaW5zdHJ1Y3Rpb25zLFxuICAgICAgICBwcm9kdWN0Lm9yaWdpbixcbiAgICAgICAgcHJvZHVjdC5wYXR0ZXJuLFxuICAgICAgICBwcm9kdWN0LmNvdW50cnlfb2Zfb3JpZ2luXG4gICAgICBdO1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KHF1ZXJ5LCB2YWx1ZXMpO1xuICAgIH1cbiAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0NPTU1JVCcpO1xuICAgIGNvbnNvbGUubG9nKCdQcm9kdWN0cyBpbnNlcnRlZC91cGRhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdST0xMQkFDSycpO1xuICAgIHRocm93IGU7XG4gIH0gZmluYWxseSB7XG4gICAgY2xpZW50LnJlbGVhc2UoKTtcbiAgfVxufVxuXG4vLyBGdW5jdGlvbiB0byByZXRyaWV2ZSBwcm9kdWN0c1xuYXN5bmMgZnVuY3Rpb24gZ2V0UHJvZHVjdHMoc291cmNlLCBsaW1pdCA9IDEwKSB7XG4gIGNvbnN0IHF1ZXJ5ID0gJ1NFTEVDVCAqIEZST00gcHJvZHVjdHMgV0hFUkUgc291cmNlID0gJDEgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDIExJTUlUICQyJztcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb29sLnF1ZXJ5KHF1ZXJ5LCBbc291cmNlLCBsaW1pdF0pO1xuICAgIHJldHVybiByZXN1bHQucm93cztcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHByb2R1Y3RzOicsIGUpO1xuICAgIHJldHVybiBbXTtcbiAgfVxufVxuXG4vLyBGdW5jdGlvbiB0byByZXRyaWV2ZSBhIHNwZWNpZmljIHByb2R1Y3RcbmFzeW5jIGZ1bmN0aW9uIGdldFNwZWNpZmljUHJvZHVjdChzb3VyY2UsIHByb2R1Y3RJZCkge1xuICBjb25zdCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzIFdIRVJFIHNvdXJjZSA9ICQxIEFORCBwcm9kdWN0X2lkID0gJDInO1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBvb2wucXVlcnkocXVlcnksIFtzb3VyY2UsIHByb2R1Y3RJZF0pO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgc3BlY2lmaWMgcHJvZHVjdDonLCBlKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vLyBGdW5jdGlvbiB0byBzdG9yZSBBUEkgcmVzdWx0c1xuYXN5bmMgZnVuY3Rpb24gc3RvcmVBcGlSZXN1bHRzKGFtYXpvblJlc3VsdHMsIHdhbG1hcnRSZXN1bHRzKSB7XG4gIGNvbnN0IGFtYXpvblByb2R1Y3RzID0gcHJvY2Vzc0FwaVJlc3VsdHMoYW1hem9uUmVzdWx0cywgJ2FtYXpvbicpO1xuICBjb25zdCB3YWxtYXJ0UHJvZHVjdHMgPSBwcm9jZXNzQXBpUmVzdWx0cyh3YWxtYXJ0UmVzdWx0cywgJ3dhbG1hcnQnKTtcbiAgXG4gIHRyeSB7XG4gICAgYXdhaXQgaW5zZXJ0UHJvZHVjdHMoWy4uLmFtYXpvblByb2R1Y3RzLCAuLi53YWxtYXJ0UHJvZHVjdHNdKTtcbiAgICBjb25zb2xlLmxvZygnQVBJIHJlc3VsdHMgc3RvcmVkIHN1Y2Nlc3NmdWxseScpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3Igc3RvcmluZyBBUEkgcmVzdWx0czonLCBlKTtcbiAgfVxufVxuXG4vLyBOZXcgZnVuY3Rpb24gdG8gdXBkYXRlIHByb2R1Y3QgcHJpY2UgYW5kIGFkZCB0byBwcmljZSBoaXN0b3J5XG5hc3luYyBmdW5jdGlvbiB1cGRhdGVQcm9kdWN0UHJpY2UocHJvZHVjdElkLCBzb3VyY2UsIGN1cnJlbnRQcmljZSwgb3JpZ2luYWxQcmljZSA9IG51bGwpIHtcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgcG9vbC5jb25uZWN0KCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdCRUdJTicpO1xuXG4gICAgLy8gVXBkYXRlIHRoZSBwcm9kdWN0J3MgY3VycmVudCBwcmljZVxuICAgIGNvbnN0IHVwZGF0ZVByb2R1Y3RRdWVyeSA9IGBcbiAgICAgIFVQREFURSBwcm9kdWN0c1xuICAgICAgU0VUIHByaWNlID0gJDEsIHVwZGF0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgV0hFUkUgcHJvZHVjdF9pZCA9ICQyIEFORCBzb3VyY2UgPSAkM1xuICAgIGA7XG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KHVwZGF0ZVByb2R1Y3RRdWVyeSwgW2N1cnJlbnRQcmljZSwgcHJvZHVjdElkLCBzb3VyY2VdKTtcblxuICAgIC8vIEFkZCBlbnRyeSB0byBwcmljZSBoaXN0b3J5XG4gICAgY29uc3QgaW5zZXJ0UHJpY2VIaXN0b3J5UXVlcnkgPSBgXG4gICAgICBJTlNFUlQgSU5UTyBwcmljZV9oaXN0b3J5IChwcm9kdWN0X2lkLCBzb3VyY2UsIGN1cnJlbnRfcHJpY2UsIG9yaWdpbmFsX3ByaWNlKVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNClcbiAgICBgO1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeShpbnNlcnRQcmljZUhpc3RvcnlRdWVyeSwgW3Byb2R1Y3RJZCwgc291cmNlLCBjdXJyZW50UHJpY2UsIG9yaWdpbmFsUHJpY2VdKTtcblxuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQ09NTUlUJyk7XG4gICAgY29uc29sZS5sb2coYFByaWNlIHVwZGF0ZWQgZm9yIHByb2R1Y3QgJHtwcm9kdWN0SWR9YCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBhd2FpdCBjbGllbnQucXVlcnkoJ1JPTExCQUNLJyk7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZHVjdCBwcmljZTonLCBlKTtcbiAgICB0aHJvdyBlO1xuICB9IGZpbmFsbHkge1xuICAgIGNsaWVudC5yZWxlYXNlKCk7XG4gIH1cbn1cblxuLy8gTmV3IGZ1bmN0aW9uIHRvIGdldCBwcmljZSBoaXN0b3J5IGZvciBhIHByb2R1Y3RcbmFzeW5jIGZ1bmN0aW9uIGdldFByb2R1Y3RQcmljZUhpc3RvcnkocHJvZHVjdElkLCBzb3VyY2UpIHtcbiAgY29uc3QgcXVlcnkgPSBgXG4gICAgU0VMRUNUICogRlJPTSBwcmljZV9oaXN0b3J5XG4gICAgV0hFUkUgcHJvZHVjdF9pZCA9ICQxIEFORCBzb3VyY2UgPSAkMlxuICAgIE9SREVSIEJZIHRpbWVzdGFtcCBERVNDXG4gIGA7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9vbC5xdWVyeShxdWVyeSwgW3Byb2R1Y3RJZCwgc291cmNlXSk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJpY2UgaGlzdG9yeTonLCBlKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHBvb2wsXG4gIHByb2Nlc3NBcGlSZXN1bHRzLFxuICBpbnNlcnRQcm9kdWN0cyxcbiAgZ2V0UHJvZHVjdHMsXG4gIGdldFNwZWNpZmljUHJvZHVjdCxcbiAgc3RvcmVBcGlSZXN1bHRzLFxuICB1cGRhdGVQcm9kdWN0UHJpY2UsXG4gIGdldFByb2R1Y3RQcmljZUhpc3Rvcnlcbn07Il0sIm5hbWVzIjpbIlBvb2wiLCJyZXF1aXJlIiwicG9vbCIsImNvbm5lY3Rpb25TdHJpbmciLCJwcm9jZXNzIiwiZW52IiwiREFUQUJBU0VfVVJMIiwic3NsIiwicmVqZWN0VW5hdXRob3JpemVkIiwicHJvY2Vzc0FwaVJlc3VsdHMiLCJyZXN1bHRzIiwic291cmNlIiwibWFwIiwiaXRlbSIsInByb2R1Y3RfaWQiLCJpZCIsImFzaW4iLCJuYW1lIiwidGl0bGUiLCJicmFuZCIsInByaWNlIiwicGFyc2VGbG9hdCIsInByaWNlX3N0cmluZyIsInJlcGxhY2UiLCJpbWFnZV91cmwiLCJpbWFnZSIsInByb2R1Y3RfdXJsIiwidXJsIiwibGluayIsInJhdGluZyIsImF2ZXJhZ2VfcmF0aW5nIiwic3RhcnMiLCJyZXZpZXdfY291bnQiLCJwYXJzZUludCIsIm51bWJlcl9vZl9yZXZpZXdzIiwidG90YWxfcmV2aWV3cyIsImF2YWlsYWJpbGl0eSIsImZ1bGxfZGVzY3JpcHRpb24iLCJzbWFsbF9kZXNjcmlwdGlvbiIsInByb2R1Y3RfY2F0ZWdvcnkiLCJtb2RlbCIsInNoaXBwaW5nX3ByaWNlIiwic2hpcHBpbmdfdGltZSIsImlzX2NvdXBvbl9leGlzdHMiLCJjb3Vwb25fdGV4dCIsImZlYXR1cmVfYnVsbGV0cyIsIkFycmF5IiwiaXNBcnJheSIsImJyYW5kX3VybCIsInNoaXBwaW5nX2NvbmRpdGlvbiIsImZhYnJpY190eXBlIiwiY2FyZV9pbnN0cnVjdGlvbnMiLCJvcmlnaW4iLCJwYXR0ZXJuIiwiY291bnRyeV9vZl9vcmlnaW4iLCJpbnNlcnRQcm9kdWN0cyIsInByb2R1Y3RzIiwiY2xpZW50IiwiY29ubmVjdCIsInF1ZXJ5IiwicHJvZHVjdCIsInZhbHVlcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25zb2xlIiwibG9nIiwiZSIsInJlbGVhc2UiLCJnZXRQcm9kdWN0cyIsImxpbWl0IiwicmVzdWx0Iiwicm93cyIsImVycm9yIiwiZ2V0U3BlY2lmaWNQcm9kdWN0IiwicHJvZHVjdElkIiwic3RvcmVBcGlSZXN1bHRzIiwiYW1hem9uUmVzdWx0cyIsIndhbG1hcnRSZXN1bHRzIiwiYW1hem9uUHJvZHVjdHMiLCJ3YWxtYXJ0UHJvZHVjdHMiLCJ1cGRhdGVQcm9kdWN0UHJpY2UiLCJjdXJyZW50UHJpY2UiLCJvcmlnaW5hbFByaWNlIiwidXBkYXRlUHJvZHVjdFF1ZXJ5IiwiaW5zZXJ0UHJpY2VIaXN0b3J5UXVlcnkiLCJnZXRQcm9kdWN0UHJpY2VIaXN0b3J5IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/db.js\n");

/***/ }),

/***/ "(api)/./pages/api/search.js":
/*!*****************************!*\
  !*** ./pages/api/search.js ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cacheHelper: () => (/* binding */ cacheHelper),\n/* harmony export */   \"default\": () => (/* binding */ handler),\n/* harmony export */   fetchProducts: () => (/* binding */ fetchProducts),\n/* harmony export */   mapProduct: () => (/* binding */ mapProduct),\n/* harmony export */   streamResults: () => (/* binding */ streamResults)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/db */ \"(api)/./lib/db.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_lib_db__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Initialize Redis client with fallback\nlet redisClient;\ntry {\n    redisClient = new (ioredis__WEBPACK_IMPORTED_MODULE_1___default())(process.env.REDIS_URL, {\n        maxRetriesPerRequest: 1,\n        retryStrategy: ()=>null\n    });\n    redisClient.on(\"error\", (err)=>{\n        console.warn(\"Redis Client Error:\", err);\n        redisClient = null; // Disable Redis client on error\n    });\n} catch (error) {\n    console.warn(\"Failed to initialize Redis:\", error);\n    redisClient = null;\n}\n// Cache helper function\nconst cacheHelper = {\n    get: async (key)=>{\n        if (redisClient) {\n            try {\n                return await redisClient.get(key);\n            } catch (error) {\n                console.warn(\"Redis get error:\", error);\n            }\n        }\n        return null;\n    },\n    set: async (key, value, options)=>{\n        if (redisClient) {\n            try {\n                await redisClient.set(key, value, options);\n            } catch (error) {\n                console.warn(\"Redis set error:\", error);\n            }\n        }\n    }\n};\nconst mapProduct = (item, source)=>{\n    console.log(`Mapping product from ${source}:`, JSON.stringify(item, null, 2));\n    const parsePrice = (price)=>{\n        if (typeof price === \"number\") return price;\n        if (typeof price === \"string\") return Number(price.replace(/[^0-9.-]+/g, \"\"));\n        return null;\n    };\n    if (source === \"walmart\") {\n        return {\n            source: \"walmart\",\n            product_id: item.id || \"\",\n            name: item.name || \"\",\n            brand: item.brand || \"N/A\",\n            price: parsePrice(item.price),\n            image_url: item.image || \"\",\n            product_url: item.url || \"\",\n            rating: item.rating?.average_rating ? Number(item.rating.average_rating) : null,\n            review_count: item.rating?.number_of_reviews || 0,\n            availability: item.availability || \"Unavailable\",\n            full_description: item.full_description || \"\",\n            product_category: item.product_category || \"\",\n            model: item.model || \"\",\n            small_description: item.small_description || \"\"\n        };\n    } else if (source === \"amazon\") {\n        return {\n            source: \"amazon\",\n            product_id: item.asin || \"\",\n            name: item.name || item.title || \"\",\n            brand: item.brand || \"N/A\",\n            price: parsePrice(item.price),\n            image_url: item.image || item.images && item.images[0] || \"\",\n            product_url: item.url || item.link || \"\",\n            rating: item.stars ? Number(item.stars) : null,\n            review_count: item.total_reviews || item.ratings_total || 0,\n            availability: item.availability || \"Unavailable\",\n            full_description: item.full_description || \"\",\n            product_category: item.product_category || \"\",\n            model: item.model || \"\",\n            small_description: item.small_description || \"\"\n        };\n    }\n};\nconst filterSponsoredProducts = (products)=>{\n    return products.filter((product)=>!product.sponsored);\n};\nconst fetchProducts = async (term, source, sortBy, page = 1)=>{\n    let url;\n    let params;\n    // Remove any quotes from the API key\n    const apiKey = process.env.SCRAPER_API_KEY.replace(/[''\"]+/g, \"\");\n    if (source === \"amazon\") {\n        if (term.match(/^[A-Z0-9]{10}$/)) {\n            url = `https://api.scraperapi.com/structured/amazon/product`;\n            params = {\n                api_key: apiKey,\n                asin: term,\n                country_code: \"us\",\n                tld: \"com\"\n            };\n        } else {\n            url = `https://api.scraperapi.com/structured/amazon/search`;\n            params = {\n                api_key: apiKey,\n                query: term,\n                country: \"us\",\n                page: page.toString(),\n                sort_by: sortBy || \"\",\n                exclude_sponsored: \"true\"\n            };\n        }\n    } else if (source === \"walmart\") {\n        if (term.match(/^[0-9]+$/)) {\n            url = `https://api.scraperapi.com/structured/walmart/product`;\n            params = {\n                api_key: apiKey,\n                product_id: term,\n                country_code: \"us\",\n                tld: \"com\"\n            };\n        } else {\n            url = `https://api.scraperapi.com/structured/walmart/search`;\n            params = {\n                api_key: apiKey,\n                query: term,\n                country: \"us\",\n                page: page.toString(),\n                sort_by: sortBy || \"\",\n                exclude_sponsored: \"true\"\n            };\n        }\n    }\n    try {\n        console.log(`Fetching ${source} results for term: \"${term}\", page: ${page}, sortBy: ${sortBy}`);\n        console.log(\"API Request URL:\", url);\n        console.log(\"API Request Params:\", {\n            ...params,\n            api_key: \"[REDACTED]\"\n        });\n        const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(url, {\n            params,\n            timeout: 30000\n        });\n        console.log(`Raw API response from ${source}:`, JSON.stringify(response.data, null, 2));\n        let jsonData = response.data;\n        if (source === \"amazon\" && term.match(/^[A-Z0-9]{10}$/) || source === \"walmart\" && term.match(/^[0-9]+$/)) {\n            // If it's a product query, wrap the result in an array\n            const mappedProduct = mapProduct(jsonData, source);\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.insertProducts)([\n                mappedProduct\n            ]);\n            return {\n                results: [\n                    mappedProduct\n                ],\n                totalPages: 1\n            };\n        } else {\n            // For search queries, process as before\n            let results = [];\n            let totalPages = 1;\n            if (source === \"walmart\" && jsonData.items && Array.isArray(jsonData.items)) {\n                results = jsonData.items;\n                totalPages = jsonData.total_pages || 1;\n            } else if (source === \"amazon\" && jsonData.results) {\n                results = jsonData.results;\n                totalPages = jsonData.total_pages || 1;\n            } else {\n                console.error(`Invalid API response structure from ${source}:`, jsonData);\n                throw new Error(`Invalid API response structure from ${source}`);\n            }\n            const mappedResults = results.map((item)=>mapProduct(item, source));\n            console.log(`Mapped results for ${source}:`, JSON.stringify(mappedResults, null, 2));\n            // Insert all products into the database\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.insertProducts)(mappedResults);\n            return {\n                results: filterSponsoredProducts(mappedResults),\n                totalPages\n            };\n        }\n    } catch (error) {\n        console.error(`Error fetching data from ${source} API:`, error.message);\n        console.error(`Error details:`, error.response ? error.response.data : \"No response data\");\n        throw error;\n    }\n};\nconst streamResults = async (sourceToFetch, term, sort_by, page)=>{\n    const cacheKey = `search:${sourceToFetch}:${term}:${sort_by}:${page}`;\n    try {\n        const cachedResults = await cacheHelper.get(cacheKey);\n        if (cachedResults) {\n            console.log(`Using cached results for ${sourceToFetch}`);\n            return {\n                source: sourceToFetch,\n                ...JSON.parse(cachedResults)\n            };\n        } else {\n            console.log(`Fetching fresh results for ${sourceToFetch}`);\n            // First, try to get results from our database\n            let dbResults = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.getProducts)(sourceToFetch, term, parseInt(page), 20); // Assuming 20 results per page\n            if (dbResults.length > 0) {\n                console.log(`Found ${dbResults.length} results in database for ${sourceToFetch}`);\n                return {\n                    source: sourceToFetch,\n                    results: dbResults,\n                    totalPages: Math.ceil(dbResults.length / 20)\n                };\n            } else {\n                // If no results in database, fetch from API\n                const { results: sourceResults, totalPages } = await fetchProducts(term, sourceToFetch, sort_by, parseInt(page));\n                await cacheHelper.set(cacheKey, JSON.stringify({\n                    results: sourceResults,\n                    totalPages\n                }), {\n                    EX: 3600\n                }); // Cache for 1 hour\n                return {\n                    source: sourceToFetch,\n                    results: sourceResults,\n                    totalPages\n                };\n            }\n        }\n    } catch (error) {\n        console.error(`Error streaming results from ${sourceToFetch}:`, error.message);\n        return {\n            source: sourceToFetch,\n            error: `Failed to fetch data from ${sourceToFetch}: ${error.message}`,\n            details: error.response ? error.response.data : \"No response data\"\n        };\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"GET\") {\n        return res.status(405).end();\n    }\n    const { term, page = \"1\", sort_by, source = \"all\" } = req.query;\n    res.setHeader(\"Content-Type\", \"application/json\");\n    let results = [];\n    if (source === \"all\") {\n        results = await Promise.all([\n            streamResults(\"walmart\", term, sort_by, page),\n            streamResults(\"amazon\", term, sort_by, page)\n        ]);\n    } else {\n        results = [\n            await streamResults(source, term, sort_by, page)\n        ];\n    }\n    res.status(200).json(results);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cHJvamVjdC8uL3BhZ2VzL2FwaS9zZWFyY2guanM/NWQzYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IFJlZGlzIGZyb20gJ2lvcmVkaXMnO1xuaW1wb3J0IHsgaW5zZXJ0UHJvZHVjdHMsIGdldFByb2R1Y3RzIH0gZnJvbSAnLi4vLi4vbGliL2RiJztcblxuLy8gSW5pdGlhbGl6ZSBSZWRpcyBjbGllbnQgd2l0aCBmYWxsYmFja1xubGV0IHJlZGlzQ2xpZW50O1xudHJ5IHtcbiAgcmVkaXNDbGllbnQgPSBuZXcgUmVkaXMocHJvY2Vzcy5lbnYuUkVESVNfVVJMLCB7XG4gICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IDEsXG4gICAgcmV0cnlTdHJhdGVneTogKCkgPT4gbnVsbFxuICB9KTtcbiAgcmVkaXNDbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgIGNvbnNvbGUud2FybignUmVkaXMgQ2xpZW50IEVycm9yOicsIGVycik7XG4gICAgcmVkaXNDbGllbnQgPSBudWxsOyAvLyBEaXNhYmxlIFJlZGlzIGNsaWVudCBvbiBlcnJvclxuICB9KTtcbn0gY2F0Y2ggKGVycm9yKSB7XG4gIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGluaXRpYWxpemUgUmVkaXM6JywgZXJyb3IpO1xuICByZWRpc0NsaWVudCA9IG51bGw7XG59XG5cbi8vIENhY2hlIGhlbHBlciBmdW5jdGlvblxuZXhwb3J0IGNvbnN0IGNhY2hlSGVscGVyID0ge1xuICBnZXQ6IGFzeW5jIChrZXkpID0+IHtcbiAgICBpZiAocmVkaXNDbGllbnQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCByZWRpc0NsaWVudC5nZXQoa2V5KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignUmVkaXMgZ2V0IGVycm9yOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIHNldDogYXN5bmMgKGtleSwgdmFsdWUsIG9wdGlvbnMpID0+IHtcbiAgICBpZiAocmVkaXNDbGllbnQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHJlZGlzQ2xpZW50LnNldChrZXksIHZhbHVlLCBvcHRpb25zKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignUmVkaXMgc2V0IGVycm9yOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBtYXBQcm9kdWN0ID0gKGl0ZW0sIHNvdXJjZSkgPT4ge1xuICBjb25zb2xlLmxvZyhgTWFwcGluZyBwcm9kdWN0IGZyb20gJHtzb3VyY2V9OmAsIEpTT04uc3RyaW5naWZ5KGl0ZW0sIG51bGwsIDIpKTtcblxuICBjb25zdCBwYXJzZVByaWNlID0gKHByaWNlKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBwcmljZSA9PT0gJ251bWJlcicpIHJldHVybiBwcmljZTtcbiAgICBpZiAodHlwZW9mIHByaWNlID09PSAnc3RyaW5nJykgcmV0dXJuIE51bWJlcihwcmljZS5yZXBsYWNlKC9bXjAtOS4tXSsvZyxcIlwiKSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG5cbiAgaWYgKHNvdXJjZSA9PT0gJ3dhbG1hcnQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNvdXJjZTogJ3dhbG1hcnQnLFxuICAgICAgcHJvZHVjdF9pZDogaXRlbS5pZCB8fCAnJyxcbiAgICAgIG5hbWU6IGl0ZW0ubmFtZSB8fCAnJyxcbiAgICAgIGJyYW5kOiBpdGVtLmJyYW5kIHx8ICdOL0EnLFxuICAgICAgcHJpY2U6IHBhcnNlUHJpY2UoaXRlbS5wcmljZSksXG4gICAgICBpbWFnZV91cmw6IGl0ZW0uaW1hZ2UgfHwgJycsXG4gICAgICBwcm9kdWN0X3VybDogaXRlbS51cmwgfHwgJycsXG4gICAgICByYXRpbmc6IGl0ZW0ucmF0aW5nPy5hdmVyYWdlX3JhdGluZyA/IE51bWJlcihpdGVtLnJhdGluZy5hdmVyYWdlX3JhdGluZykgOiBudWxsLFxuICAgICAgcmV2aWV3X2NvdW50OiBpdGVtLnJhdGluZz8ubnVtYmVyX29mX3Jldmlld3MgfHwgMCxcbiAgICAgIGF2YWlsYWJpbGl0eTogaXRlbS5hdmFpbGFiaWxpdHkgfHwgXCJVbmF2YWlsYWJsZVwiLFxuICAgICAgZnVsbF9kZXNjcmlwdGlvbjogaXRlbS5mdWxsX2Rlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgcHJvZHVjdF9jYXRlZ29yeTogaXRlbS5wcm9kdWN0X2NhdGVnb3J5IHx8ICcnLFxuICAgICAgbW9kZWw6IGl0ZW0ubW9kZWwgfHwgJycsXG4gICAgICBzbWFsbF9kZXNjcmlwdGlvbjogaXRlbS5zbWFsbF9kZXNjcmlwdGlvbiB8fCAnJ1xuICAgIH07XG4gIH0gZWxzZSBpZiAoc291cmNlID09PSAnYW1hem9uJykge1xuICAgIHJldHVybiB7XG4gICAgICBzb3VyY2U6ICdhbWF6b24nLFxuICAgICAgcHJvZHVjdF9pZDogaXRlbS5hc2luIHx8ICcnLFxuICAgICAgbmFtZTogaXRlbS5uYW1lIHx8IGl0ZW0udGl0bGUgfHwgJycsXG4gICAgICBicmFuZDogaXRlbS5icmFuZCB8fCAnTi9BJyxcbiAgICAgIHByaWNlOiBwYXJzZVByaWNlKGl0ZW0ucHJpY2UpLFxuICAgICAgaW1hZ2VfdXJsOiBpdGVtLmltYWdlIHx8IChpdGVtLmltYWdlcyAmJiBpdGVtLmltYWdlc1swXSkgfHwgJycsXG4gICAgICBwcm9kdWN0X3VybDogaXRlbS51cmwgfHwgaXRlbS5saW5rIHx8ICcnLFxuICAgICAgcmF0aW5nOiBpdGVtLnN0YXJzID8gTnVtYmVyKGl0ZW0uc3RhcnMpIDogbnVsbCxcbiAgICAgIHJldmlld19jb3VudDogaXRlbS50b3RhbF9yZXZpZXdzIHx8IGl0ZW0ucmF0aW5nc190b3RhbCB8fCAwLFxuICAgICAgYXZhaWxhYmlsaXR5OiBpdGVtLmF2YWlsYWJpbGl0eSB8fCBcIlVuYXZhaWxhYmxlXCIsXG4gICAgICBmdWxsX2Rlc2NyaXB0aW9uOiBpdGVtLmZ1bGxfZGVzY3JpcHRpb24gfHwgJycsXG4gICAgICBwcm9kdWN0X2NhdGVnb3J5OiBpdGVtLnByb2R1Y3RfY2F0ZWdvcnkgfHwgJycsXG4gICAgICBtb2RlbDogaXRlbS5tb2RlbCB8fCAnJyxcbiAgICAgIHNtYWxsX2Rlc2NyaXB0aW9uOiBpdGVtLnNtYWxsX2Rlc2NyaXB0aW9uIHx8ICcnXG4gICAgfTtcbiAgfVxufTtcblxuY29uc3QgZmlsdGVyU3BvbnNvcmVkUHJvZHVjdHMgPSAocHJvZHVjdHMpID0+IHtcbiAgcmV0dXJuIHByb2R1Y3RzLmZpbHRlcihwcm9kdWN0ID0+ICFwcm9kdWN0LnNwb25zb3JlZCk7XG59O1xuXG5leHBvcnQgY29uc3QgZmV0Y2hQcm9kdWN0cyA9IGFzeW5jICh0ZXJtLCBzb3VyY2UsIHNvcnRCeSwgcGFnZSA9IDEpID0+IHtcbiAgbGV0IHVybDtcbiAgbGV0IHBhcmFtcztcblxuICAvLyBSZW1vdmUgYW55IHF1b3RlcyBmcm9tIHRoZSBBUEkga2V5XG4gIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlNDUkFQRVJfQVBJX0tFWS5yZXBsYWNlKC9bJydcIl0rL2csICcnKTtcblxuICBpZiAoc291cmNlID09PSAnYW1hem9uJykge1xuICAgIGlmICh0ZXJtLm1hdGNoKC9eW0EtWjAtOV17MTB9JC8pKSB7ICAvLyBDaGVjayBpZiB0ZXJtIGlzIGFuIEFTSU5cbiAgICAgIHVybCA9IGBodHRwczovL2FwaS5zY3JhcGVyYXBpLmNvbS9zdHJ1Y3R1cmVkL2FtYXpvbi9wcm9kdWN0YDtcbiAgICAgIHBhcmFtcyA9IHtcbiAgICAgICAgYXBpX2tleTogYXBpS2V5LFxuICAgICAgICBhc2luOiB0ZXJtLFxuICAgICAgICBjb3VudHJ5X2NvZGU6ICd1cycsXG4gICAgICAgIHRsZDogJ2NvbSdcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHVybCA9IGBodHRwczovL2FwaS5zY3JhcGVyYXBpLmNvbS9zdHJ1Y3R1cmVkL2FtYXpvbi9zZWFyY2hgO1xuICAgICAgcGFyYW1zID0ge1xuICAgICAgICBhcGlfa2V5OiBhcGlLZXksXG4gICAgICAgIHF1ZXJ5OiB0ZXJtLFxuICAgICAgICBjb3VudHJ5OiAndXMnLFxuICAgICAgICBwYWdlOiBwYWdlLnRvU3RyaW5nKCksXG4gICAgICAgIHNvcnRfYnk6IHNvcnRCeSB8fCAnJyxcbiAgICAgICAgZXhjbHVkZV9zcG9uc29yZWQ6ICd0cnVlJ1xuICAgICAgfTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoc291cmNlID09PSAnd2FsbWFydCcpIHtcbiAgICBpZiAodGVybS5tYXRjaCgvXlswLTldKyQvKSkgeyAgLy8gQ2hlY2sgaWYgdGVybSBpcyBhIFdhbG1hcnQgcHJvZHVjdCBJRFxuICAgICAgdXJsID0gYGh0dHBzOi8vYXBpLnNjcmFwZXJhcGkuY29tL3N0cnVjdHVyZWQvd2FsbWFydC9wcm9kdWN0YDtcbiAgICAgIHBhcmFtcyA9IHtcbiAgICAgICAgYXBpX2tleTogYXBpS2V5LFxuICAgICAgICBwcm9kdWN0X2lkOiB0ZXJtLFxuICAgICAgICBjb3VudHJ5X2NvZGU6ICd1cycsXG4gICAgICAgIHRsZDogJ2NvbSdcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHVybCA9IGBodHRwczovL2FwaS5zY3JhcGVyYXBpLmNvbS9zdHJ1Y3R1cmVkL3dhbG1hcnQvc2VhcmNoYDtcbiAgICAgIHBhcmFtcyA9IHtcbiAgICAgICAgYXBpX2tleTogYXBpS2V5LFxuICAgICAgICBxdWVyeTogdGVybSxcbiAgICAgICAgY291bnRyeTogJ3VzJyxcbiAgICAgICAgcGFnZTogcGFnZS50b1N0cmluZygpLFxuICAgICAgICBzb3J0X2J5OiBzb3J0QnkgfHwgJycsXG4gICAgICAgIGV4Y2x1ZGVfc3BvbnNvcmVkOiAndHJ1ZSdcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhgRmV0Y2hpbmcgJHtzb3VyY2V9IHJlc3VsdHMgZm9yIHRlcm06IFwiJHt0ZXJtfVwiLCBwYWdlOiAke3BhZ2V9LCBzb3J0Qnk6ICR7c29ydEJ5fWApO1xuICAgIGNvbnNvbGUubG9nKCdBUEkgUmVxdWVzdCBVUkw6JywgdXJsKTtcbiAgICBjb25zb2xlLmxvZygnQVBJIFJlcXVlc3QgUGFyYW1zOicsIHsgLi4ucGFyYW1zLCBhcGlfa2V5OiAnW1JFREFDVEVEXScgfSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldCh1cmwsIHsgcGFyYW1zLCB0aW1lb3V0OiAzMDAwMCB9KTtcbiAgICBjb25zb2xlLmxvZyhgUmF3IEFQSSByZXNwb25zZSBmcm9tICR7c291cmNlfTpgLCBKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhLCBudWxsLCAyKSk7XG5cbiAgICBsZXQganNvbkRhdGEgPSByZXNwb25zZS5kYXRhO1xuXG4gICAgaWYgKChzb3VyY2UgPT09ICdhbWF6b24nICYmIHRlcm0ubWF0Y2goL15bQS1aMC05XXsxMH0kLykpIHx8IFxuICAgICAgICAoc291cmNlID09PSAnd2FsbWFydCcgJiYgdGVybS5tYXRjaCgvXlswLTldKyQvKSkpIHtcbiAgICAgIC8vIElmIGl0J3MgYSBwcm9kdWN0IHF1ZXJ5LCB3cmFwIHRoZSByZXN1bHQgaW4gYW4gYXJyYXlcbiAgICAgIGNvbnN0IG1hcHBlZFByb2R1Y3QgPSBtYXBQcm9kdWN0KGpzb25EYXRhLCBzb3VyY2UpO1xuICAgICAgYXdhaXQgaW5zZXJ0UHJvZHVjdHMoW21hcHBlZFByb2R1Y3RdKTtcbiAgICAgIHJldHVybiB7IHJlc3VsdHM6IFttYXBwZWRQcm9kdWN0XSwgdG90YWxQYWdlczogMSB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGb3Igc2VhcmNoIHF1ZXJpZXMsIHByb2Nlc3MgYXMgYmVmb3JlXG4gICAgICBsZXQgcmVzdWx0cyA9IFtdO1xuICAgICAgbGV0IHRvdGFsUGFnZXMgPSAxO1xuXG4gICAgICBpZiAoc291cmNlID09PSAnd2FsbWFydCcgJiYganNvbkRhdGEuaXRlbXMgJiYgQXJyYXkuaXNBcnJheShqc29uRGF0YS5pdGVtcykpIHtcbiAgICAgICAgcmVzdWx0cyA9IGpzb25EYXRhLml0ZW1zO1xuICAgICAgICB0b3RhbFBhZ2VzID0ganNvbkRhdGEudG90YWxfcGFnZXMgfHwgMTtcbiAgICAgIH0gZWxzZSBpZiAoc291cmNlID09PSAnYW1hem9uJyAmJiBqc29uRGF0YS5yZXN1bHRzKSB7XG4gICAgICAgIHJlc3VsdHMgPSBqc29uRGF0YS5yZXN1bHRzO1xuICAgICAgICB0b3RhbFBhZ2VzID0ganNvbkRhdGEudG90YWxfcGFnZXMgfHwgMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEludmFsaWQgQVBJIHJlc3BvbnNlIHN0cnVjdHVyZSBmcm9tICR7c291cmNlfTpgLCBqc29uRGF0YSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBBUEkgcmVzcG9uc2Ugc3RydWN0dXJlIGZyb20gJHtzb3VyY2V9YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1hcHBlZFJlc3VsdHMgPSByZXN1bHRzLm1hcChpdGVtID0+IG1hcFByb2R1Y3QoaXRlbSwgc291cmNlKSk7XG4gICAgICBjb25zb2xlLmxvZyhgTWFwcGVkIHJlc3VsdHMgZm9yICR7c291cmNlfTpgLCBKU09OLnN0cmluZ2lmeShtYXBwZWRSZXN1bHRzLCBudWxsLCAyKSk7XG5cbiAgICAgIC8vIEluc2VydCBhbGwgcHJvZHVjdHMgaW50byB0aGUgZGF0YWJhc2VcbiAgICAgIGF3YWl0IGluc2VydFByb2R1Y3RzKG1hcHBlZFJlc3VsdHMpO1xuXG4gICAgICByZXR1cm4geyByZXN1bHRzOiBmaWx0ZXJTcG9uc29yZWRQcm9kdWN0cyhtYXBwZWRSZXN1bHRzKSwgdG90YWxQYWdlcyB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGBFcnJvciBmZXRjaGluZyBkYXRhIGZyb20gJHtzb3VyY2V9IEFQSTpgLCBlcnJvci5tZXNzYWdlKTtcbiAgICBjb25zb2xlLmVycm9yKGBFcnJvciBkZXRhaWxzOmAsIGVycm9yLnJlc3BvbnNlID8gZXJyb3IucmVzcG9uc2UuZGF0YSA6ICdObyByZXNwb25zZSBkYXRhJyk7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBzdHJlYW1SZXN1bHRzID0gYXN5bmMgKHNvdXJjZVRvRmV0Y2gsIHRlcm0sIHNvcnRfYnksIHBhZ2UpID0+IHtcbiAgY29uc3QgY2FjaGVLZXkgPSBgc2VhcmNoOiR7c291cmNlVG9GZXRjaH06JHt0ZXJtfToke3NvcnRfYnl9OiR7cGFnZX1gO1xuICB0cnkge1xuICAgIGNvbnN0IGNhY2hlZFJlc3VsdHMgPSBhd2FpdCBjYWNoZUhlbHBlci5nZXQoY2FjaGVLZXkpO1xuXG4gICAgaWYgKGNhY2hlZFJlc3VsdHMpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBVc2luZyBjYWNoZWQgcmVzdWx0cyBmb3IgJHtzb3VyY2VUb0ZldGNofWApO1xuICAgICAgcmV0dXJuIHsgc291cmNlOiBzb3VyY2VUb0ZldGNoLCAuLi5KU09OLnBhcnNlKGNhY2hlZFJlc3VsdHMpIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKGBGZXRjaGluZyBmcmVzaCByZXN1bHRzIGZvciAke3NvdXJjZVRvRmV0Y2h9YCk7XG4gICAgICBcbiAgICAgIC8vIEZpcnN0LCB0cnkgdG8gZ2V0IHJlc3VsdHMgZnJvbSBvdXIgZGF0YWJhc2VcbiAgICAgIGxldCBkYlJlc3VsdHMgPSBhd2FpdCBnZXRQcm9kdWN0cyhzb3VyY2VUb0ZldGNoLCB0ZXJtLCBwYXJzZUludChwYWdlKSwgMjApOyAvLyBBc3N1bWluZyAyMCByZXN1bHRzIHBlciBwYWdlXG4gICAgICBcbiAgICAgIGlmIChkYlJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgJHtkYlJlc3VsdHMubGVuZ3RofSByZXN1bHRzIGluIGRhdGFiYXNlIGZvciAke3NvdXJjZVRvRmV0Y2h9YCk7XG4gICAgICAgIHJldHVybiB7IHNvdXJjZTogc291cmNlVG9GZXRjaCwgcmVzdWx0czogZGJSZXN1bHRzLCB0b3RhbFBhZ2VzOiBNYXRoLmNlaWwoZGJSZXN1bHRzLmxlbmd0aCAvIDIwKSB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgbm8gcmVzdWx0cyBpbiBkYXRhYmFzZSwgZmV0Y2ggZnJvbSBBUElcbiAgICAgICAgY29uc3QgeyByZXN1bHRzOiBzb3VyY2VSZXN1bHRzLCB0b3RhbFBhZ2VzIH0gPSBhd2FpdCBmZXRjaFByb2R1Y3RzKHRlcm0sIHNvdXJjZVRvRmV0Y2gsIHNvcnRfYnksIHBhcnNlSW50KHBhZ2UpKTtcbiAgICAgICAgYXdhaXQgY2FjaGVIZWxwZXIuc2V0KGNhY2hlS2V5LCBKU09OLnN0cmluZ2lmeSh7IHJlc3VsdHM6IHNvdXJjZVJlc3VsdHMsIHRvdGFsUGFnZXMgfSksIHsgRVg6IDM2MDAgfSk7IC8vIENhY2hlIGZvciAxIGhvdXJcbiAgICAgICAgcmV0dXJuIHsgc291cmNlOiBzb3VyY2VUb0ZldGNoLCByZXN1bHRzOiBzb3VyY2VSZXN1bHRzLCB0b3RhbFBhZ2VzIH07XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHN0cmVhbWluZyByZXN1bHRzIGZyb20gJHtzb3VyY2VUb0ZldGNofTpgLCBlcnJvci5tZXNzYWdlKTtcbiAgICByZXR1cm4geyBcbiAgICAgIHNvdXJjZTogc291cmNlVG9GZXRjaCwgXG4gICAgICBlcnJvcjogYEZhaWxlZCB0byBmZXRjaCBkYXRhIGZyb20gJHtzb3VyY2VUb0ZldGNofTogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICBkZXRhaWxzOiBlcnJvci5yZXNwb25zZSA/IGVycm9yLnJlc3BvbnNlLmRhdGEgOiAnTm8gcmVzcG9uc2UgZGF0YSdcbiAgICB9O1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnR0VUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuZW5kKCk7XG4gIH1cblxuICBjb25zdCB7IHRlcm0sIHBhZ2UgPSAnMScsIHNvcnRfYnksIHNvdXJjZSA9ICdhbGwnIH0gPSByZXEucXVlcnk7XG5cbiAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblxuICBsZXQgcmVzdWx0cyA9IFtdO1xuXG4gIGlmIChzb3VyY2UgPT09ICdhbGwnKSB7XG4gICAgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIHN0cmVhbVJlc3VsdHMoJ3dhbG1hcnQnLCB0ZXJtLCBzb3J0X2J5LCBwYWdlKSxcbiAgICAgIHN0cmVhbVJlc3VsdHMoJ2FtYXpvbicsIHRlcm0sIHNvcnRfYnksIHBhZ2UpXG4gICAgXSk7XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0cyA9IFthd2FpdCBzdHJlYW1SZXN1bHRzKHNvdXJjZSwgdGVybSwgc29ydF9ieSwgcGFnZSldO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVzdWx0cyk7XG59Il0sIm5hbWVzIjpbImF4aW9zIiwiUmVkaXMiLCJpbnNlcnRQcm9kdWN0cyIsImdldFByb2R1Y3RzIiwicmVkaXNDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfVVJMIiwibWF4UmV0cmllc1BlclJlcXVlc3QiLCJyZXRyeVN0cmF0ZWd5Iiwib24iLCJlcnIiLCJjb25zb2xlIiwid2FybiIsImVycm9yIiwiY2FjaGVIZWxwZXIiLCJnZXQiLCJrZXkiLCJzZXQiLCJ2YWx1ZSIsIm9wdGlvbnMiLCJtYXBQcm9kdWN0IiwiaXRlbSIsInNvdXJjZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJzZVByaWNlIiwicHJpY2UiLCJOdW1iZXIiLCJyZXBsYWNlIiwicHJvZHVjdF9pZCIsImlkIiwibmFtZSIsImJyYW5kIiwiaW1hZ2VfdXJsIiwiaW1hZ2UiLCJwcm9kdWN0X3VybCIsInVybCIsInJhdGluZyIsImF2ZXJhZ2VfcmF0aW5nIiwicmV2aWV3X2NvdW50IiwibnVtYmVyX29mX3Jldmlld3MiLCJhdmFpbGFiaWxpdHkiLCJmdWxsX2Rlc2NyaXB0aW9uIiwicHJvZHVjdF9jYXRlZ29yeSIsIm1vZGVsIiwic21hbGxfZGVzY3JpcHRpb24iLCJhc2luIiwidGl0bGUiLCJpbWFnZXMiLCJsaW5rIiwic3RhcnMiLCJ0b3RhbF9yZXZpZXdzIiwicmF0aW5nc190b3RhbCIsImZpbHRlclNwb25zb3JlZFByb2R1Y3RzIiwicHJvZHVjdHMiLCJmaWx0ZXIiLCJwcm9kdWN0Iiwic3BvbnNvcmVkIiwiZmV0Y2hQcm9kdWN0cyIsInRlcm0iLCJzb3J0QnkiLCJwYWdlIiwicGFyYW1zIiwiYXBpS2V5IiwiU0NSQVBFUl9BUElfS0VZIiwibWF0Y2giLCJhcGlfa2V5IiwiY291bnRyeV9jb2RlIiwidGxkIiwicXVlcnkiLCJjb3VudHJ5IiwidG9TdHJpbmciLCJzb3J0X2J5IiwiZXhjbHVkZV9zcG9uc29yZWQiLCJyZXNwb25zZSIsInRpbWVvdXQiLCJkYXRhIiwianNvbkRhdGEiLCJtYXBwZWRQcm9kdWN0IiwicmVzdWx0cyIsInRvdGFsUGFnZXMiLCJpdGVtcyIsIkFycmF5IiwiaXNBcnJheSIsInRvdGFsX3BhZ2VzIiwiRXJyb3IiLCJtYXBwZWRSZXN1bHRzIiwibWFwIiwibWVzc2FnZSIsInN0cmVhbVJlc3VsdHMiLCJzb3VyY2VUb0ZldGNoIiwiY2FjaGVLZXkiLCJjYWNoZWRSZXN1bHRzIiwicGFyc2UiLCJkYlJlc3VsdHMiLCJwYXJzZUludCIsImxlbmd0aCIsIk1hdGgiLCJjZWlsIiwic291cmNlUmVzdWx0cyIsIkVYIiwiZGV0YWlscyIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJlbmQiLCJzZXRIZWFkZXIiLCJQcm9taXNlIiwiYWxsIiwianNvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/search.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();