"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/list";
exports.ids = ["pages/api/list"];
exports.modules = {

/***/ "@auth0/nextjs-auth0":
/*!**************************************!*\
  !*** external "@auth0/nextjs-auth0" ***!
  \**************************************/
/***/ ((module) => {

module.exports = require("@auth0/nextjs-auth0");

/***/ }),

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Flist&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Flist.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Flist&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Flist.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_list_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/list.js */ \"(api)/./pages/api/list.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_list_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_list_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_list_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_list_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/list\",\n        pathname: \"/api/list\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_list_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmxpc3QmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmxpc3QuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDZ0Q7QUFDaEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtDQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrQ0FBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS1ncmFwaHFsLXByb2plY3QvPzFmMDAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9saXN0LmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvbGlzdFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2xpc3RcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Flist&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Flist.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getProductPriceHistory: () => (/* binding */ getProductPriceHistory),\n/* harmony export */   getProducts: () => (/* binding */ getProducts),\n/* harmony export */   getSpecificProduct: () => (/* binding */ getSpecificProduct),\n/* harmony export */   insertProducts: () => (/* binding */ insertProducts),\n/* harmony export */   pool: () => (/* binding */ pool),\n/* harmony export */   processApiResults: () => (/* binding */ processApiResults),\n/* harmony export */   storeApiResults: () => (/* binding */ storeApiResults),\n/* harmony export */   updateProductPrice: () => (/* binding */ updateProductPrice),\n/* harmony export */   upsertProduct: () => (/* binding */ upsertProduct)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(pg__WEBPACK_IMPORTED_MODULE_0__);\n\n// Create a new pool using the DATABASE_URL environment variable\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n    connectionString: process.env.DATABASE_URL,\n    ssl: {\n        rejectUnauthorized: false // Required for some hosting platforms\n    }\n});\n// Helper function to process API results\nfunction processApiResults(results, source) {\n    return results.map((item)=>({\n            source: source,\n            product_id: item.id || item.asin,\n            name: item.name || item.title,\n            brand: item.brand || \"\",\n            price: parseFloat(item.price) || parseFloat(item.price_string?.replace(\"$\", \"\")),\n            image_url: item.image,\n            product_url: item.url || item.link,\n            rating: parseFloat(item.rating?.average_rating || item.stars),\n            review_count: parseInt(item.rating?.number_of_reviews || item.total_reviews),\n            availability: item.availability || \"In stock\",\n            full_description: item.full_description || \"\",\n            small_description: item.small_description || \"\",\n            product_category: item.product_category || \"\",\n            model: item.model || \"\",\n            shipping_price: parseFloat(item.shipping_price) || null,\n            shipping_time: item.shipping_time || \"\",\n            is_coupon_exists: item.is_coupon_exists || false,\n            coupon_text: item.coupon_text || \"\",\n            feature_bullets: Array.isArray(item.feature_bullets) ? item.feature_bullets : [],\n            brand_url: item.brand_url || \"\",\n            shipping_condition: item.shipping_condition || \"\",\n            fabric_type: item.fabric_type || \"\",\n            care_instructions: item.care_instructions || \"\",\n            origin: item.origin || \"\",\n            pattern: item.pattern || \"\",\n            country_of_origin: item.country_of_origin || \"\"\n        }));\n}\n// Function to insert or update a single product\nasync function upsertProduct(product) {\n    const query = `\n    INSERT INTO products (\n      source, product_id, name, brand, price, image_url, product_url, rating, review_count, availability,\n      full_description, small_description, product_category, model, shipping_price, shipping_time,\n      is_coupon_exists, coupon_text, feature_bullets, brand_url, shipping_condition, fabric_type,\n      care_instructions, origin, pattern, country_of_origin\n    )\n    VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26)\n    ON CONFLICT (source, product_id) DO UPDATE SET\n    name = EXCLUDED.name,\n    brand = EXCLUDED.brand,\n    price = EXCLUDED.price,\n    image_url = EXCLUDED.image_url,\n    product_url = EXCLUDED.product_url,\n    rating = EXCLUDED.rating,\n    review_count = EXCLUDED.review_count,\n    availability = EXCLUDED.availability,\n    full_description = EXCLUDED.full_description,\n    small_description = EXCLUDED.small_description,\n    product_category = EXCLUDED.product_category,\n    model = EXCLUDED.model,\n    shipping_price = EXCLUDED.shipping_price,\n    shipping_time = EXCLUDED.shipping_time,\n    is_coupon_exists = EXCLUDED.is_coupon_exists,\n    coupon_text = EXCLUDED.coupon_text,\n    feature_bullets = EXCLUDED.feature_bullets,\n    brand_url = EXCLUDED.brand_url,\n    shipping_condition = EXCLUDED.shipping_condition,\n    fabric_type = EXCLUDED.fabric_type,\n    care_instructions = EXCLUDED.care_instructions,\n    origin = EXCLUDED.origin,\n    pattern = EXCLUDED.pattern,\n    country_of_origin = EXCLUDED.country_of_origin,\n    updated_at = CURRENT_TIMESTAMP\n    RETURNING *\n  `;\n    const values = [\n        product.source,\n        product.product_id,\n        product.name,\n        product.brand,\n        product.price,\n        product.image_url,\n        product.product_url,\n        product.rating,\n        product.review_count,\n        product.availability,\n        product.full_description,\n        product.small_description,\n        product.product_category,\n        product.model,\n        product.shipping_price,\n        product.shipping_time,\n        product.is_coupon_exists,\n        product.coupon_text,\n        JSON.stringify(product.feature_bullets),\n        product.brand_url,\n        product.shipping_condition,\n        product.fabric_type,\n        product.care_instructions,\n        product.origin,\n        product.pattern,\n        product.country_of_origin\n    ];\n    try {\n        const result = await pool.query(query, values);\n        console.log(\"Product inserted/updated successfully\");\n        return result.rows[0];\n    } catch (e) {\n        console.error(\"Error upserting product:\", e);\n        throw e;\n    }\n}\n// Function to insert or update multiple products\nasync function insertProducts(products) {\n    const client = await pool.connect();\n    try {\n        await client.query(\"BEGIN\");\n        for (let product of products){\n            await upsertProduct(product);\n        }\n        await client.query(\"COMMIT\");\n        console.log(\"Products inserted/updated successfully\");\n    } catch (e) {\n        await client.query(\"ROLLBACK\");\n        throw e;\n    } finally{\n        client.release();\n    }\n}\n// Function to retrieve products\nasync function getProducts(source, limit = 10) {\n    const query = \"SELECT * FROM products WHERE source = $1 ORDER BY created_at DESC LIMIT $2\";\n    try {\n        const result = await pool.query(query, [\n            source,\n            limit\n        ]);\n        return result.rows;\n    } catch (e) {\n        console.error(\"Error fetching products:\", e);\n        return [];\n    }\n}\n// Function to retrieve a specific product\nasync function getSpecificProduct(source, productId) {\n    const query = \"SELECT * FROM products WHERE source = $1 AND product_id = $2\";\n    try {\n        const result = await pool.query(query, [\n            source,\n            productId\n        ]);\n        return result.rows[0] || null;\n    } catch (e) {\n        console.error(\"Error fetching specific product:\", e);\n        return null;\n    }\n}\n// Function to store API results\nasync function storeApiResults(amazonResults, walmartResults) {\n    const amazonProducts = processApiResults(amazonResults, \"amazon\");\n    const walmartProducts = processApiResults(walmartResults, \"walmart\");\n    try {\n        await insertProducts([\n            ...amazonProducts,\n            ...walmartProducts\n        ]);\n        console.log(\"API results stored successfully\");\n    } catch (e) {\n        console.error(\"Error storing API results:\", e);\n    }\n}\n// Function to update product price and add to price history\nasync function updateProductPrice(productId, source, currentPrice, originalPrice = null) {\n    const client = await pool.connect();\n    try {\n        await client.query(\"BEGIN\");\n        // Update the product's current price\n        const updateProductQuery = `\n      UPDATE products\n      SET price = $1, updated_at = CURRENT_TIMESTAMP\n      WHERE product_id = $2 AND source = $3\n    `;\n        await client.query(updateProductQuery, [\n            currentPrice,\n            productId,\n            source\n        ]);\n        // Add entry to price history\n        const insertPriceHistoryQuery = `\n      INSERT INTO price_history (product_id, source, current_price, original_price)\n      VALUES ($1, $2, $3, $4)\n    `;\n        await client.query(insertPriceHistoryQuery, [\n            productId,\n            source,\n            currentPrice,\n            originalPrice\n        ]);\n        await client.query(\"COMMIT\");\n        console.log(`Price updated for product ${productId}`);\n    } catch (e) {\n        await client.query(\"ROLLBACK\");\n        console.error(\"Error updating product price:\", e);\n        throw e;\n    } finally{\n        client.release();\n    }\n}\n// Function to get price history for a product\nasync function getProductPriceHistory(productId, source) {\n    const query = `\n    SELECT * FROM price_history\n    WHERE product_id = $1 AND source = $2\n    ORDER BY timestamp DESC\n  `;\n    try {\n        const result = await pool.query(query, [\n            productId,\n            source\n        ]);\n        return result.rows;\n    } catch (e) {\n        console.error(\"Error fetching price history:\", e);\n        return [];\n    }\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FBRyxDQUFDLENBQUMsMEJBQTBCLEVBQUVZLFVBQVUsQ0FBQztJQUN0RCxFQUFFLE9BQU9WLEdBQUc7UUFDVixNQUFNSSxPQUFPWixLQUFLLENBQUM7UUFDbkJLLFFBQVFJLEtBQUssQ0FBQyxpQ0FBaUNEO1FBQy9DLE1BQU1BO0lBQ1IsU0FBVTtRQUNSSSxPQUFPRSxPQUFPO0lBQ2hCO0FBQ0Y7QUFFQSw4Q0FBOEM7QUFDdkMsZUFBZWUsdUJBQXVCWCxTQUFTLEVBQUVoRSxNQUFNO0lBQzVELE1BQU04QyxRQUFRLENBQUM7Ozs7RUFJZixDQUFDO0lBQ0QsSUFBSTtRQUNGLE1BQU1JLFNBQVMsTUFBTTNELEtBQUt1RCxLQUFLLENBQUNBLE9BQU87WUFBQ2tCO1lBQVdoRTtTQUFPO1FBQzFELE9BQU9rRCxPQUFPRyxJQUFJO0lBQ3BCLEVBQUUsT0FBT0MsR0FBRztRQUNWSCxRQUFRSSxLQUFLLENBQUMsaUNBQWlDRDtRQUMvQyxPQUFPLEVBQUU7SUFDWDtBQUNGO0FBRWdCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktZ3JhcGhxbC1wcm9qZWN0Ly4vbGliL2RiLmpzPzNkYzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUG9vbCB9IGZyb20gJ3BnJztcblxuLy8gQ3JlYXRlIGEgbmV3IHBvb2wgdXNpbmcgdGhlIERBVEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZVxuY29uc3QgcG9vbCA9IG5ldyBQb29sKHtcbiAgY29ubmVjdGlvblN0cmluZzogcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMLFxuICBzc2w6IHtcbiAgICByZWplY3RVbmF1dGhvcml6ZWQ6IGZhbHNlIC8vIFJlcXVpcmVkIGZvciBzb21lIGhvc3RpbmcgcGxhdGZvcm1zXG4gIH1cbn0pO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gcHJvY2VzcyBBUEkgcmVzdWx0c1xuZXhwb3J0IGZ1bmN0aW9uIHByb2Nlc3NBcGlSZXN1bHRzKHJlc3VsdHMsIHNvdXJjZSkge1xuICByZXR1cm4gcmVzdWx0cy5tYXAoaXRlbSA9PiAoe1xuICAgIHNvdXJjZTogc291cmNlLFxuICAgIHByb2R1Y3RfaWQ6IGl0ZW0uaWQgfHwgaXRlbS5hc2luLFxuICAgIG5hbWU6IGl0ZW0ubmFtZSB8fCBpdGVtLnRpdGxlLFxuICAgIGJyYW5kOiBpdGVtLmJyYW5kIHx8ICcnLFxuICAgIHByaWNlOiBwYXJzZUZsb2F0KGl0ZW0ucHJpY2UpIHx8IHBhcnNlRmxvYXQoaXRlbS5wcmljZV9zdHJpbmc/LnJlcGxhY2UoJyQnLCAnJykpLFxuICAgIGltYWdlX3VybDogaXRlbS5pbWFnZSxcbiAgICBwcm9kdWN0X3VybDogaXRlbS51cmwgfHwgaXRlbS5saW5rLFxuICAgIHJhdGluZzogcGFyc2VGbG9hdChpdGVtLnJhdGluZz8uYXZlcmFnZV9yYXRpbmcgfHwgaXRlbS5zdGFycyksXG4gICAgcmV2aWV3X2NvdW50OiBwYXJzZUludChpdGVtLnJhdGluZz8ubnVtYmVyX29mX3Jldmlld3MgfHwgaXRlbS50b3RhbF9yZXZpZXdzKSxcbiAgICBhdmFpbGFiaWxpdHk6IGl0ZW0uYXZhaWxhYmlsaXR5IHx8ICdJbiBzdG9jaycsXG4gICAgZnVsbF9kZXNjcmlwdGlvbjogaXRlbS5mdWxsX2Rlc2NyaXB0aW9uIHx8ICcnLFxuICAgIHNtYWxsX2Rlc2NyaXB0aW9uOiBpdGVtLnNtYWxsX2Rlc2NyaXB0aW9uIHx8ICcnLFxuICAgIHByb2R1Y3RfY2F0ZWdvcnk6IGl0ZW0ucHJvZHVjdF9jYXRlZ29yeSB8fCAnJyxcbiAgICBtb2RlbDogaXRlbS5tb2RlbCB8fCAnJyxcbiAgICBzaGlwcGluZ19wcmljZTogcGFyc2VGbG9hdChpdGVtLnNoaXBwaW5nX3ByaWNlKSB8fCBudWxsLFxuICAgIHNoaXBwaW5nX3RpbWU6IGl0ZW0uc2hpcHBpbmdfdGltZSB8fCAnJyxcbiAgICBpc19jb3Vwb25fZXhpc3RzOiBpdGVtLmlzX2NvdXBvbl9leGlzdHMgfHwgZmFsc2UsXG4gICAgY291cG9uX3RleHQ6IGl0ZW0uY291cG9uX3RleHQgfHwgJycsXG4gICAgZmVhdHVyZV9idWxsZXRzOiBBcnJheS5pc0FycmF5KGl0ZW0uZmVhdHVyZV9idWxsZXRzKSA/IGl0ZW0uZmVhdHVyZV9idWxsZXRzIDogW10sXG4gICAgYnJhbmRfdXJsOiBpdGVtLmJyYW5kX3VybCB8fCAnJyxcbiAgICBzaGlwcGluZ19jb25kaXRpb246IGl0ZW0uc2hpcHBpbmdfY29uZGl0aW9uIHx8ICcnLFxuICAgIGZhYnJpY190eXBlOiBpdGVtLmZhYnJpY190eXBlIHx8ICcnLFxuICAgIGNhcmVfaW5zdHJ1Y3Rpb25zOiBpdGVtLmNhcmVfaW5zdHJ1Y3Rpb25zIHx8ICcnLFxuICAgIG9yaWdpbjogaXRlbS5vcmlnaW4gfHwgJycsXG4gICAgcGF0dGVybjogaXRlbS5wYXR0ZXJuIHx8ICcnLFxuICAgIGNvdW50cnlfb2Zfb3JpZ2luOiBpdGVtLmNvdW50cnlfb2Zfb3JpZ2luIHx8ICcnXG4gIH0pKTtcbn1cblxuLy8gRnVuY3Rpb24gdG8gaW5zZXJ0IG9yIHVwZGF0ZSBhIHNpbmdsZSBwcm9kdWN0XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBzZXJ0UHJvZHVjdChwcm9kdWN0KSB7XG4gIGNvbnN0IHF1ZXJ5ID0gYFxuICAgIElOU0VSVCBJTlRPIHByb2R1Y3RzIChcbiAgICAgIHNvdXJjZSwgcHJvZHVjdF9pZCwgbmFtZSwgYnJhbmQsIHByaWNlLCBpbWFnZV91cmwsIHByb2R1Y3RfdXJsLCByYXRpbmcsIHJldmlld19jb3VudCwgYXZhaWxhYmlsaXR5LFxuICAgICAgZnVsbF9kZXNjcmlwdGlvbiwgc21hbGxfZGVzY3JpcHRpb24sIHByb2R1Y3RfY2F0ZWdvcnksIG1vZGVsLCBzaGlwcGluZ19wcmljZSwgc2hpcHBpbmdfdGltZSxcbiAgICAgIGlzX2NvdXBvbl9leGlzdHMsIGNvdXBvbl90ZXh0LCBmZWF0dXJlX2J1bGxldHMsIGJyYW5kX3VybCwgc2hpcHBpbmdfY29uZGl0aW9uLCBmYWJyaWNfdHlwZSxcbiAgICAgIGNhcmVfaW5zdHJ1Y3Rpb25zLCBvcmlnaW4sIHBhdHRlcm4sIGNvdW50cnlfb2Zfb3JpZ2luXG4gICAgKVxuICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4LCAkOSwgJDEwLCAkMTEsICQxMiwgJDEzLCAkMTQsICQxNSwgJDE2LCAkMTcsICQxOCwgJDE5LCAkMjAsICQyMSwgJDIyLCAkMjMsICQyNCwgJDI1LCAkMjYpXG4gICAgT04gQ09ORkxJQ1QgKHNvdXJjZSwgcHJvZHVjdF9pZCkgRE8gVVBEQVRFIFNFVFxuICAgIG5hbWUgPSBFWENMVURFRC5uYW1lLFxuICAgIGJyYW5kID0gRVhDTFVERUQuYnJhbmQsXG4gICAgcHJpY2UgPSBFWENMVURFRC5wcmljZSxcbiAgICBpbWFnZV91cmwgPSBFWENMVURFRC5pbWFnZV91cmwsXG4gICAgcHJvZHVjdF91cmwgPSBFWENMVURFRC5wcm9kdWN0X3VybCxcbiAgICByYXRpbmcgPSBFWENMVURFRC5yYXRpbmcsXG4gICAgcmV2aWV3X2NvdW50ID0gRVhDTFVERUQucmV2aWV3X2NvdW50LFxuICAgIGF2YWlsYWJpbGl0eSA9IEVYQ0xVREVELmF2YWlsYWJpbGl0eSxcbiAgICBmdWxsX2Rlc2NyaXB0aW9uID0gRVhDTFVERUQuZnVsbF9kZXNjcmlwdGlvbixcbiAgICBzbWFsbF9kZXNjcmlwdGlvbiA9IEVYQ0xVREVELnNtYWxsX2Rlc2NyaXB0aW9uLFxuICAgIHByb2R1Y3RfY2F0ZWdvcnkgPSBFWENMVURFRC5wcm9kdWN0X2NhdGVnb3J5LFxuICAgIG1vZGVsID0gRVhDTFVERUQubW9kZWwsXG4gICAgc2hpcHBpbmdfcHJpY2UgPSBFWENMVURFRC5zaGlwcGluZ19wcmljZSxcbiAgICBzaGlwcGluZ190aW1lID0gRVhDTFVERUQuc2hpcHBpbmdfdGltZSxcbiAgICBpc19jb3Vwb25fZXhpc3RzID0gRVhDTFVERUQuaXNfY291cG9uX2V4aXN0cyxcbiAgICBjb3Vwb25fdGV4dCA9IEVYQ0xVREVELmNvdXBvbl90ZXh0LFxuICAgIGZlYXR1cmVfYnVsbGV0cyA9IEVYQ0xVREVELmZlYXR1cmVfYnVsbGV0cyxcbiAgICBicmFuZF91cmwgPSBFWENMVURFRC5icmFuZF91cmwsXG4gICAgc2hpcHBpbmdfY29uZGl0aW9uID0gRVhDTFVERUQuc2hpcHBpbmdfY29uZGl0aW9uLFxuICAgIGZhYnJpY190eXBlID0gRVhDTFVERUQuZmFicmljX3R5cGUsXG4gICAgY2FyZV9pbnN0cnVjdGlvbnMgPSBFWENMVURFRC5jYXJlX2luc3RydWN0aW9ucyxcbiAgICBvcmlnaW4gPSBFWENMVURFRC5vcmlnaW4sXG4gICAgcGF0dGVybiA9IEVYQ0xVREVELnBhdHRlcm4sXG4gICAgY291bnRyeV9vZl9vcmlnaW4gPSBFWENMVURFRC5jb3VudHJ5X29mX29yaWdpbixcbiAgICB1cGRhdGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVBcbiAgICBSRVRVUk5JTkcgKlxuICBgO1xuICBjb25zdCB2YWx1ZXMgPSBbXG4gICAgcHJvZHVjdC5zb3VyY2UsXG4gICAgcHJvZHVjdC5wcm9kdWN0X2lkLFxuICAgIHByb2R1Y3QubmFtZSxcbiAgICBwcm9kdWN0LmJyYW5kLFxuICAgIHByb2R1Y3QucHJpY2UsXG4gICAgcHJvZHVjdC5pbWFnZV91cmwsXG4gICAgcHJvZHVjdC5wcm9kdWN0X3VybCxcbiAgICBwcm9kdWN0LnJhdGluZyxcbiAgICBwcm9kdWN0LnJldmlld19jb3VudCxcbiAgICBwcm9kdWN0LmF2YWlsYWJpbGl0eSxcbiAgICBwcm9kdWN0LmZ1bGxfZGVzY3JpcHRpb24sXG4gICAgcHJvZHVjdC5zbWFsbF9kZXNjcmlwdGlvbixcbiAgICBwcm9kdWN0LnByb2R1Y3RfY2F0ZWdvcnksXG4gICAgcHJvZHVjdC5tb2RlbCxcbiAgICBwcm9kdWN0LnNoaXBwaW5nX3ByaWNlLFxuICAgIHByb2R1Y3Quc2hpcHBpbmdfdGltZSxcbiAgICBwcm9kdWN0LmlzX2NvdXBvbl9leGlzdHMsXG4gICAgcHJvZHVjdC5jb3Vwb25fdGV4dCxcbiAgICBKU09OLnN0cmluZ2lmeShwcm9kdWN0LmZlYXR1cmVfYnVsbGV0cyksXG4gICAgcHJvZHVjdC5icmFuZF91cmwsXG4gICAgcHJvZHVjdC5zaGlwcGluZ19jb25kaXRpb24sXG4gICAgcHJvZHVjdC5mYWJyaWNfdHlwZSxcbiAgICBwcm9kdWN0LmNhcmVfaW5zdHJ1Y3Rpb25zLFxuICAgIHByb2R1Y3Qub3JpZ2luLFxuICAgIHByb2R1Y3QucGF0dGVybixcbiAgICBwcm9kdWN0LmNvdW50cnlfb2Zfb3JpZ2luXG4gIF07XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9vbC5xdWVyeShxdWVyeSwgdmFsdWVzKTtcbiAgICBjb25zb2xlLmxvZygnUHJvZHVjdCBpbnNlcnRlZC91cGRhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwc2VydGluZyBwcm9kdWN0OicsIGUpO1xuICAgIHRocm93IGU7XG4gIH1cbn1cblxuLy8gRnVuY3Rpb24gdG8gaW5zZXJ0IG9yIHVwZGF0ZSBtdWx0aXBsZSBwcm9kdWN0c1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluc2VydFByb2R1Y3RzKHByb2R1Y3RzKSB7XG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IHBvb2wuY29ubmVjdCgpO1xuICB0cnkge1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQkVHSU4nKTtcbiAgICBmb3IgKGxldCBwcm9kdWN0IG9mIHByb2R1Y3RzKSB7XG4gICAgICBhd2FpdCB1cHNlcnRQcm9kdWN0KHByb2R1Y3QpO1xuICAgIH1cbiAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0NPTU1JVCcpO1xuICAgIGNvbnNvbGUubG9nKCdQcm9kdWN0cyBpbnNlcnRlZC91cGRhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdST0xMQkFDSycpO1xuICAgIHRocm93IGU7XG4gIH0gZmluYWxseSB7XG4gICAgY2xpZW50LnJlbGVhc2UoKTtcbiAgfVxufVxuXG4vLyBGdW5jdGlvbiB0byByZXRyaWV2ZSBwcm9kdWN0c1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFByb2R1Y3RzKHNvdXJjZSwgbGltaXQgPSAxMCkge1xuICBjb25zdCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzIFdIRVJFIHNvdXJjZSA9ICQxIE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQyBMSU1JVCAkMic7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9vbC5xdWVyeShxdWVyeSwgW3NvdXJjZSwgbGltaXRdKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3M7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBwcm9kdWN0czonLCBlKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn1cblxuLy8gRnVuY3Rpb24gdG8gcmV0cmlldmUgYSBzcGVjaWZpYyBwcm9kdWN0XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3BlY2lmaWNQcm9kdWN0KHNvdXJjZSwgcHJvZHVjdElkKSB7XG4gIGNvbnN0IHF1ZXJ5ID0gJ1NFTEVDVCAqIEZST00gcHJvZHVjdHMgV0hFUkUgc291cmNlID0gJDEgQU5EIHByb2R1Y3RfaWQgPSAkMic7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9vbC5xdWVyeShxdWVyeSwgW3NvdXJjZSwgcHJvZHVjdElkXSk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzcGVjaWZpYyBwcm9kdWN0OicsIGUpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8vIEZ1bmN0aW9uIHRvIHN0b3JlIEFQSSByZXN1bHRzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3RvcmVBcGlSZXN1bHRzKGFtYXpvblJlc3VsdHMsIHdhbG1hcnRSZXN1bHRzKSB7XG4gIGNvbnN0IGFtYXpvblByb2R1Y3RzID0gcHJvY2Vzc0FwaVJlc3VsdHMoYW1hem9uUmVzdWx0cywgJ2FtYXpvbicpO1xuICBjb25zdCB3YWxtYXJ0UHJvZHVjdHMgPSBwcm9jZXNzQXBpUmVzdWx0cyh3YWxtYXJ0UmVzdWx0cywgJ3dhbG1hcnQnKTtcbiAgXG4gIHRyeSB7XG4gICAgYXdhaXQgaW5zZXJ0UHJvZHVjdHMoWy4uLmFtYXpvblByb2R1Y3RzLCAuLi53YWxtYXJ0UHJvZHVjdHNdKTtcbiAgICBjb25zb2xlLmxvZygnQVBJIHJlc3VsdHMgc3RvcmVkIHN1Y2Nlc3NmdWxseScpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3Igc3RvcmluZyBBUEkgcmVzdWx0czonLCBlKTtcbiAgfVxufVxuXG4vLyBGdW5jdGlvbiB0byB1cGRhdGUgcHJvZHVjdCBwcmljZSBhbmQgYWRkIHRvIHByaWNlIGhpc3RvcnlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVQcm9kdWN0UHJpY2UocHJvZHVjdElkLCBzb3VyY2UsIGN1cnJlbnRQcmljZSwgb3JpZ2luYWxQcmljZSA9IG51bGwpIHtcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgcG9vbC5jb25uZWN0KCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdCRUdJTicpO1xuXG4gICAgLy8gVXBkYXRlIHRoZSBwcm9kdWN0J3MgY3VycmVudCBwcmljZVxuICAgIGNvbnN0IHVwZGF0ZVByb2R1Y3RRdWVyeSA9IGBcbiAgICAgIFVQREFURSBwcm9kdWN0c1xuICAgICAgU0VUIHByaWNlID0gJDEsIHVwZGF0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgV0hFUkUgcHJvZHVjdF9pZCA9ICQyIEFORCBzb3VyY2UgPSAkM1xuICAgIGA7XG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KHVwZGF0ZVByb2R1Y3RRdWVyeSwgW2N1cnJlbnRQcmljZSwgcHJvZHVjdElkLCBzb3VyY2VdKTtcblxuICAgIC8vIEFkZCBlbnRyeSB0byBwcmljZSBoaXN0b3J5XG4gICAgY29uc3QgaW5zZXJ0UHJpY2VIaXN0b3J5UXVlcnkgPSBgXG4gICAgICBJTlNFUlQgSU5UTyBwcmljZV9oaXN0b3J5IChwcm9kdWN0X2lkLCBzb3VyY2UsIGN1cnJlbnRfcHJpY2UsIG9yaWdpbmFsX3ByaWNlKVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNClcbiAgICBgO1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeShpbnNlcnRQcmljZUhpc3RvcnlRdWVyeSwgW3Byb2R1Y3RJZCwgc291cmNlLCBjdXJyZW50UHJpY2UsIG9yaWdpbmFsUHJpY2VdKTtcblxuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQ09NTUlUJyk7XG4gICAgY29uc29sZS5sb2coYFByaWNlIHVwZGF0ZWQgZm9yIHByb2R1Y3QgJHtwcm9kdWN0SWR9YCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBhd2FpdCBjbGllbnQucXVlcnkoJ1JPTExCQUNLJyk7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZHVjdCBwcmljZTonLCBlKTtcbiAgICB0aHJvdyBlO1xuICB9IGZpbmFsbHkge1xuICAgIGNsaWVudC5yZWxlYXNlKCk7XG4gIH1cbn1cblxuLy8gRnVuY3Rpb24gdG8gZ2V0IHByaWNlIGhpc3RvcnkgZm9yIGEgcHJvZHVjdFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFByb2R1Y3RQcmljZUhpc3RvcnkocHJvZHVjdElkLCBzb3VyY2UpIHtcbiAgY29uc3QgcXVlcnkgPSBgXG4gICAgU0VMRUNUICogRlJPTSBwcmljZV9oaXN0b3J5XG4gICAgV0hFUkUgcHJvZHVjdF9pZCA9ICQxIEFORCBzb3VyY2UgPSAkMlxuICAgIE9SREVSIEJZIHRpbWVzdGFtcCBERVNDXG4gIGA7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9vbC5xdWVyeShxdWVyeSwgW3Byb2R1Y3RJZCwgc291cmNlXSk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJpY2UgaGlzdG9yeTonLCBlKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn1cblxuZXhwb3J0IHsgcG9vbCB9OyJdLCJuYW1lcyI6WyJQb29sIiwicG9vbCIsImNvbm5lY3Rpb25TdHJpbmciLCJwcm9jZXNzIiwiZW52IiwiREFUQUJBU0VfVVJMIiwic3NsIiwicmVqZWN0VW5hdXRob3JpemVkIiwicHJvY2Vzc0FwaVJlc3VsdHMiLCJyZXN1bHRzIiwic291cmNlIiwibWFwIiwiaXRlbSIsInByb2R1Y3RfaWQiLCJpZCIsImFzaW4iLCJuYW1lIiwidGl0bGUiLCJicmFuZCIsInByaWNlIiwicGFyc2VGbG9hdCIsInByaWNlX3N0cmluZyIsInJlcGxhY2UiLCJpbWFnZV91cmwiLCJpbWFnZSIsInByb2R1Y3RfdXJsIiwidXJsIiwibGluayIsInJhdGluZyIsImF2ZXJhZ2VfcmF0aW5nIiwic3RhcnMiLCJyZXZpZXdfY291bnQiLCJwYXJzZUludCIsIm51bWJlcl9vZl9yZXZpZXdzIiwidG90YWxfcmV2aWV3cyIsImF2YWlsYWJpbGl0eSIsImZ1bGxfZGVzY3JpcHRpb24iLCJzbWFsbF9kZXNjcmlwdGlvbiIsInByb2R1Y3RfY2F0ZWdvcnkiLCJtb2RlbCIsInNoaXBwaW5nX3ByaWNlIiwic2hpcHBpbmdfdGltZSIsImlzX2NvdXBvbl9leGlzdHMiLCJjb3Vwb25fdGV4dCIsImZlYXR1cmVfYnVsbGV0cyIsIkFycmF5IiwiaXNBcnJheSIsImJyYW5kX3VybCIsInNoaXBwaW5nX2NvbmRpdGlvbiIsImZhYnJpY190eXBlIiwiY2FyZV9pbnN0cnVjdGlvbnMiLCJvcmlnaW4iLCJwYXR0ZXJuIiwiY291bnRyeV9vZl9vcmlnaW4iLCJ1cHNlcnRQcm9kdWN0IiwicHJvZHVjdCIsInF1ZXJ5IiwidmFsdWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc3VsdCIsImNvbnNvbGUiLCJsb2ciLCJyb3dzIiwiZSIsImVycm9yIiwiaW5zZXJ0UHJvZHVjdHMiLCJwcm9kdWN0cyIsImNsaWVudCIsImNvbm5lY3QiLCJyZWxlYXNlIiwiZ2V0UHJvZHVjdHMiLCJsaW1pdCIsImdldFNwZWNpZmljUHJvZHVjdCIsInByb2R1Y3RJZCIsInN0b3JlQXBpUmVzdWx0cyIsImFtYXpvblJlc3VsdHMiLCJ3YWxtYXJ0UmVzdWx0cyIsImFtYXpvblByb2R1Y3RzIiwid2FsbWFydFByb2R1Y3RzIiwidXBkYXRlUHJvZHVjdFByaWNlIiwiY3VycmVudFByaWNlIiwib3JpZ2luYWxQcmljZSIsInVwZGF0ZVByb2R1Y3RRdWVyeSIsImluc2VydFByaWNlSGlzdG9yeVF1ZXJ5IiwiZ2V0UHJvZHVjdFByaWNlSGlzdG9yeSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/db.js\n");

/***/ }),

/***/ "(api)/./pages/api/list.js":
/*!***************************!*\
  !*** ./pages/api/list.js ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _auth0_nextjs_auth0__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @auth0/nextjs-auth0 */ \"@auth0/nextjs-auth0\");\n/* harmony import */ var _auth0_nextjs_auth0__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_auth0_nextjs_auth0__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/db */ \"(api)/./lib/db.js\");\n/* harmony import */ var _search__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./search */ \"(api)/./pages/api/search.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_search__WEBPACK_IMPORTED_MODULE_2__]);\n_search__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n // Make sure this import path is correct\nasync function handler(req, res) {\n    try {\n        const session = await (0,_auth0_nextjs_auth0__WEBPACK_IMPORTED_MODULE_0__.getSession)(req, res);\n        if (!session || !session.user) {\n            return res.status(401).json({\n                error: \"Unauthorized\"\n            });\n        }\n        const userId = session.user.sub;\n        switch(req.method){\n            case \"POST\":\n                try {\n                    console.log(\"Received POST request:\", req.body);\n                    const { product_id, name, price, quantity = 1, image_url, source, ...otherFields } = req.body;\n                    // Check if upsertProduct is a function\n                    if (typeof _lib_db__WEBPACK_IMPORTED_MODULE_1__.upsertProduct !== \"function\") {\n                        throw new Error(\"upsertProduct is not a function\");\n                    }\n                    // Use the upsertProduct function\n                    const productResult = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.upsertProduct)({\n                        product_id,\n                        source,\n                        name,\n                        price,\n                        image_url,\n                        ...otherFields\n                    });\n                    console.log(\"Product insert/update result:\", productResult);\n                    // Now, add or update the item in the list_items table\n                    const listItemResult = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.pool.query(`INSERT INTO list_items (user_id, product_id, source, quantity)\n             VALUES ($1, $2, $3, $4)\n             ON CONFLICT (user_id, product_id, source) \n             DO UPDATE SET quantity = list_items.quantity + EXCLUDED.quantity\n             RETURNING *`, [\n                        userId,\n                        product_id,\n                        source,\n                        quantity\n                    ]);\n                    console.log(\"List item insert/update result:\", listItemResult.rows[0]);\n                    // Update the price history\n                    await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.updateProductPrice)(product_id, source, price);\n                    res.status(200).json(listItemResult.rows[0]);\n                } catch (error) {\n                    console.error(\"Error adding item to list:\", error);\n                    res.status(500).json({\n                        error: \"Internal Server Error\",\n                        details: error.message,\n                        stack: error.stack\n                    });\n                }\n                break;\n            case \"GET\":\n                try {\n                    const result = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.pool.query(`SELECT p.*, l.quantity, l.user_id\n             FROM list_items l\n             JOIN products p ON l.product_id = p.product_id AND l.source = p.source\n             WHERE l.user_id = $1`, [\n                        userId\n                    ]);\n                    res.status(200).json(result.rows);\n                } catch (error) {\n                    console.error(\"Error fetching list:\", error);\n                    res.status(500).json({\n                        error: \"Internal Server Error\",\n                        details: error.message\n                    });\n                }\n                break;\n            case \"DELETE\":\n                try {\n                    await _lib_db__WEBPACK_IMPORTED_MODULE_1__.pool.query(\"DELETE FROM list_items WHERE user_id = $1\", [\n                        userId\n                    ]);\n                    res.status(200).json({\n                        message: \"List cleared successfully\"\n                    });\n                } catch (error) {\n                    console.error(\"Error clearing list:\", error);\n                    res.status(500).json({\n                        error: \"Internal Server Error\",\n                        details: error.message\n                    });\n                }\n                break;\n            case \"PUT\":\n                try {\n                    console.log(\"Refresh request received\");\n                    // Fetch the user's current list\n                    const currentList = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.pool.query(`SELECT p.*, l.quantity\n             FROM list_items l\n             JOIN products p ON l.product_id = p.product_id AND l.source = p.source\n             WHERE l.user_id = $1`, [\n                        userId\n                    ]);\n                    console.log(\"Current list fetched:\", currentList.rows);\n                    // Refresh each item in the list\n                    const refreshedItems = await Promise.all(currentList.rows.map(async (item)=>{\n                        try {\n                            console.log(`Fetching fresh data for ${item.product_id} from ${item.source}`);\n                            // Fetch fresh data from ScraperAPI\n                            const { results } = await (0,_search__WEBPACK_IMPORTED_MODULE_2__.fetchProducts)(item.product_id, item.source, null, 1);\n                            console.log(`ScraperAPI response for ${item.product_id}:`, results);\n                            if (results && results.length > 0) {\n                                const freshData = results[0];\n                                console.log(`Updating database for ${item.product_id}`);\n                                // Use the upsertProduct function\n                                if (typeof _lib_db__WEBPACK_IMPORTED_MODULE_1__.upsertProduct !== \"function\") {\n                                    throw new Error(\"upsertProduct is not a function\");\n                                }\n                                await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.upsertProduct)(freshData);\n                                // Update the price history\n                                await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.updateProductPrice)(item.product_id, item.source, freshData.price);\n                                console.log(`Database updated for ${item.product_id}`);\n                                // Return both old and new data for comparison\n                                return {\n                                    old: item,\n                                    new: {\n                                        ...freshData,\n                                        quantity: item.quantity\n                                    }\n                                };\n                            } else {\n                                console.warn(`No fresh data found for product ${item.product_id} from ${item.source}`);\n                                return {\n                                    old: item,\n                                    new: item\n                                };\n                            }\n                        } catch (error) {\n                            console.error(`Error refreshing item ${item.product_id} from ${item.source}:`, error);\n                            return {\n                                old: item,\n                                new: item,\n                                error: error.message\n                            };\n                        }\n                    }));\n                    console.log(\"All items refreshed\");\n                    res.status(200).json(refreshedItems);\n                } catch (error) {\n                    console.error(\"Error refreshing list:\", error);\n                    res.status(500).json({\n                        error: \"Internal Server Error\",\n                        details: error.message\n                    });\n                }\n                break;\n            default:\n                res.setHeader(\"Allow\", [\n                    \"GET\",\n                    \"POST\",\n                    \"DELETE\",\n                    \"PUT\"\n                ]);\n                res.status(405).end(`Method ${req.method} Not Allowed`);\n        }\n    } catch (error) {\n        console.error(\"Unexpected error:\", error);\n        res.status(500).json({\n            error: \"Internal Server Error\",\n            details: error.message,\n            stack: error.stack\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJRyxNQUFNLENBQUMsS0FBS3NDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRTFDLElBQUlTLE1BQU0sQ0FBQyxZQUFZLENBQUM7UUFDMUQ7SUFDRixFQUFFLE9BQU9ILE9BQU87UUFDZEksUUFBUUosS0FBSyxDQUFDLHFCQUFxQkE7UUFDbkNMLElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztZQUF5Qm1CLFNBQVNuQixNQUFNb0IsT0FBTztZQUFFQyxPQUFPckIsTUFBTXFCLEtBQUs7UUFBQztJQUNwRztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktZ3JhcGhxbC1wcm9qZWN0Ly4vcGFnZXMvYXBpL2xpc3QuanM/MDE1ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRTZXNzaW9uIH0gZnJvbSAnQGF1dGgwL25leHRqcy1hdXRoMCc7XG5pbXBvcnQgeyBwb29sLCB1cHNlcnRQcm9kdWN0LCB1cGRhdGVQcm9kdWN0UHJpY2UgIH0gZnJvbSAnLi4vLi4vbGliL2RiJztcbmltcG9ydCB7IGZldGNoUHJvZHVjdHMgfSBmcm9tICcuL3NlYXJjaCc7IC8vIE1ha2Ugc3VyZSB0aGlzIGltcG9ydCBwYXRoIGlzIGNvcnJlY3RcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICB0cnkge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uKHJlcSwgcmVzKTtcblxuICAgIGlmICghc2Vzc2lvbiB8fCAhc2Vzc2lvbi51c2VyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgdXNlcklkID0gc2Vzc2lvbi51c2VyLnN1YjtcblxuICAgIHN3aXRjaCAocmVxLm1ldGhvZCkge1xuICAgICAgY2FzZSAnUE9TVCc6XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1JlY2VpdmVkIFBPU1QgcmVxdWVzdDonLCByZXEuYm9keSk7XG4gICAgICAgICAgY29uc3QgeyBwcm9kdWN0X2lkLCBuYW1lLCBwcmljZSwgcXVhbnRpdHkgPSAxLCBpbWFnZV91cmwsIHNvdXJjZSwgLi4ub3RoZXJGaWVsZHMgfSA9IHJlcS5ib2R5O1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIGlmIHVwc2VydFByb2R1Y3QgaXMgYSBmdW5jdGlvblxuICAgICAgICAgIGlmICh0eXBlb2YgdXBzZXJ0UHJvZHVjdCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd1cHNlcnRQcm9kdWN0IGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVXNlIHRoZSB1cHNlcnRQcm9kdWN0IGZ1bmN0aW9uXG4gICAgICAgICAgY29uc3QgcHJvZHVjdFJlc3VsdCA9IGF3YWl0IHVwc2VydFByb2R1Y3Qoe1xuICAgICAgICAgICAgcHJvZHVjdF9pZCxcbiAgICAgICAgICAgIHNvdXJjZSxcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBwcmljZSxcbiAgICAgICAgICAgIGltYWdlX3VybCxcbiAgICAgICAgICAgIC4uLm90aGVyRmllbGRzXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1Byb2R1Y3QgaW5zZXJ0L3VwZGF0ZSByZXN1bHQ6JywgcHJvZHVjdFJlc3VsdCk7XG5cbiAgICAgICAgICAvLyBOb3csIGFkZCBvciB1cGRhdGUgdGhlIGl0ZW0gaW4gdGhlIGxpc3RfaXRlbXMgdGFibGVcbiAgICAgICAgICBjb25zdCBsaXN0SXRlbVJlc3VsdCA9IGF3YWl0IHBvb2wucXVlcnkoXG4gICAgICAgICAgICBgSU5TRVJUIElOVE8gbGlzdF9pdGVtcyAodXNlcl9pZCwgcHJvZHVjdF9pZCwgc291cmNlLCBxdWFudGl0eSlcbiAgICAgICAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0KVxuICAgICAgICAgICAgIE9OIENPTkZMSUNUICh1c2VyX2lkLCBwcm9kdWN0X2lkLCBzb3VyY2UpIFxuICAgICAgICAgICAgIERPIFVQREFURSBTRVQgcXVhbnRpdHkgPSBsaXN0X2l0ZW1zLnF1YW50aXR5ICsgRVhDTFVERUQucXVhbnRpdHlcbiAgICAgICAgICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICAgICAgICBbdXNlcklkLCBwcm9kdWN0X2lkLCBzb3VyY2UsIHF1YW50aXR5XVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0xpc3QgaXRlbSBpbnNlcnQvdXBkYXRlIHJlc3VsdDonLCBsaXN0SXRlbVJlc3VsdC5yb3dzWzBdKTtcblxuICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgcHJpY2UgaGlzdG9yeVxuICAgICAgICAgIGF3YWl0IHVwZGF0ZVByb2R1Y3RQcmljZShwcm9kdWN0X2lkLCBzb3VyY2UsIHByaWNlKTtcblxuICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKGxpc3RJdGVtUmVzdWx0LnJvd3NbMF0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFkZGluZyBpdGVtIHRvIGxpc3Q6JywgZXJyb3IpO1xuICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLCBkZXRhaWxzOiBlcnJvci5tZXNzYWdlLCBzdGFjazogZXJyb3Iuc3RhY2sgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0dFVCc6XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9vbC5xdWVyeShcbiAgICAgICAgICAgIGBTRUxFQ1QgcC4qLCBsLnF1YW50aXR5LCBsLnVzZXJfaWRcbiAgICAgICAgICAgICBGUk9NIGxpc3RfaXRlbXMgbFxuICAgICAgICAgICAgIEpPSU4gcHJvZHVjdHMgcCBPTiBsLnByb2R1Y3RfaWQgPSBwLnByb2R1Y3RfaWQgQU5EIGwuc291cmNlID0gcC5zb3VyY2VcbiAgICAgICAgICAgICBXSEVSRSBsLnVzZXJfaWQgPSAkMWAsXG4gICAgICAgICAgICBbdXNlcklkXVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVzdWx0LnJvd3MpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGxpc3Q6JywgZXJyb3IpO1xuICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLCBkZXRhaWxzOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdERUxFVEUnOlxuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHBvb2wucXVlcnkoJ0RFTEVURSBGUk9NIGxpc3RfaXRlbXMgV0hFUkUgdXNlcl9pZCA9ICQxJywgW3VzZXJJZF0pO1xuICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogJ0xpc3QgY2xlYXJlZCBzdWNjZXNzZnVsbHknIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNsZWFyaW5nIGxpc3Q6JywgZXJyb3IpO1xuICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLCBkZXRhaWxzOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdQVVQnOlxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdSZWZyZXNoIHJlcXVlc3QgcmVjZWl2ZWQnKTtcbiAgICAgICAgICAvLyBGZXRjaCB0aGUgdXNlcidzIGN1cnJlbnQgbGlzdFxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ID0gYXdhaXQgcG9vbC5xdWVyeShcbiAgICAgICAgICAgIGBTRUxFQ1QgcC4qLCBsLnF1YW50aXR5XG4gICAgICAgICAgICAgRlJPTSBsaXN0X2l0ZW1zIGxcbiAgICAgICAgICAgICBKT0lOIHByb2R1Y3RzIHAgT04gbC5wcm9kdWN0X2lkID0gcC5wcm9kdWN0X2lkIEFORCBsLnNvdXJjZSA9IHAuc291cmNlXG4gICAgICAgICAgICAgV0hFUkUgbC51c2VyX2lkID0gJDFgLFxuICAgICAgICAgICAgW3VzZXJJZF1cbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdDdXJyZW50IGxpc3QgZmV0Y2hlZDonLCBjdXJyZW50TGlzdC5yb3dzKTtcblxuICAgICAgICAgIC8vIFJlZnJlc2ggZWFjaCBpdGVtIGluIHRoZSBsaXN0XG4gICAgICAgICAgY29uc3QgcmVmcmVzaGVkSXRlbXMgPSBhd2FpdCBQcm9taXNlLmFsbChjdXJyZW50TGlzdC5yb3dzLm1hcChhc3luYyAoaXRlbSkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYEZldGNoaW5nIGZyZXNoIGRhdGEgZm9yICR7aXRlbS5wcm9kdWN0X2lkfSBmcm9tICR7aXRlbS5zb3VyY2V9YCk7XG4gICAgICAgICAgICAgIC8vIEZldGNoIGZyZXNoIGRhdGEgZnJvbSBTY3JhcGVyQVBJXG4gICAgICAgICAgICAgIGNvbnN0IHsgcmVzdWx0cyB9ID0gYXdhaXQgZmV0Y2hQcm9kdWN0cyhpdGVtLnByb2R1Y3RfaWQsIGl0ZW0uc291cmNlLCBudWxsLCAxKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYFNjcmFwZXJBUEkgcmVzcG9uc2UgZm9yICR7aXRlbS5wcm9kdWN0X2lkfTpgLCByZXN1bHRzKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGlmIChyZXN1bHRzICYmIHJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZyZXNoRGF0YSA9IHJlc3VsdHNbMF07XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVXBkYXRpbmcgZGF0YWJhc2UgZm9yICR7aXRlbS5wcm9kdWN0X2lkfWApO1xuICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgdXBzZXJ0UHJvZHVjdCBmdW5jdGlvblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdXBzZXJ0UHJvZHVjdCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd1cHNlcnRQcm9kdWN0IGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGF3YWl0IHVwc2VydFByb2R1Y3QoZnJlc2hEYXRhKTtcblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgcHJpY2UgaGlzdG9yeVxuICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZVByb2R1Y3RQcmljZShpdGVtLnByb2R1Y3RfaWQsIGl0ZW0uc291cmNlLCBmcmVzaERhdGEucHJpY2UpO1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYERhdGFiYXNlIHVwZGF0ZWQgZm9yICR7aXRlbS5wcm9kdWN0X2lkfWApO1xuICAgICAgICAgICAgICAgIC8vIFJldHVybiBib3RoIG9sZCBhbmQgbmV3IGRhdGEgZm9yIGNvbXBhcmlzb25cbiAgICAgICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICAgIG9sZDogaXRlbSxcbiAgICAgICAgICAgICAgICAgIG5ldzogeyAuLi5mcmVzaERhdGEsIHF1YW50aXR5OiBpdGVtLnF1YW50aXR5IH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgTm8gZnJlc2ggZGF0YSBmb3VuZCBmb3IgcHJvZHVjdCAke2l0ZW0ucHJvZHVjdF9pZH0gZnJvbSAke2l0ZW0uc291cmNlfWApO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IG9sZDogaXRlbSwgbmV3OiBpdGVtIH07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHJlZnJlc2hpbmcgaXRlbSAke2l0ZW0ucHJvZHVjdF9pZH0gZnJvbSAke2l0ZW0uc291cmNlfTpgLCBlcnJvcik7XG4gICAgICAgICAgICAgIHJldHVybiB7IG9sZDogaXRlbSwgbmV3OiBpdGVtLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pKTtcblxuICAgICAgICAgIGNvbnNvbGUubG9nKCdBbGwgaXRlbXMgcmVmcmVzaGVkJyk7XG4gICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVmcmVzaGVkSXRlbXMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZnJlc2hpbmcgbGlzdDonLCBlcnJvcik7XG4gICAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ludGVybmFsIFNlcnZlciBFcnJvcicsIGRldGFpbHM6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydHRVQnLCAnUE9TVCcsICdERUxFVEUnLCAnUFVUJ10pO1xuICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnSW50ZXJuYWwgU2VydmVyIEVycm9yJywgZGV0YWlsczogZXJyb3IubWVzc2FnZSwgc3RhY2s6IGVycm9yLnN0YWNrIH0pO1xuICB9XG59Il0sIm5hbWVzIjpbImdldFNlc3Npb24iLCJwb29sIiwidXBzZXJ0UHJvZHVjdCIsInVwZGF0ZVByb2R1Y3RQcmljZSIsImZldGNoUHJvZHVjdHMiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwic2Vzc2lvbiIsInVzZXIiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJ1c2VySWQiLCJzdWIiLCJtZXRob2QiLCJjb25zb2xlIiwibG9nIiwiYm9keSIsInByb2R1Y3RfaWQiLCJuYW1lIiwicHJpY2UiLCJxdWFudGl0eSIsImltYWdlX3VybCIsInNvdXJjZSIsIm90aGVyRmllbGRzIiwiRXJyb3IiLCJwcm9kdWN0UmVzdWx0IiwibGlzdEl0ZW1SZXN1bHQiLCJxdWVyeSIsInJvd3MiLCJkZXRhaWxzIiwibWVzc2FnZSIsInN0YWNrIiwicmVzdWx0IiwiY3VycmVudExpc3QiLCJyZWZyZXNoZWRJdGVtcyIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJpdGVtIiwicmVzdWx0cyIsImxlbmd0aCIsImZyZXNoRGF0YSIsIm9sZCIsIm5ldyIsIndhcm4iLCJzZXRIZWFkZXIiLCJlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/list.js\n");

/***/ }),

/***/ "(api)/./pages/api/search.js":
/*!*****************************!*\
  !*** ./pages/api/search.js ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cacheHelper: () => (/* binding */ cacheHelper),\n/* harmony export */   \"default\": () => (/* binding */ handler),\n/* harmony export */   fetchProducts: () => (/* binding */ fetchProducts),\n/* harmony export */   mapProduct: () => (/* binding */ mapProduct),\n/* harmony export */   streamResults: () => (/* binding */ streamResults)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/db */ \"(api)/./lib/db.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Initialize Redis client with fallback\nlet redisClient;\ntry {\n    redisClient = new (ioredis__WEBPACK_IMPORTED_MODULE_1___default())(process.env.REDIS_URL, {\n        maxRetriesPerRequest: 1,\n        retryStrategy: ()=>null\n    });\n    redisClient.on(\"error\", (err)=>{\n        console.warn(\"Redis Client Error:\", err);\n        redisClient = null; // Disable Redis client on error\n    });\n} catch (error) {\n    console.warn(\"Failed to initialize Redis:\", error);\n    redisClient = null;\n}\n// Cache helper function\nconst cacheHelper = {\n    get: async (key)=>{\n        if (redisClient) {\n            try {\n                return await redisClient.get(key);\n            } catch (error) {\n                console.warn(\"Redis get error:\", error);\n            }\n        }\n        return null;\n    },\n    set: async (key, value, options)=>{\n        if (redisClient) {\n            try {\n                await redisClient.set(key, value, options);\n            } catch (error) {\n                console.warn(\"Redis set error:\", error);\n            }\n        }\n    }\n};\nconst mapProduct = (item, source)=>{\n    console.log(`Mapping product from ${source}:`, JSON.stringify(item, null, 2));\n    const parsePrice = (price)=>{\n        if (typeof price === \"number\") return price;\n        if (typeof price === \"string\") return Number(price.replace(/[^0-9.-]+/g, \"\"));\n        return null;\n    };\n    if (source === \"walmart\") {\n        return {\n            source: \"walmart\",\n            product_id: item.id || \"\",\n            name: item.name || \"\",\n            brand: item.brand || \"N/A\",\n            price: parsePrice(item.price),\n            image_url: item.image || \"\",\n            product_url: item.url || \"\",\n            rating: item.rating?.average_rating ? Number(item.rating.average_rating) : null,\n            review_count: item.rating?.number_of_reviews || 0,\n            availability: item.availability || \"Unavailable\",\n            full_description: item.full_description || \"\",\n            product_category: item.product_category || \"\",\n            model: item.model || \"\",\n            small_description: item.small_description || \"\"\n        };\n    } else if (source === \"amazon\") {\n        return {\n            source: \"amazon\",\n            product_id: item.asin || \"\",\n            name: item.name || item.title || \"\",\n            brand: item.brand || \"N/A\",\n            price: parsePrice(item.price),\n            image_url: item.image || item.images && item.images[0] || \"\",\n            product_url: item.url || item.link || \"\",\n            rating: item.stars ? Number(item.stars) : null,\n            review_count: item.total_reviews || item.ratings_total || 0,\n            availability: item.availability || \"Unavailable\",\n            full_description: item.full_description || \"\",\n            product_category: item.product_category || \"\",\n            model: item.model || \"\",\n            small_description: item.small_description || \"\"\n        };\n    }\n};\nconst filterSponsoredProducts = (products)=>{\n    return products.filter((product)=>!product.sponsored);\n};\nconst fetchProducts = async (term, source, sortBy, page = 1)=>{\n    let url;\n    let params;\n    // Remove any quotes from the API key\n    const apiKey = process.env.SCRAPER_API_KEY.replace(/[''\"]+/g, \"\");\n    if (source === \"amazon\") {\n        if (term.match(/^[A-Z0-9]{10}$/)) {\n            url = `https://api.scraperapi.com/structured/amazon/product`;\n            params = {\n                api_key: apiKey,\n                asin: term,\n                country_code: \"us\",\n                tld: \"com\"\n            };\n        } else {\n            url = `https://api.scraperapi.com/structured/amazon/search`;\n            params = {\n                api_key: apiKey,\n                query: term,\n                country: \"us\",\n                page: page.toString(),\n                sort_by: sortBy || \"\",\n                exclude_sponsored: \"true\"\n            };\n        }\n    } else if (source === \"walmart\") {\n        if (term.match(/^[0-9]+$/)) {\n            url = `https://api.scraperapi.com/structured/walmart/product`;\n            params = {\n                api_key: apiKey,\n                product_id: term,\n                country_code: \"us\",\n                tld: \"com\"\n            };\n        } else {\n            url = `https://api.scraperapi.com/structured/walmart/search`;\n            params = {\n                api_key: apiKey,\n                query: term,\n                country: \"us\",\n                page: page.toString(),\n                sort_by: sortBy || \"\",\n                exclude_sponsored: \"true\"\n            };\n        }\n    }\n    try {\n        console.log(`Fetching ${source} results for term: \"${term}\", page: ${page}, sortBy: ${sortBy}`);\n        console.log(\"API Request URL:\", url);\n        console.log(\"API Request Params:\", {\n            ...params,\n            api_key: \"[REDACTED]\"\n        });\n        const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(url, {\n            params,\n            timeout: 30000\n        });\n        console.log(`Raw API response from ${source}:`, JSON.stringify(response.data, null, 2));\n        let jsonData = response.data;\n        if (source === \"amazon\" && term.match(/^[A-Z0-9]{10}$/) || source === \"walmart\" && term.match(/^[0-9]+$/)) {\n            // If it's a product query, wrap the result in an array\n            const mappedProduct = mapProduct(jsonData, source);\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.insertProducts)([\n                mappedProduct\n            ]);\n            return {\n                results: [\n                    mappedProduct\n                ],\n                totalPages: 1\n            };\n        } else {\n            // For search queries, process as before\n            let results = [];\n            let totalPages = 1;\n            if (source === \"walmart\" && jsonData.items && Array.isArray(jsonData.items)) {\n                results = jsonData.items;\n                totalPages = jsonData.total_pages || 1;\n            } else if (source === \"amazon\" && jsonData.results) {\n                results = jsonData.results;\n                totalPages = jsonData.total_pages || 1;\n            } else {\n                console.error(`Invalid API response structure from ${source}:`, jsonData);\n                throw new Error(`Invalid API response structure from ${source}`);\n            }\n            const mappedResults = results.map((item)=>mapProduct(item, source));\n            console.log(`Mapped results for ${source}:`, JSON.stringify(mappedResults, null, 2));\n            // Insert all products into the database\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.insertProducts)(mappedResults);\n            return {\n                results: filterSponsoredProducts(mappedResults),\n                totalPages\n            };\n        }\n    } catch (error) {\n        console.error(`Error fetching data from ${source} API:`, error.message);\n        console.error(`Error details:`, error.response ? error.response.data : \"No response data\");\n        throw error;\n    }\n};\nconst streamResults = async (sourceToFetch, term, sort_by, page)=>{\n    const cacheKey = `search:${sourceToFetch}:${term}:${sort_by}:${page}`;\n    try {\n        const cachedResults = await cacheHelper.get(cacheKey);\n        if (cachedResults) {\n            console.log(`Using cached results for ${sourceToFetch}`);\n            return {\n                source: sourceToFetch,\n                ...JSON.parse(cachedResults)\n            };\n        } else {\n            console.log(`Fetching fresh results for ${sourceToFetch}`);\n            // First, try to get results from our database\n            let dbResults = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.getProducts)(sourceToFetch, term, parseInt(page), 20); // Assuming 20 results per page\n            if (dbResults.length > 0) {\n                console.log(`Found ${dbResults.length} results in database for ${sourceToFetch}`);\n                return {\n                    source: sourceToFetch,\n                    results: dbResults,\n                    totalPages: Math.ceil(dbResults.length / 20)\n                };\n            } else {\n                // If no results in database, fetch from API\n                const { results: sourceResults, totalPages } = await fetchProducts(term, sourceToFetch, sort_by, parseInt(page));\n                await cacheHelper.set(cacheKey, JSON.stringify({\n                    results: sourceResults,\n                    totalPages\n                }), {\n                    EX: 3600\n                }); // Cache for 1 hour\n                return {\n                    source: sourceToFetch,\n                    results: sourceResults,\n                    totalPages\n                };\n            }\n        }\n    } catch (error) {\n        console.error(`Error streaming results from ${sourceToFetch}:`, error.message);\n        return {\n            source: sourceToFetch,\n            error: `Failed to fetch data from ${sourceToFetch}: ${error.message}`,\n            details: error.response ? error.response.data : \"No response data\"\n        };\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"GET\") {\n        return res.status(405).end();\n    }\n    const { term, page = \"1\", sort_by, source = \"all\" } = req.query;\n    res.setHeader(\"Content-Type\", \"application/json\");\n    let results = [];\n    if (source === \"all\") {\n        results = await Promise.all([\n            streamResults(\"walmart\", term, sort_by, page),\n            streamResults(\"amazon\", term, sort_by, page)\n        ]);\n    } else {\n        results = [\n            await streamResults(source, term, sort_by, page)\n        ];\n    }\n    res.status(200).json(results);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cm9qZWN0Ly4vcGFnZXMvYXBpL3NlYXJjaC5qcz81ZDNhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgUmVkaXMgZnJvbSAnaW9yZWRpcyc7XG5pbXBvcnQgeyBpbnNlcnRQcm9kdWN0cywgZ2V0UHJvZHVjdHMgfSBmcm9tICcuLi8uLi9saWIvZGInO1xuXG4vLyBJbml0aWFsaXplIFJlZGlzIGNsaWVudCB3aXRoIGZhbGxiYWNrXG5sZXQgcmVkaXNDbGllbnQ7XG50cnkge1xuICByZWRpc0NsaWVudCA9IG5ldyBSZWRpcyhwcm9jZXNzLmVudi5SRURJU19VUkwsIHtcbiAgICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogMSxcbiAgICByZXRyeVN0cmF0ZWd5OiAoKSA9PiBudWxsXG4gIH0pO1xuICByZWRpc0NsaWVudC5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgY29uc29sZS53YXJuKCdSZWRpcyBDbGllbnQgRXJyb3I6JywgZXJyKTtcbiAgICByZWRpc0NsaWVudCA9IG51bGw7IC8vIERpc2FibGUgUmVkaXMgY2xpZW50IG9uIGVycm9yXG4gIH0pO1xufSBjYXRjaCAoZXJyb3IpIHtcbiAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBSZWRpczonLCBlcnJvcik7XG4gIHJlZGlzQ2xpZW50ID0gbnVsbDtcbn1cblxuLy8gQ2FjaGUgaGVscGVyIGZ1bmN0aW9uXG5leHBvcnQgY29uc3QgY2FjaGVIZWxwZXIgPSB7XG4gIGdldDogYXN5bmMgKGtleSkgPT4ge1xuICAgIGlmIChyZWRpc0NsaWVudCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHJlZGlzQ2xpZW50LmdldChrZXkpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdSZWRpcyBnZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgc2V0OiBhc3luYyAoa2V5LCB2YWx1ZSwgb3B0aW9ucykgPT4ge1xuICAgIGlmIChyZWRpc0NsaWVudCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcmVkaXNDbGllbnQuc2V0KGtleSwgdmFsdWUsIG9wdGlvbnMpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdSZWRpcyBzZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IG1hcFByb2R1Y3QgPSAoaXRlbSwgc291cmNlKSA9PiB7XG4gIGNvbnNvbGUubG9nKGBNYXBwaW5nIHByb2R1Y3QgZnJvbSAke3NvdXJjZX06YCwgSlNPTi5zdHJpbmdpZnkoaXRlbSwgbnVsbCwgMikpO1xuXG4gIGNvbnN0IHBhcnNlUHJpY2UgPSAocHJpY2UpID0+IHtcbiAgICBpZiAodHlwZW9mIHByaWNlID09PSAnbnVtYmVyJykgcmV0dXJuIHByaWNlO1xuICAgIGlmICh0eXBlb2YgcHJpY2UgPT09ICdzdHJpbmcnKSByZXR1cm4gTnVtYmVyKHByaWNlLnJlcGxhY2UoL1teMC05Li1dKy9nLFwiXCIpKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICBpZiAoc291cmNlID09PSAnd2FsbWFydCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc291cmNlOiAnd2FsbWFydCcsXG4gICAgICBwcm9kdWN0X2lkOiBpdGVtLmlkIHx8ICcnLFxuICAgICAgbmFtZTogaXRlbS5uYW1lIHx8ICcnLFxuICAgICAgYnJhbmQ6IGl0ZW0uYnJhbmQgfHwgJ04vQScsXG4gICAgICBwcmljZTogcGFyc2VQcmljZShpdGVtLnByaWNlKSxcbiAgICAgIGltYWdlX3VybDogaXRlbS5pbWFnZSB8fCAnJyxcbiAgICAgIHByb2R1Y3RfdXJsOiBpdGVtLnVybCB8fCAnJyxcbiAgICAgIHJhdGluZzogaXRlbS5yYXRpbmc/LmF2ZXJhZ2VfcmF0aW5nID8gTnVtYmVyKGl0ZW0ucmF0aW5nLmF2ZXJhZ2VfcmF0aW5nKSA6IG51bGwsXG4gICAgICByZXZpZXdfY291bnQ6IGl0ZW0ucmF0aW5nPy5udW1iZXJfb2ZfcmV2aWV3cyB8fCAwLFxuICAgICAgYXZhaWxhYmlsaXR5OiBpdGVtLmF2YWlsYWJpbGl0eSB8fCBcIlVuYXZhaWxhYmxlXCIsXG4gICAgICBmdWxsX2Rlc2NyaXB0aW9uOiBpdGVtLmZ1bGxfZGVzY3JpcHRpb24gfHwgJycsXG4gICAgICBwcm9kdWN0X2NhdGVnb3J5OiBpdGVtLnByb2R1Y3RfY2F0ZWdvcnkgfHwgJycsXG4gICAgICBtb2RlbDogaXRlbS5tb2RlbCB8fCAnJyxcbiAgICAgIHNtYWxsX2Rlc2NyaXB0aW9uOiBpdGVtLnNtYWxsX2Rlc2NyaXB0aW9uIHx8ICcnXG4gICAgfTtcbiAgfSBlbHNlIGlmIChzb3VyY2UgPT09ICdhbWF6b24nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNvdXJjZTogJ2FtYXpvbicsXG4gICAgICBwcm9kdWN0X2lkOiBpdGVtLmFzaW4gfHwgJycsXG4gICAgICBuYW1lOiBpdGVtLm5hbWUgfHwgaXRlbS50aXRsZSB8fCAnJyxcbiAgICAgIGJyYW5kOiBpdGVtLmJyYW5kIHx8ICdOL0EnLFxuICAgICAgcHJpY2U6IHBhcnNlUHJpY2UoaXRlbS5wcmljZSksXG4gICAgICBpbWFnZV91cmw6IGl0ZW0uaW1hZ2UgfHwgKGl0ZW0uaW1hZ2VzICYmIGl0ZW0uaW1hZ2VzWzBdKSB8fCAnJyxcbiAgICAgIHByb2R1Y3RfdXJsOiBpdGVtLnVybCB8fCBpdGVtLmxpbmsgfHwgJycsXG4gICAgICByYXRpbmc6IGl0ZW0uc3RhcnMgPyBOdW1iZXIoaXRlbS5zdGFycykgOiBudWxsLFxuICAgICAgcmV2aWV3X2NvdW50OiBpdGVtLnRvdGFsX3Jldmlld3MgfHwgaXRlbS5yYXRpbmdzX3RvdGFsIHx8IDAsXG4gICAgICBhdmFpbGFiaWxpdHk6IGl0ZW0uYXZhaWxhYmlsaXR5IHx8IFwiVW5hdmFpbGFibGVcIixcbiAgICAgIGZ1bGxfZGVzY3JpcHRpb246IGl0ZW0uZnVsbF9kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgIHByb2R1Y3RfY2F0ZWdvcnk6IGl0ZW0ucHJvZHVjdF9jYXRlZ29yeSB8fCAnJyxcbiAgICAgIG1vZGVsOiBpdGVtLm1vZGVsIHx8ICcnLFxuICAgICAgc21hbGxfZGVzY3JpcHRpb246IGl0ZW0uc21hbGxfZGVzY3JpcHRpb24gfHwgJydcbiAgICB9O1xuICB9XG59O1xuXG5jb25zdCBmaWx0ZXJTcG9uc29yZWRQcm9kdWN0cyA9IChwcm9kdWN0cykgPT4ge1xuICByZXR1cm4gcHJvZHVjdHMuZmlsdGVyKHByb2R1Y3QgPT4gIXByb2R1Y3Quc3BvbnNvcmVkKTtcbn07XG5cbmV4cG9ydCBjb25zdCBmZXRjaFByb2R1Y3RzID0gYXN5bmMgKHRlcm0sIHNvdXJjZSwgc29ydEJ5LCBwYWdlID0gMSkgPT4ge1xuICBsZXQgdXJsO1xuICBsZXQgcGFyYW1zO1xuXG4gIC8vIFJlbW92ZSBhbnkgcXVvdGVzIGZyb20gdGhlIEFQSSBrZXlcbiAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuU0NSQVBFUl9BUElfS0VZLnJlcGxhY2UoL1snJ1wiXSsvZywgJycpO1xuXG4gIGlmIChzb3VyY2UgPT09ICdhbWF6b24nKSB7XG4gICAgaWYgKHRlcm0ubWF0Y2goL15bQS1aMC05XXsxMH0kLykpIHsgIC8vIENoZWNrIGlmIHRlcm0gaXMgYW4gQVNJTlxuICAgICAgdXJsID0gYGh0dHBzOi8vYXBpLnNjcmFwZXJhcGkuY29tL3N0cnVjdHVyZWQvYW1hem9uL3Byb2R1Y3RgO1xuICAgICAgcGFyYW1zID0ge1xuICAgICAgICBhcGlfa2V5OiBhcGlLZXksXG4gICAgICAgIGFzaW46IHRlcm0sXG4gICAgICAgIGNvdW50cnlfY29kZTogJ3VzJyxcbiAgICAgICAgdGxkOiAnY29tJ1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdXJsID0gYGh0dHBzOi8vYXBpLnNjcmFwZXJhcGkuY29tL3N0cnVjdHVyZWQvYW1hem9uL3NlYXJjaGA7XG4gICAgICBwYXJhbXMgPSB7XG4gICAgICAgIGFwaV9rZXk6IGFwaUtleSxcbiAgICAgICAgcXVlcnk6IHRlcm0sXG4gICAgICAgIGNvdW50cnk6ICd1cycsXG4gICAgICAgIHBhZ2U6IHBhZ2UudG9TdHJpbmcoKSxcbiAgICAgICAgc29ydF9ieTogc29ydEJ5IHx8ICcnLFxuICAgICAgICBleGNsdWRlX3Nwb25zb3JlZDogJ3RydWUnXG4gICAgICB9O1xuICAgIH1cbiAgfSBlbHNlIGlmIChzb3VyY2UgPT09ICd3YWxtYXJ0Jykge1xuICAgIGlmICh0ZXJtLm1hdGNoKC9eWzAtOV0rJC8pKSB7ICAvLyBDaGVjayBpZiB0ZXJtIGlzIGEgV2FsbWFydCBwcm9kdWN0IElEXG4gICAgICB1cmwgPSBgaHR0cHM6Ly9hcGkuc2NyYXBlcmFwaS5jb20vc3RydWN0dXJlZC93YWxtYXJ0L3Byb2R1Y3RgO1xuICAgICAgcGFyYW1zID0ge1xuICAgICAgICBhcGlfa2V5OiBhcGlLZXksXG4gICAgICAgIHByb2R1Y3RfaWQ6IHRlcm0sXG4gICAgICAgIGNvdW50cnlfY29kZTogJ3VzJyxcbiAgICAgICAgdGxkOiAnY29tJ1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdXJsID0gYGh0dHBzOi8vYXBpLnNjcmFwZXJhcGkuY29tL3N0cnVjdHVyZWQvd2FsbWFydC9zZWFyY2hgO1xuICAgICAgcGFyYW1zID0ge1xuICAgICAgICBhcGlfa2V5OiBhcGlLZXksXG4gICAgICAgIHF1ZXJ5OiB0ZXJtLFxuICAgICAgICBjb3VudHJ5OiAndXMnLFxuICAgICAgICBwYWdlOiBwYWdlLnRvU3RyaW5nKCksXG4gICAgICAgIHNvcnRfYnk6IHNvcnRCeSB8fCAnJyxcbiAgICAgICAgZXhjbHVkZV9zcG9uc29yZWQ6ICd0cnVlJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBGZXRjaGluZyAke3NvdXJjZX0gcmVzdWx0cyBmb3IgdGVybTogXCIke3Rlcm19XCIsIHBhZ2U6ICR7cGFnZX0sIHNvcnRCeTogJHtzb3J0Qnl9YCk7XG4gICAgY29uc29sZS5sb2coJ0FQSSBSZXF1ZXN0IFVSTDonLCB1cmwpO1xuICAgIGNvbnNvbGUubG9nKCdBUEkgUmVxdWVzdCBQYXJhbXM6JywgeyAuLi5wYXJhbXMsIGFwaV9rZXk6ICdbUkVEQUNURURdJyB9KTtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KHVybCwgeyBwYXJhbXMsIHRpbWVvdXQ6IDMwMDAwIH0pO1xuICAgIGNvbnNvbGUubG9nKGBSYXcgQVBJIHJlc3BvbnNlIGZyb20gJHtzb3VyY2V9OmAsIEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmRhdGEsIG51bGwsIDIpKTtcblxuICAgIGxldCBqc29uRGF0YSA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICBpZiAoKHNvdXJjZSA9PT0gJ2FtYXpvbicgJiYgdGVybS5tYXRjaCgvXltBLVowLTldezEwfSQvKSkgfHwgXG4gICAgICAgIChzb3VyY2UgPT09ICd3YWxtYXJ0JyAmJiB0ZXJtLm1hdGNoKC9eWzAtOV0rJC8pKSkge1xuICAgICAgLy8gSWYgaXQncyBhIHByb2R1Y3QgcXVlcnksIHdyYXAgdGhlIHJlc3VsdCBpbiBhbiBhcnJheVxuICAgICAgY29uc3QgbWFwcGVkUHJvZHVjdCA9IG1hcFByb2R1Y3QoanNvbkRhdGEsIHNvdXJjZSk7XG4gICAgICBhd2FpdCBpbnNlcnRQcm9kdWN0cyhbbWFwcGVkUHJvZHVjdF0pO1xuICAgICAgcmV0dXJuIHsgcmVzdWx0czogW21hcHBlZFByb2R1Y3RdLCB0b3RhbFBhZ2VzOiAxIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvciBzZWFyY2ggcXVlcmllcywgcHJvY2VzcyBhcyBiZWZvcmVcbiAgICAgIGxldCByZXN1bHRzID0gW107XG4gICAgICBsZXQgdG90YWxQYWdlcyA9IDE7XG5cbiAgICAgIGlmIChzb3VyY2UgPT09ICd3YWxtYXJ0JyAmJiBqc29uRGF0YS5pdGVtcyAmJiBBcnJheS5pc0FycmF5KGpzb25EYXRhLml0ZW1zKSkge1xuICAgICAgICByZXN1bHRzID0ganNvbkRhdGEuaXRlbXM7XG4gICAgICAgIHRvdGFsUGFnZXMgPSBqc29uRGF0YS50b3RhbF9wYWdlcyB8fCAxO1xuICAgICAgfSBlbHNlIGlmIChzb3VyY2UgPT09ICdhbWF6b24nICYmIGpzb25EYXRhLnJlc3VsdHMpIHtcbiAgICAgICAgcmVzdWx0cyA9IGpzb25EYXRhLnJlc3VsdHM7XG4gICAgICAgIHRvdGFsUGFnZXMgPSBqc29uRGF0YS50b3RhbF9wYWdlcyB8fCAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBBUEkgcmVzcG9uc2Ugc3RydWN0dXJlIGZyb20gJHtzb3VyY2V9OmAsIGpzb25EYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIEFQSSByZXNwb25zZSBzdHJ1Y3R1cmUgZnJvbSAke3NvdXJjZX1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbWFwcGVkUmVzdWx0cyA9IHJlc3VsdHMubWFwKGl0ZW0gPT4gbWFwUHJvZHVjdChpdGVtLCBzb3VyY2UpKTtcbiAgICAgIGNvbnNvbGUubG9nKGBNYXBwZWQgcmVzdWx0cyBmb3IgJHtzb3VyY2V9OmAsIEpTT04uc3RyaW5naWZ5KG1hcHBlZFJlc3VsdHMsIG51bGwsIDIpKTtcblxuICAgICAgLy8gSW5zZXJ0IGFsbCBwcm9kdWN0cyBpbnRvIHRoZSBkYXRhYmFzZVxuICAgICAgYXdhaXQgaW5zZXJ0UHJvZHVjdHMobWFwcGVkUmVzdWx0cyk7XG5cbiAgICAgIHJldHVybiB7IHJlc3VsdHM6IGZpbHRlclNwb25zb3JlZFByb2R1Y3RzKG1hcHBlZFJlc3VsdHMpLCB0b3RhbFBhZ2VzIH07XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGZldGNoaW5nIGRhdGEgZnJvbSAke3NvdXJjZX0gQVBJOmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGRldGFpbHM6YCwgZXJyb3IucmVzcG9uc2UgPyBlcnJvci5yZXNwb25zZS5kYXRhIDogJ05vIHJlc3BvbnNlIGRhdGEnKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHN0cmVhbVJlc3VsdHMgPSBhc3luYyAoc291cmNlVG9GZXRjaCwgdGVybSwgc29ydF9ieSwgcGFnZSkgPT4ge1xuICBjb25zdCBjYWNoZUtleSA9IGBzZWFyY2g6JHtzb3VyY2VUb0ZldGNofToke3Rlcm19OiR7c29ydF9ieX06JHtwYWdlfWA7XG4gIHRyeSB7XG4gICAgY29uc3QgY2FjaGVkUmVzdWx0cyA9IGF3YWl0IGNhY2hlSGVscGVyLmdldChjYWNoZUtleSk7XG5cbiAgICBpZiAoY2FjaGVkUmVzdWx0cykge1xuICAgICAgY29uc29sZS5sb2coYFVzaW5nIGNhY2hlZCByZXN1bHRzIGZvciAke3NvdXJjZVRvRmV0Y2h9YCk7XG4gICAgICByZXR1cm4geyBzb3VyY2U6IHNvdXJjZVRvRmV0Y2gsIC4uLkpTT04ucGFyc2UoY2FjaGVkUmVzdWx0cykgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coYEZldGNoaW5nIGZyZXNoIHJlc3VsdHMgZm9yICR7c291cmNlVG9GZXRjaH1gKTtcbiAgICAgIFxuICAgICAgLy8gRmlyc3QsIHRyeSB0byBnZXQgcmVzdWx0cyBmcm9tIG91ciBkYXRhYmFzZVxuICAgICAgbGV0IGRiUmVzdWx0cyA9IGF3YWl0IGdldFByb2R1Y3RzKHNvdXJjZVRvRmV0Y2gsIHRlcm0sIHBhcnNlSW50KHBhZ2UpLCAyMCk7IC8vIEFzc3VtaW5nIDIwIHJlc3VsdHMgcGVyIHBhZ2VcbiAgICAgIFxuICAgICAgaWYgKGRiUmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBGb3VuZCAke2RiUmVzdWx0cy5sZW5ndGh9IHJlc3VsdHMgaW4gZGF0YWJhc2UgZm9yICR7c291cmNlVG9GZXRjaH1gKTtcbiAgICAgICAgcmV0dXJuIHsgc291cmNlOiBzb3VyY2VUb0ZldGNoLCByZXN1bHRzOiBkYlJlc3VsdHMsIHRvdGFsUGFnZXM6IE1hdGguY2VpbChkYlJlc3VsdHMubGVuZ3RoIC8gMjApIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBubyByZXN1bHRzIGluIGRhdGFiYXNlLCBmZXRjaCBmcm9tIEFQSVxuICAgICAgICBjb25zdCB7IHJlc3VsdHM6IHNvdXJjZVJlc3VsdHMsIHRvdGFsUGFnZXMgfSA9IGF3YWl0IGZldGNoUHJvZHVjdHModGVybSwgc291cmNlVG9GZXRjaCwgc29ydF9ieSwgcGFyc2VJbnQocGFnZSkpO1xuICAgICAgICBhd2FpdCBjYWNoZUhlbHBlci5zZXQoY2FjaGVLZXksIEpTT04uc3RyaW5naWZ5KHsgcmVzdWx0czogc291cmNlUmVzdWx0cywgdG90YWxQYWdlcyB9KSwgeyBFWDogMzYwMCB9KTsgLy8gQ2FjaGUgZm9yIDEgaG91clxuICAgICAgICByZXR1cm4geyBzb3VyY2U6IHNvdXJjZVRvRmV0Y2gsIHJlc3VsdHM6IHNvdXJjZVJlc3VsdHMsIHRvdGFsUGFnZXMgfTtcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgRXJyb3Igc3RyZWFtaW5nIHJlc3VsdHMgZnJvbSAke3NvdXJjZVRvRmV0Y2h9OmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgIHJldHVybiB7IFxuICAgICAgc291cmNlOiBzb3VyY2VUb0ZldGNoLCBcbiAgICAgIGVycm9yOiBgRmFpbGVkIHRvIGZldGNoIGRhdGEgZnJvbSAke3NvdXJjZVRvRmV0Y2h9OiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgIGRldGFpbHM6IGVycm9yLnJlc3BvbnNlID8gZXJyb3IucmVzcG9uc2UuZGF0YSA6ICdObyByZXNwb25zZSBkYXRhJ1xuICAgIH07XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMpIHtcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdHRVQnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5lbmQoKTtcbiAgfVxuXG4gIGNvbnN0IHsgdGVybSwgcGFnZSA9ICcxJywgc29ydF9ieSwgc291cmNlID0gJ2FsbCcgfSA9IHJlcS5xdWVyeTtcblxuICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXG4gIGxldCByZXN1bHRzID0gW107XG5cbiAgaWYgKHNvdXJjZSA9PT0gJ2FsbCcpIHtcbiAgICByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgc3RyZWFtUmVzdWx0cygnd2FsbWFydCcsIHRlcm0sIHNvcnRfYnksIHBhZ2UpLFxuICAgICAgc3RyZWFtUmVzdWx0cygnYW1hem9uJywgdGVybSwgc29ydF9ieSwgcGFnZSlcbiAgICBdKTtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHRzID0gW2F3YWl0IHN0cmVhbVJlc3VsdHMoc291cmNlLCB0ZXJtLCBzb3J0X2J5LCBwYWdlKV07XG4gIH1cblxuICByZXMuc3RhdHVzKDIwMCkuanNvbihyZXN1bHRzKTtcbn0iXSwibmFtZXMiOlsiYXhpb3MiLCJSZWRpcyIsImluc2VydFByb2R1Y3RzIiwiZ2V0UHJvZHVjdHMiLCJyZWRpc0NsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19VUkwiLCJtYXhSZXRyaWVzUGVyUmVxdWVzdCIsInJldHJ5U3RyYXRlZ3kiLCJvbiIsImVyciIsImNvbnNvbGUiLCJ3YXJuIiwiZXJyb3IiLCJjYWNoZUhlbHBlciIsImdldCIsImtleSIsInNldCIsInZhbHVlIiwib3B0aW9ucyIsIm1hcFByb2R1Y3QiLCJpdGVtIiwic291cmNlIiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsInBhcnNlUHJpY2UiLCJwcmljZSIsIk51bWJlciIsInJlcGxhY2UiLCJwcm9kdWN0X2lkIiwiaWQiLCJuYW1lIiwiYnJhbmQiLCJpbWFnZV91cmwiLCJpbWFnZSIsInByb2R1Y3RfdXJsIiwidXJsIiwicmF0aW5nIiwiYXZlcmFnZV9yYXRpbmciLCJyZXZpZXdfY291bnQiLCJudW1iZXJfb2ZfcmV2aWV3cyIsImF2YWlsYWJpbGl0eSIsImZ1bGxfZGVzY3JpcHRpb24iLCJwcm9kdWN0X2NhdGVnb3J5IiwibW9kZWwiLCJzbWFsbF9kZXNjcmlwdGlvbiIsImFzaW4iLCJ0aXRsZSIsImltYWdlcyIsImxpbmsiLCJzdGFycyIsInRvdGFsX3Jldmlld3MiLCJyYXRpbmdzX3RvdGFsIiwiZmlsdGVyU3BvbnNvcmVkUHJvZHVjdHMiLCJwcm9kdWN0cyIsImZpbHRlciIsInByb2R1Y3QiLCJzcG9uc29yZWQiLCJmZXRjaFByb2R1Y3RzIiwidGVybSIsInNvcnRCeSIsInBhZ2UiLCJwYXJhbXMiLCJhcGlLZXkiLCJTQ1JBUEVSX0FQSV9LRVkiLCJtYXRjaCIsImFwaV9rZXkiLCJjb3VudHJ5X2NvZGUiLCJ0bGQiLCJxdWVyeSIsImNvdW50cnkiLCJ0b1N0cmluZyIsInNvcnRfYnkiLCJleGNsdWRlX3Nwb25zb3JlZCIsInJlc3BvbnNlIiwidGltZW91dCIsImRhdGEiLCJqc29uRGF0YSIsIm1hcHBlZFByb2R1Y3QiLCJyZXN1bHRzIiwidG90YWxQYWdlcyIsIml0ZW1zIiwiQXJyYXkiLCJpc0FycmF5IiwidG90YWxfcGFnZXMiLCJFcnJvciIsIm1hcHBlZFJlc3VsdHMiLCJtYXAiLCJtZXNzYWdlIiwic3RyZWFtUmVzdWx0cyIsInNvdXJjZVRvRmV0Y2giLCJjYWNoZUtleSIsImNhY2hlZFJlc3VsdHMiLCJwYXJzZSIsImRiUmVzdWx0cyIsInBhcnNlSW50IiwibGVuZ3RoIiwiTWF0aCIsImNlaWwiLCJzb3VyY2VSZXN1bHRzIiwiRVgiLCJkZXRhaWxzIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImVuZCIsInNldEhlYWRlciIsIlByb21pc2UiLCJhbGwiLCJqc29uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/search.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Flist&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Flist.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();